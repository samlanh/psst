<?php 
$session_user=new Zend_Session_Namespace('authstu');
$username = $session_user->first_name;
$them_style =  $session_user->theme_style;
$user_id = $session_user->user_id;
$login_part = $this->baseUrl();
$session_t=new Zend_Session_Namespace('authteacher');
$teacher_id = $session_t->teacher_id;

	$ddgb = new Application_Model_DbTable_DbGlobal();
	$currentlang = $ddgb->currentlang();
	if(empty($user_id)){
		if(empty($teacher_id)){
			Application_Form_FrmMessage::redirectUrl('/');	
		}
	}
	$tr=Application_Form_FrmLanguages::getCurrentlanguage();
	$base_url = $this->baseUrl()."/";
	$request=Zend_Controller_Front::getInstance()->getRequest();
	$action=$request->getActionName();
	$controller=$request->getControllerName();
	$module=$request->getModuleName();
	
	$session_user=new Zend_Session_Namespace('authstu');
	$arr_module = $session_user->arr_acl;
	$user_id = $session_user->user_id;
	if(empty($user_id)){
		Application_Form_FrmMessage::redirectUrl("/");
	}
	if(empty($username)){
		$username =  $session_t->teacher_name;
	}
    $class='soria';
    $them_style='soria';
	$level=$session_user->level;
	if($level!=1 AND $module=='rsvacl'){
		Application_Form_FrmMessage::redirectUrl("/home");	
	}
	
	$news = $ddgb->getAllNew(10);
	$notread = $ddgb->getNewNotreadByUser();
	$notread = empty($notread)?0:$notread;
    ?>
    <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<link rel="stylesheet" type="text/css" href="<?php echo $base_url;?>js/dojo-1.6.1/dijit/themes/<?php echo $them_style."/".$them_style?>.css" />
    <script src="<?php echo $this->baseUrl()."/contextMenu/1.11.3/"?>jquery.min.js"></script>
    
    <script src="<?php echo $base_url;?>/js/help.js"  type="text/javascript"></script>
	<script src="<?php echo $base_url;?>/js/pdbs_js.js"  type="text/javascript"></script>
	<script type="text/javascript" src="<?php echo $this->baseUrl();?>/webcam/webcamjs/webcam.js"></script>
	<script type="text/javascript" src="<?php echo $this->baseUrl();?>/webcam/webcamjs/webcam.min.js"></script>
	<!-- export library -->
	<?php if($module=='allreport' OR $action=='allreports' OR $action=='studentnearlyendservice' OR 
		$action=='studentpaymentlate' OR $controller=='allreports' OR $controller=='rptproductsold' OR
		$controller=='studentnearlyendservice' OR $controller=='studentpaymentlate' ){?>
	 <script type="text/javascript" src="<?php echo $this->baseUrl();?>/tableexport/tableExport.js"></script>
	<script type="text/javascript" src="<?php echo $this->baseUrl();?>/tableexport/jquery.base64.js"></script>
	<script type="text/javascript" src="<?php echo $this->baseUrl();?>/tableexport/html2canvas.js"></script>
	<script type="text/javascript" src="<?php echo $this->baseUrl();?>/tableexport/jspdf/libs/sprintf.js"></script>
	<script type="text/javascript" src="<?php echo $this->baseUrl();?>/tableexport/jspdf/jspdf.js"></script>
	<script type="text/javascript" src="<?php echo $this->baseUrl();?>/tableexport/jspdf/libs/base64.js"></script> 
	<?php } ?>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="<?php echo $base_url;?>admin/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="<?php echo $base_url;?>admin/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="<?php echo $base_url;?>admin/vendors/nprogress/nprogress.css" rel="stylesheet">
    
    <?php if ( ($module!='home' OR $controller=="crm") AND ( $action=="index" OR $module=='report')){?>
	<link href="<?php echo $this->baseUrl()."/contextMenu/"?>jquery.contextMenu.css" rel="stylesheet" type="text/css" />
	<script src="<?php echo $this->baseUrl()."/contextMenu/"?>jquery.contextMenu.js" type="text/javascript"></script>
	<script src="<?php echo $this->baseUrl()."/contextMenu/"?>jquery.ui.position.min.js" type="text/javascript"></script>
	
	<link href="<?php echo $this->baseUrl()."/datatable/"?>datatables.min.css" rel="stylesheet" type="text/css" />
    <link href="<?php echo $this->baseUrl()."/datatable/"?>responsive.dataTables.min.css" rel="stylesheet" type="text/css" />
    <script src="<?php echo $this->baseUrl()."/datatable/"?>datatables.min.js" type="text/javascript"></script>
    <script src="<?php echo $this->baseUrl()."/datatable/"?>dataTables.responsive.min.js" type="text/javascript"></script>
    <script>
    $(document).ready(function() {
        $('#datatable-responsive').DataTable( {
        	responsive: true,
       	 "dom": '<"top"i>rt<"bottom"flp><"clear">',
        	searching: false,
        } );
    } );
    </script>
	<?php }?>
    <!-- Custom Theme Style -->
    <link href="<?php echo $base_url;?>admin/build/css/custom.min.css" rel="stylesheet">
     <!-- Favicon Icon -->
    <style>
		.fullside {
		    width: 98%;
		    height: 30px;
		}
		.dijitArrowButtonInner, .dijitIconSearch {
		    margin-top: 6px !important;
		}
		.dijitTextBox, .dijitValidationTextBox, .dijitInputField, .dijitInputContainer, .dijitInputInner, dijitReset, .dijitRight, .dijitButtonNode, .dijitArrowButton, .dijitDownArrowButton, .dijitArrowButtonContainer {
		    height: 28px;
		}
		.select2-search-choice-close {
		    display: block;
		    width: 12px;
		    height: 13px;
		    position: absolute;
		    right: 3px;
		    top: 4px;
		    font-size: 1px;
		    outline: none;
		    background: url(<?php echo $this->baseUrl()."/admin/3.5.0/"?>select2.png) right top no-repeat;
		}
    </style>
    <?php if($module=='home' AND $controller=="index" AND $action=="index"){?>
	
   <?php }else{?>   
   <script src="<?php echo $base_url;?>js/dojo-1.6.1/dojo/dojo.js"  djConfig="isDebug: true,parseOnLoad: true"></script>
   <script>dojoConfig = {parseOnLoad: true}</script>
      <script>
		dojo.require("dijit.form.DateTextBox");
		dojo.require("dijit.form.ValidationTextBox");
		dojo.require('dijit.form.Form');
		dojo.require('dijit.form.FilteringSelect');	
		dojo.require('dijit.form.Button');
		dojo.require('dijit.form.NumberTextBox');
		
		dojo.require("dijit.form.CheckBox");     
		dojo.require("dojo.number");
		dojo.require("dijit.Dialog");
		
		dojo.require("dijit.layout.BorderContainer");
		dojo.require("dijit.layout.TabContainer");
		</script>
	
	<?php }?>
	 
	<link rel="shortcut icon" href="<?php echo $base_url;?>images/icon.ico" type="image/x-icon"/>
	<link href="<?php echo $this->baseUrl()."/datatable/bootstrap-custome.css"?>" media="screen" rel="stylesheet" type="text/css">
	 
</head>
<body class="nav-md soria footer_fixed ">
	<div class="container body">
    	<div class="main_container">
        	<div class="col-md-3 left_col ">
          		<div class="left_col scroll-view">
		            <div class="navbar nav_title">
		              <a href="<?php echo $this->baseUrl()."/home";?>" class="site_title"><span><img src="<?php echo $this->baseUrl()?>/images/cam-app-logo.png" alt="CAM APP TECHNOLOGY"></span></a>
		            </div>
            		<div class="clearfix"></div>
            		<?php echo $this->render('menuleft.phtml')?>
            	</div>
            </div>
            <!-- top navigation -->
		        <div class="top_nav">
		          	<div class="nav_menu">
		            	<nav>
				              <div class="nav toggle">
				                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
				              </div>
              				  <ul class="nav navbar-nav navbar-right">
			              	      <li>
              							
			              		     <a title="Khmer" href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
				              			<img src="<?php echo $this->baseUrl()."/images/";?><?php if ($currentlang == 1){ echo "km.png";}else{ echo "en.jpg";}?>"> 
				              		</a>
	              		              	<ul class="dropdown-menu dropdown-usermenu pull-right lang-ul">
		              			            <li class="lang">
				                 				<a href="javascript:;" onclick="changeLange(1);"> 
			                 						<img src="<?php echo $this->baseUrl()."/images/km.png";?>">
			                 					</a>
	                 						</li>
	                 						<li class="lang">
				                 				<a href="javascript:;" onclick="changeLange(2);"> 
			                 						<img src="<?php echo $this->baseUrl()."/images/en.jpg";?>">
			                 					</a>
	                 						</li>
	                	                </ul>
              					</li>
			                	<li class="">
				                  	<a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                       	<img src="<?php echo $this->baseUrl()?>/images/user.png" alt="">
				                    <?php echo $username;?> <span class=" fa fa-angle-down"></span>
					                 </a>
				                  <ul class="dropdown-menu dropdown-usermenu pull-right">
					                    <li><a href="<?php echo $this->url(array('module'=>'','controller'=>'index','action'=>'changepassword')); ?>"> <i class="fa fa-key pull-right"></i> <?php echo $tr->translate("Change Password");?></a></li>
					                    <li><a href="<?php echo $this->url(array('module'=>'','controller'=>'index','action'=>'logout','value'=>'1')); ?>">
					                    <i class="fa fa-sign-out pull-right"></i> <?php echo $tr->translate("SIGN_OUT");?></a>
					                    </li>
				                  </ul>
				                </li>
					              <li role="presentation" class="dropdown">
					                  <a title="<?php echo $tr->translate("NEWS");?>" href="javascript:;"  class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="true">
					                    <i class="fa fa-globe"></i>
					                    <span id="countNews" class="badge bg-green"><?php if ($notread>0){ echo $notread;}?></span>
					                  </a>
					                  <ul id="menu1" class="dropdown-menu list-unstyled " role="menu">
						                 <li class=" event title">
						                  	<h4><?php echo $tr->translate("NEWS");?></h4>
						                  </li>
						                   <?php if(!empty($news)){?>
					                  		<?php foreach($news as $key=> $announ){
				                          	$url = $this->url(array('module'=>'home','controller'=>'index','action'=>'news'), null, true)."/id/".$announ['id'];
					                          	$images = $this->baseUrl().'/images/no-photo.png';
					                          	if (!empty($announ['image_feature'])){
					                          		if (file_exists(PUBLIC_PATH.'/images/news/'.$announ['image_feature'])) {
					                          			$images = $this->baseUrl().'/images/news/'.$announ['image_feature'];
					                          		}
					                          	}
				                          	?>
				                          <li class="event <?php if ($announ['is_read']!=1){ echo 'unread';}?>" title="<?php echo $announ['title'];?>">
				                         	 <a href="<?php echo $url;?>">
					                            <div class="pull-left profile-list ">
					                              <img src="<?php echo $images;?>" />
					                            </div>
					                            <div class="media-body">
					                              <span class="title" ><?php echo $announ['title'];?></span>
					                              <p> <small><?php echo $tr->translate("PUBLISH_DATE")." : ".date("d/M/Y",strtotime($announ['publish_date'])); ?></small>
					                              <p>
					                              	<?php echo  mb_substr(strip_tags($announ['description']),0,70, "utf-8")."...";?>
					                              </p>
					                              
					                              </p>
					                            </div>
				                            </a>
				                          </li>
				                          <?php }?>
				                          <li>
						                      <div class="text-center">
						                        <a href="<?php echo $this->baseUrl()."/home/index/allnews"?>">
						                          <strong><?php echo $tr->translate("SHOW_ALL");?></strong>
						                          <i class="fa fa-angle-right"></i>
						                        </a>
						                      </div>
						                    </li>
				                           <?php }?>
					                  </ul>
					              </li>
				              
				              <li class="">
				                  	<a onclick="dijit.byId('popupCalculator').show();" href="javascript:;" title="<?php echo $tr->translate("CALCULATOR");?>"  class="user-profile " >
                                        <i class="fa fa-calculator"></i>
					                 </a>
				                </li>
             				</ul>
            			</nav>
          			</div>
       			</div>
       		 <!-- /top navigation -->
            <!-- page content -->
       		<div class="right_col" role="main" >
       		 	<div class="right-conten" style="min-height: 570px;">
       		 	<div style="clear:both;"></div>
             	<?php if($module!='allreport' AND ($module!='home' OR $controller=="crm") AND $module!='default' ){?>
             		<div class="ptss-frame  js-ptss-frame "><!-- is-opened -->
							<div class="ptss__toggle-btnaddd  js-ptss-toggle-btn add-edit-action">
								<?php if($action=='index' AND $module!='allreport' AND ($module!='home' OR $controller=="crm") AND $controller!='studentnearlyendservice' AND $controller!='studentpaymentlate' AND $controller!='studentpaymentlate' ){?>
									<a title="<?php echo $tr->translate('ADD_NEW');?>" class='add-edit' href="<?php echo $this->url(array('module'=>$module,'controller'=>$controller,'action'=>'add'),null,true); ?>">
										<i class="fa fa-plus-circle" aria-hidden="true"></i>
									</a>
									<?php }elseif($action=='add' OR $action=='edit' OR $action=='copy' OR $action=='view' OR $module=='allreport'){?>
									<a title="<?php echo $tr->translate('GO_BACK');?>" class='add-edit' href="<?php echo $this->url(array('module'=>$module,'controller'=>$controller,'action'=>'index'),null,true); ?>">
										<i class="fa fa-arrow-circle-o-left" aria-hidden="true"></i>
									</a>
								<?php }?>
							</div>
							<div class="ptss__header add-edit-action">
							 <?php if($action=='index' AND $module!='allreport' AND ($module!='home' OR $controller=="crm") AND $controller!='studentnearlyendservice' AND $controller!='studentpaymentlate' AND $controller!='studentpaymentlate' AND $module!='allreport'){?>
								<a  class='add-edit' href="<?php echo $this->url(array('module'=>$module,'controller'=>$controller,'action'=>'add'),null,true); ?>"><?php echo $tr->translate('ADD');?> 
									<i class="fa fa-plus-circle" aria-hidden="true"></i>
								</a>
							<?php }elseif($action=='add' OR $action=='edit' OR $action=='copy' OR $action=='view' OR $module=='allreport'){?>
								<a class='add-edit' href="<?php echo $this->url(array('module'=>$module,'controller'=>$controller,'action'=>'index'),null,true); ?>">
								<i class="fa fa-arrow-circle-o-left" aria-hidden="true"></i> <?php echo $tr->translate('GO_BACK');?>
								</a>
								<?php }?>
							</div>
						</div>
				<?php }?>
       		 	
	           		<?php if($module=='allreport' AND $action!='index' AND $action!='rpt-certificate' ){?>
							<div class="ptss-frame  js-ptss-frame "><!-- is-opened -->
								<div class="ptss__toggle-btn  js-ptss-toggle-btn ">
									<i class="fa fa-print"></i>
								</div>
								<div class="ptss__header"><?php echo $tr->translate("PRINT");?></div>
								<div class="ptss__settings">
									<div class="ptss__single-setting" id="ptss__layout">
										<div class="ptss__setting-control">
											<div class="ptss__layout-wrapper">
												<a class="qButton" title="<?php echo $tr->translate("Preview");?>" href="#" onclick="preview();"><i class="fa fa-search" aria-hidden="true"></i></a>
												<a class="qButton print" href="#" title="<?php echo $tr->translate("PRINT");?>" onclick="doPrint();" ><i class="fa fa-print" aria-hidden="true"></i></a>
												<a class="qButton excel" href="#"  title="<?php echo $tr->translate("Export");?>"  onclick="exportExcel();"><i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
											</div>
											
										</div>
									</div>
								</div>
							</div>
							<div style="clear:both;"></div>
							<?php }?>
							<?php if($module!='home'  OR ( $module=="home" AND $controller!=="index") ) {?>
							<section class="inputmask">
								<div class="row">
							    	<div class="col-sm-12">
							    	<?php }?>
							<?php 
								$db = new Application_Model_DbTable_DbUsers();
	            				$rs = $db->getAccessUrl($module,$controller,$action);
	            				echo $this->layout()->content;
		            			if(!empty($rs) OR $action=='changepassword'){
		            				//echo $this->layout()->content;
		            			}else{
		            				//echo $this->render('pagenotfund.phtml');
		            			}
            				 ?>
            				 <?php if($module!='home') {?>
			            			 </div>
			            		</div>
			            	</section>
            			 <?php }?>
	            			<?php
				               	if($module=='report' AND $action!='rpt-paymentschedules'){
				            ?>
			                <?php }?>
       		 	</div>
       		</div>
         </div>
     </div>
     <footer>
          <div class="pull-right">
           All rights reserved
           & Developed By <a target="_blank" href="http://cam-app.com/">Cam App Technology</a>
          </div>
          <div class="clearfix"></div>
     </footer>
     <?php   echo $this->render('calculator.phtml'); ?>
     <div class="overlay">
		<div class="overlay-load">
			<div class="overlay-msg">
		    </div>
		</div>
	</div>	
<style>
.overlay {display: none;position: fixed;width: 100%;height: 100%;top: 0px;left: 0px;background: #FCFCFC;z-index: 1001;opacity: .95;}
.overlay-load {width: 350px;height: 100px;margin: auto;top: 0px;bottom: 0px;position: absolute;left: 0px;right: 0px;
           text-align: center;
           background: #fff url("<?php echo $this->baseUrl()?>/images/loading.gif") 50% 25%;
           background-repeat: no-repeat;          
}
.overlay-msg{margin-bottom: 10px;bottom: 0px;position: absolute;font-style: italic;color: rgb(19, 19, 19);} 
</style>
<!-- Custom Theme Scripts -->
<script>

var url_changelang = '<?php echo $this->url(array('module'=>'default','controller'=>'index','action'=>'changelange'));?> ';
function changeLange(lang){
	jQuery.ajax({
		url: url_changelang,
		type: "post",
		data:{'lange':lang},
		success: function(data){
			location.reload();
		},
		error:function(err){
			
		}
	});
}
</script>

<script type="text/javascript">

function loadingBlock(){
  document.getElementsByClassName("overlay")[0].style.display="block";
}
function HideloadingBlock(){
  document.getElementsByClassName("overlay")[0].style.display="none";
}
jQuery(function () {
	'use strict';
	
	jQuery(".ptss__toggle-btn").click(function () {	
		jQuery('.js-ptss-frame').toggleClass('is-opened');
	});
	
	jQuery('.ptss__layout-wrapper > div').click(function(){
		
		jQuery(this).closest('.ptss__setting-control').find('.ptss__layout-wrapper').removeClass('is-selected');
		
		jQuery(this).parent().addClass('is-selected');
		
		if( jQuery(this).hasClass('ptss__layout-box--wide') ) {
			
			jQuery('body').removeClass('boxed');
			jQuery('#ptss__boxed-bg').hide();
			
			jQuery('body').removeClass('bg1').removeClass('bg2').removeClass('bg3').removeClass('bg4');
			
			jQuery('#ptss__boxed-backgrounds span').removeClass('is-selected');
			
		} else {
			
			jQuery('body').addClass('boxed');
			jQuery('#ptss__boxed-bg').show();
			
		}
		
	});
})
<?php if($module=='allreport' AND $action!='index' OR $action='allreports' OR $action='studentnearlyendservice' OR $action='studentpaymentlate'){?>

function doPrint() {
	window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint').innerHTML;
    window.frames["print_frame"].window.focus();
    window.frames["print_frame"].window.print();
    hideDialog();
}
function hideleft(){
	(dojo.style("leftmenu","display") == "none") ? 'show':'hide'();
}
function preview()
{ 
  var disp_setting="toolbar=no,status=no,resizable=no,location=no,directories=yes,menubar=no,"; 
      disp_setting+="scrollbars=no,fullscreen=yes, height=700, left=100, top=25"; 
  var content_vlue = document.getElementById("divPrint").innerHTML; 
  var docprint=window.open("","",disp_setting); 
   docprint.document.open(); 
   docprint.document.write('<html><head>'); 
   docprint.document.write('</head><div style=" font-size:16px !important; margin:0px; font-family:Verdana;"><style>table th {font-size:14px !important;} table td{font-size:12px !important;}</style><center>');          
   docprint.document.write(content_vlue);          
   docprint.document.write('</center></div></html>'); 
   docprint.document.close(); 
   docprint.focus(); 
}
function exportExcel(){
	$('#exportExcel').tableExport({type:'excel',escape:'false'});
}
<?php }?>
</script>

<script src="<?php echo $this->baseUrl()?>/admin/vendors/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="<?php echo $this->baseUrl()?>/admin/build/js/custom.min.js"></script>
<iframe name=print_frame width=0 height=0 frameborder=0 src=about:blank></iframe>
</body>