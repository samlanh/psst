<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle($tr->translate('RECEIPT')); 
	echo $this->headTitle();
	$base_url = Application_Form_FrmMessage::getUrl("/");
?>
<style>
#footer{display: none;}
table tr td strong{
	padding-left: 10px;
}
</style>	
<form method="post" enctype="application/x-www-form-urlencoded">
	<div style="min-height:15cm; margin:0 auto; padding:0.5cm 0.5cm 0cm 0.5cm">
	<div id="divPrint">
		<table style="background:#fff; margin: 0 auto; width:100%;height:13.97cm;" >
			<tr height="40px;">
			    <td colspan="3"  style="" align="center" valign="top">
					<table width="100%" style="font-size: 10px;margin-bottom: 0px;" >
						<tr>
							<td width="30%"></td>
							<td width="40%" align="center" valign="top" style="font-size: 16px;font-weight: bold;">OFFICIAL RECEIPT
								<div><img height="20px" style="margin-top: -2px" src="<?php echo $this->baseUrl().'/images/fonttateng.png'?>"></div>
							</td>
							<td width="30%" valign="bottom">
								<div style="font-size: 15px;font-family:Battambang,Arial,Helvetica,sans-serif;"><u>Receipt N<sup>o</sup></u><?php echo $this->rr['receipt_number'];?></div> 
								<span style="font-size: 14px;font-weight: bold;font-family: arail"><?php echo $tr->translate('Pmt Date');?> : <?php echo date('d-M-Y',strtotime($this->rr['create_date']));?></span>
							</td>
						</tr>
					</table>
			    </td>
			</tr>
			<tr>
				<td colspan="3">
					<table width="100%" border="0" style="font-family: Khmer OS Battambang; font-size: 12px;white-space: nowrap;">
						<tr style="line-height: 16px;">
						<td>Student's ID</td>
						<td> : &nbsp;&nbsp;<strong><?php echo $this->rr['stu_code'];?></strong></td>
						<td>Dob</td>
						<td> : &nbsp;&nbsp;<label id="lb_dob" class="one bold"></label> </td>
						<td >Gender</td>
						<td> : &nbsp;&nbsp;<strong><?php echo $this->rr['sex'];?></strong></td>
					</tr>
					<tr style="line-height: 16px;">
						<td>Student's Name</td>
						<td colspan="1"> :&nbsp;&nbsp;<strong><?php echo $this->rr['stu_khname'].' / ';echo $this->rr['stu_enname']?></strong></td>
						<td>Phone</td>
						<td> : &nbsp;&nbsp;<label id="lb_phone" class="one bold"></label> </td>
						<td>Academic Year</td>
						<td>  : &nbsp;<label id="lb_study_year" class="one bold"> </label> </td>
					</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td colspan="3">
					<style> th,td{ padding:0 1px;}</style>
						<style type="text/css">
							table{ border-collapse:collapse; margin:0 auto;
							border-color:#000; }
							.padd tr td{  text-align:center}
							.padd tr th{  background-color: #ccc; }
						</style>
					<table class="padd" width="99%" border="1" align="center" style="white-space:nowrap; padding: 0px; margin: 0px;font-family: Khmer OS Battambang;">
						  <tr style="font-size:12px; height: 20px;" align="center" >
						    <th>&nbsp;<?php echo $tr->translate('N_O');?>&nbsp;</th>
							<th>&nbsp;<?php echo $tr->translate('Item Name');?>&nbsp;</th>
							<th>&nbsp;<?php echo $tr->translate('Term');?>&nbsp;</th>
							<!-- <th>&nbsp;<?php //echo $tr->translate('Unit Price');?>&nbsp;</th>
								<th>&nbsp;<?php //echo $tr->translate('Qty');?>&nbsp;</th>
								<th>&nbsp;<?php //echo $tr->translate('Late Fee');?>&nbsp;</th>
								<th>&nbsp;<?php //echo $tr->translate('Extra Fee');?>&nbsp;</th>
							 -->
							<th>&nbsp;<?php echo $tr->translate('Amount');?>&nbsp;</th>
							<th>&nbsp;<?php echo $tr->translate('សុពលភាព');?>&nbsp;</th>
							<th>&nbsp;<?php echo $tr->translate('START_DATE');?>&nbsp;</th>
							<th>&nbsp;<?php echo $tr->translate('END_DATE');?>&nbsp;</th>
						  </tr>
							<style> td{padding:0 3px; }</style>
						  <?php
						  $str = '';
						  $i=0; $total=0; if(!empty($this->row)) foreach($this->row as $key =>$rs){ $i++;
							if($key==0){
								$str=$key+1;
							}else{
								$str.=",".($key+1);
							}
							?>
						  <tr class="hover" style="font-size:12px;height: 18px;"​ >
						    <td><?php echo $i;?></td>
						    <td style="text-align: left;"><?php echo $rs['service'];?>
						    	<input type="hidden" id="id_<?php echo $key+1?>" name="id_<?php echo $key+1?>" value="<?php echo $rs['id'];?>" />
						    </td>
						    <td><?php echo $rs['payment_term']; ?></td>
						   <!--  <td>$ <?php echo $rs['fee']; if(empty($rs['fee'])) echo '0.00';?></td>
						    <td><?php //echo $rs['qty']; if(empty($rs['qty'])) echo '00';?></td>
						    <td><?php //if($rs['late_fee']>0){echo '$ '.$rs['late_fee'];}?></td>
					   		<td><?php //if($rs['extra_fee']>0){echo '$ '.$rs['extra_fee'];}?></td>
						    <td><?php //echo $rs['discount_percent']; if(empty($rs['discount_percent'])) echo '';?></td> -->
						    <td>$<?php echo $rs['paidamount'];?></td>
						    <td><select name="onepayment_<?php echo $key+1?>" dojoType="dijit.form.FilteringSelect">
						    	<option value="0" <?php if($rs['is_onepayment']==0){echo"selected";}?>>Normal</option>
						    	<option value="1" <?php if($rs['is_onepayment']==1){echo"selected";}?>>1 Payment only</option>
						    </select>
						    	
						    </td>
						    <td><input name="start_date<?php echo $key+1?>" id="start_date<?php echo $key+1?>" constraints="{datePattern:'dd/MM/yyyy'}" dojoType="dijit.form.DateTextBox" type="text" value="<?php if($rs['is_onepayment']==0){echo date('Y-m-d', strtotime($rs['start_date']));} ?>" /></td>
						    <td><input name="end_date<?php echo $key+1?>" id="end_date<?php echo $key+1?>" constraints="{datePattern:'dd/MM/yyyy'}" dojoType="dijit.form.DateTextBox" type="text" value="<?php if($rs['is_onepayment']==0){echo date('Y-m-d', strtotime($rs['validate'])); }?>" /></td>
						  </tr> <?php $total = $total + $rs['subtotal']; ?>
						  <?php } 							  	
						  ?>
						  <tr>
						  	<td colspan="7">
						  		<button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" type="submit">ស្វែងរក</button>
						  	</td>
						  </tr>
						 <!-- 
						  <tr style="font-size:12px;height: 18px;border: 1px solid #fff;border-top: 1px solid #000;"​>
							  	<td style="" colspan="6"></td>
							  	<td style="text-align: left;"><?php echo $tr->translate('Total Payment');?></td>
							  	<td>$ <?php echo $this->rr['grand_total'];?></td>
						  </tr>
						  <tr style="font-size:12px;height: 18px; border: 1px solid #fff;"​>
							  	<td style=" " colspan="6"><label id="lbl_moneykhmer"></label></td>
							  	<td style="text-align: left;"><?php echo $tr->translate('Fine');?></td>
							  	<td>$ <?php echo $this->rr['fine'];?></td>
						  </tr>
						  <tr style="font-size:12px;height: 18px;border: 1px solid #fff;"​>
							  	<td style="" colspan="6"></td>
							  	<td style="text-align: left;"><?php echo $tr->translate('Credit Memo');?></td>
							  	<td>$ <?php echo $this->rr['credit_memo'];?></td>
						  </tr>
						  <tr style="font-size:12px;height:18px;border: 1px solid #fff;"​>
							  	<td style="" colspan="6"></td>
							  	<td style="text-align: left;"><?php echo $tr->translate('Deduct');?></td>
							  	<td>$ <?php echo $this->rr['deduct'];?></td>
						  </tr>
						  <tr style="font-size:12px;height: 18px;border: 1px solid #fff;"​>
							  	<td style=" border: 1px solid #fff;" colspan="9">
							  		<table width="100%" border="0" style="white-space:nowrap;border-collapse:collapse;font-size:12px;line-height:16px;">	
										<tr>
											<td width="33%" align="center">Cashier</td>
											<td width="34%" align="center">Customer</td>
											<td width="33%" align="center">Verified By</td>
										</tr>
									</table>	
							  	</td>
							  	<td  style="text-align: left;"><strong><?php echo $tr->translate('Net Amount');?></strong></td>
							  	<td>
							  	<strong>$ <?php echo $this->rr['net_amount'];?></strong></td>
						  </tr>
						   -->
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="3">&nbsp;<input type="hidden" name="identity" id="identity" value="<?php echo $str;?>" /></td>
				</tr>
			</table>
		</div>	
	</div>
</form>
<script type="text/javascript">
dojo.ready(function(){
	//readMoneyInKhmer(111);
});	
function readMoneyInKhmer(netTotal){
	var str = netTotal.toString();
    str_cent = 'សេន';
	first_decimal = str.substr(-2);
	last_decimal = str.substr(-1);
    if(first_decimal>0){string='និង';}else{string="";str_cent=""}
	if(first_decimal!='00' && first_decimal<10 ){str_zero = "សូន្យ";}else{str_zero='';}
    first_money_decimal = read_in_khmer_from_10_to_99(first_decimal);
    last_money_decimal = read_in_khmer_from_0_to_9(last_decimal)
    money_khmer=read_money_in_khmer(netTotal);

    if(first_decimal>0){string_en='និង';}else{string_en="";str_cent_en=""}
	if(first_decimal!='00' && first_decimal<10 ){str_zero_en = "Zero";}else{str_zero_en='';}
    first_money_decimal_en = read_in_english_from_10_to_99(first_decimal);
    last_money_decimal_en = read_in_english_from_0_to_9(last_decimal)
    money_english=read_money_in_english(netTotal);
    read_eng = money_english.trim()+string+ first_money_decimal+str_zero+last_money_decimal+'ដុល្លារគត់'

    read_eng = '( '+money_english.trim()+string_en+ first_money_decimal_en+str_zero_en+last_money_decimal_en+' Dollar Only )'
    dojo.byId("lbl_moneykhmer").innerHTML = money_khmer.trim()+string+ first_money_decimal+str_zero+last_money_decimal+'ដុល្លារគត់'+read_eng
}
</script>