<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle('Report Student Payment Detail'); 
	echo $this->headTitle();
	$base_url = Application_Form_FrmMessage::getUrl("/");
	$frm = $this->form_search;
?>
<form id='foundation_class' action="<?php echo $this->url(array('module'=>'allreport','controller'=>'accounting','action'=>'rpt-studentpaymentdetail')); ?>" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
		<table width="70%" align="left">
			<tr>
				<td>
					<input dojoType="dijit.form.TextBox" class="fullside"  id="txtsearch" name="txtsearch" placeholder="Search....." value="<?php echo $this->search['txtsearch'];?>" type="text">
				</td>
				<td>
					<input name="start_date" id="start_date" class="fullside"  constraints="{datePattern:'dd/MM/yyyy'}" dojoType="dijit.form.DateTextBox"  value="<?php echo $this->search['start_date'];?>" type="text">
				</td>
				<td>
					<input name="end_date" id="end_date" class="fullside"  constraints="{datePattern:'dd/MM/yyyy'}" dojoType="dijit.form.DateTextBox"  value="<?php echo $this->search['end_date'];?>" type="text">
				</td>
				<td>
					<button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" name="search"  type="submit"><?php echo $tr->translate("SEARCH");?></button>
				</td>
		</table>
</form>

<style>
#footer{display: none;}
</style>	
<div style="border: 1px dotted #000;background: #fff; margin: 0 auto;min-height: 27cm;">
		<div id="divPrint">
			<table style="background:#fff; margin: 0 auto; width: 100%; padding: 1cm;font-family:'Khmer OS Battambang'; " >
							<tr>
								<td width="15%" align="center">
									<img style="width:60%;" alt="<?php ?>" src="<?php echo $this->baseUrl().'/images/logo.png'?>"><br />
								</td>
								<td  align="center" width="70%">
									<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 18px;font-family:'Khmer MEF2';"><?php echo $tr->translate('STUDENT_PAYMENT_DETAIL_REPORT');?></strong><br />
									<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 13px;font-family:'Khmer MEF2';">For Date <?php echo date("d-M-Y",strtotime($this->search["start_date"]))?> to <?php echo date("d-M-Y",strtotime($this->search["end_date"]));?></strong>
								</td>
								<td width="15%" align="center">
								</td>
							</tr>
							<tr>
								<td colspan="3" id="exportExcel">
									<style> th,td{ padding:0 1px;}</style>
										<style type="text/css">
											body{font-family: "Times New Roman",Arial; }
											table{ border-collapse:collapse; margin:0 auto;
											border-color:#000; }
											.padd tr td{  text-align:center}
											.padd tr th{  background-color: #ccc; }
										</style>

									<?php 
										$total=0;
										$total_balance = 0;
										$total_receive = 0;
									?>	
										
										
									<table class="padd" width="99%" border="1" align="center" style="white-space:nowrap;font-family: 'Khmer OS Battambang';">
										  <tr style="background-color: #ccc;line-height: 30px;font-weight: bold;font-size:12px; height: 20px; align="center" >
										    <td>&nbsp;<?php echo $tr->translate('N_O');?>&nbsp;</td>
										    <td>&nbsp;<?php echo $tr->translate('RECEIPT_NO');?>&nbsp;</td>
										    <td>&nbsp;<?php echo $tr->translate('STUDENT_ID');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('STUDENT_NAME');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('SERVICE_NAME');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('PAYMENT_TERM');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('FEE');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('QTY');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('LATE_FEE');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('EXTRA_FEE');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('DISCOUND');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('SUBTOTAL');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('PAID_DATE');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('USER');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('REMARK');?>&nbsp;</td>
											<td>&nbsp;<?php echo $tr->translate('STATUS');?>&nbsp;</td>
										  </tr>
										<style> 
											td{padding:0 3px; }
											.hover:hover{background: #ccc;}
										</style>
										  
										  <?php $i=0;if(!empty($this->row)){foreach($this->row as $rs){ $i++;?>
										  <tr class="hover" style="font-size:11px; color:#000; height: 18px;"​ align="center">
										  	<td <?php if($rs['is_void']==1){echo 'style="color:red;"'; }?>><?php echo $i;?></td>
										  	<td align="center" <?php if($rs['is_void']==1){echo 'style="color:red;"'; }?>><?php echo $rs['receipt_number']; ?></td>
										  	<td align="center"><?php echo $rs['stu_code']; ?></td>
										    <td style="text-align:left"><?php echo $rs['stu_khname'].'-'.$rs['stu_enname']; ?></td>
										    <td style="text-align:left"><?php echo $rs['service_name']; ?></td>
										    <td align="center"><?php echo $rs['payment_term']; ?></td>
										    <td>$ <?php echo number_format($rs['fee'],2); ?></td>
										    <td><?php echo $rs['qty'];?></td>
										    <td><?php if($rs['late_fee']>0){echo '$ '.$rs['late_fee'];}?></td>
										    <td><?php if($rs['extra_fee']>0){echo '$ '.$rs['extra_fee'];}?></td>
										    <td><?php if($rs['discount_percent']>0){echo $rs['discount_percent'].' %';} ?> </td>
										    <td <?php if($rs['is_void']==1){echo 'style="color:red;"'; }?>>$ <?php echo $rs['paidamount']; ?></td>
										    <td><?php echo date('d-M-Y', strtotime($rs['create_date']));?></td>
										    <td><?php echo $rs['user']; ?></td>
										   	<td><?php echo $rs['note']; ?></td>
										   	<td <?php if($rs['is_void']==1){echo 'style="color:red;"'; }?>><?php echo $rs['void_status']; ?></td>
										  </tr>
										  <?php 
										 	if($rs['is_void']==0){
										 		$total = $rs['paidamount'] + $total;
										 	}
										  ?> 
										 
										  <?php } }?>
										 
										</table>
									</td>
								</tr>
								<tr><td colspan="3">&nbsp;</td></tr>
									
									<?php 
										$fine=0;
										$credit_memo=0;
										$deduct=0;
										$net_amount=0;									
									?>
									
									<?php if(!empty($this->rs)){foreach ($this->rs as $payment){
											if($payment['is_void']==0){
												$fine = $fine + $payment['fine'];
												$credit_memo = $credit_memo + $payment['credit_memo'];
												$deduct = $deduct + $payment['deduct'];
												$net_amount = $net_amount + $payment['net_amount'];
											}
									}}?>
								<tr>
									<td colspan="3">
											<table width="29.2%" border="1" align="right" style="margin-right:0.5%; white-space:nowrap;font-family: 'Khmer OS Battambang';">
												<tr style="font-size:10px; color:#000; height: 23px;"​ align="center">
										 				<th style="background-color: #ccc; width: 38%; font-weight:bold;font-size: 10px;">&nbsp;<?php echo $tr->translate('GRAND_TOTAL');?>&nbsp;</th>
														<td colspan="2" style="font-weight:bold;font-family: Arial Black; font-size: 10px;"><span style="color: red;">$ <?php echo number_format($total,2);?></span></td>
										  		</tr>
										  		<tr style="font-size:10px; color:#000; height: 23px;"​ align="center">
										 				<th style="background-color: #ccc; width: 38%; font-weight:bold; font-size: 10px;">&nbsp;<?php echo $tr->translate('FINE');?>&nbsp;</th>
														<td colspan="2" style="font-weight:bold;font-family: Arial Black; font-size: 10px;"><span style="color: red;">$ <?php echo number_format($fine,2);?></span></td>
										  		</tr>
										  		<tr style="font-size:10px; color:#000; height: 23px;"​ align="center">
										 				<th style="background-color: #ccc; width: 38%; font-weight:bold;font-size: 10px;">&nbsp;<?php echo $tr->translate('CREDIT_MEMO');?>&nbsp;</th>
														<td colspan="2" style="font-weight:bold;font-family: Arial Black; font-size: 10px;"><span style="color: red;">$ <?php echo number_format($credit_memo,2);?></span></td>
										  		</tr>
										  		<tr style="font-size:10px; color:#000; height: 23px;"​ align="center">
										 				<th style="background-color: #ccc; width: 38%; font-weight:bold;font-size: 10px;">&nbsp;<?php echo $tr->translate('DEDUCT');?>&nbsp;</th>
														<td colspan="2" style="font-weight:bold;font-family: Arial Black; font-size: 10px;"><span style="color: red;">$ <?php echo number_format($deduct,2);?></span></td>
										  		</tr>
										  		<tr style="font-size:10px; color:#000; height: 23px;"​ align="center">
										 				<th style="background-color: #ccc; width: 38%; font-weight:bold;font-size: 10px;">&nbsp;<?php echo $tr->translate('NET_AMOUNT');?>&nbsp;</th>
														<td colspan="2" style="font-weight:bold;font-family: Arial Black; font-size: 10px;"><span style="color: red;">$ <?php echo number_format($net_amount,2);?></span></td>
										  		</tr>
										  </table>
									</td>
								</tr>
								<tr>
									<td colspan="3">&nbsp;</td>
								</tr>
								<tr>
									<td colspan="3">&nbsp;</td>
								</tr>
								<tr >
									<td colspan="3" width="100%">
										<table width="100%">
											<tr>
												<td  width="25%" align="center">
													<span style=" font-size: 14px;"><?php echo $tr->translate('VERIFIED_BY')?></span>
												</td>
												<td  width="50%">
													&nbsp;
												</td>
												<td align="center"  width="25%">
													<span style="font-size: 14px;text-align: right;"><?php echo $tr->translate('PREPARED_BY')?></span>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
	</div>	
</div>

