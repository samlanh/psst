<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle($tr->translate("REPORT_STAFF_INFORMATION")); 
	echo $this->headTitle(''); 
	$frm =  $this->frm_search;
	$_dbgb = new Application_Model_DbTable_DbGlobal();
	$classHideHeight="110px";
?>	
<style>
.hover:hover{ background:#ccc;}
table.content-data tr.style-head,
table.tb-footer tr.style-head {
   font-weight: bold !important;
}
</style>
<div style="min-height:10cm; margin:0 auto; padding:0.5cm 0.5cm 0cm 0.5cm">	
	<div class="card-box">
       		<div class="col-sm-12 border-botom">
		    	<div class="col-sm-8 pd-0">
	    			<h4 class="m-b-0"><i class="fa fa-file " aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('REPORT_STAFF_INFORMATION');?></h4>
    			</div>
    			<div class="col-sm-4 text-right">
    			</div>
    		</div>
    	</div>
	<form  id='foundation_class' action="" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
		<div class="form-group">
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement("title");?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement("branch_id");?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement("degree");?>
        	</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement("teacher_type");?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement("nationality");?>
        	</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement("active_type");?>
        	</div>
		</div>	
		<div class="form-group">
			
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement("staff_type");?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement("department");?>
        	</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
        		<button class="button-class button-primary" iconClass="glyphicon glyphicon-search" dojoType="dijit.form.Button" showLabel="true" name="search"  type="submit"><?php echo $tr->translate("SEARCH");?></button>
        	</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
				<select name="optionSelect" id="optionSelect" dojoType="dijit.form.FilteringSelect" class="fullside" onchange="getBlogStaff();">
					<option value="1"><?php echo $tr->translate("NORMAL_OPTION");?></option>
					<option value="2"><?php echo $tr->translate("SELECTED_STUDENT_OPTION");?></option>
				</select>
      		</div>
        </div>
		
	</form>
<div id="divPrint">
		<table class="NORMAL_OPTION"  style="background:#fff; margin: 0 auto; width: 100%; ">
			<tr>
				<td colspan="3"><?php echo $this->rsheader;?></td>
			</tr>
			<tr class="line"><td colspan="3"></td></tr>
			<tr>
				<td>&nbsp;</td>
			</tr>
			<tr>
				<td width="10%" align="right">
				</td>
				<td width="60%" align="center">
					<span​​ style="color:#000; font-size: 13px;font-family:'Times New Roman','Khmer OS Muol Light';"><?php echo $tr->translate("REPORT_STAFF_INFORMATION");?></span><br/>
				</td>
				<td width="5%" align="right">
				</td>
			</tr>
			<tr>
				<td>&nbsp;</td>
			</tr>
		<style>
			.style{
						line-height: 20px;font-size: 11px !important;
						font-family: 'Times New Roman','Khmer OS Battambang';
					}
					.hideblog{display: none;}
					.hiddenblog{display: block !important;}
					.style1:hover{ background: #ccc; }
					table tr td ul li{text-align: center;list-style: none;line-height: 25px; }
					table.content-data { page-break-inside:auto }
					tr.content-data{ page-break-inside:avoid; page-break-after:auto; }
					#header {
					  display: table-header-group;
					  page-break-inside:avoid; page-break-after:auto;
					  margin-top: 100px;
					}
					.hide{visibility: hidden;}
					@media print {
					 div.divFooter {
					    position: fixed;
					    top: 0;
					  	width: 100%;
					  	height: 100px;
					  	bottom:0px;
						margin:0;
					  }
						.hide{visibility: visible; height: <?php echo $classHideHeight;?>;}
						
					}
					.center{text-align: center !important;}
					table.content-data{
						border-collapse:collapse;
						border:1px solid #000; 
						font-size:8px;
						width:100%;
				
					}
					table.content-data thead tr.style {
					   line-height: 25px; font-size:10px !important; padding:2px 0px; white-space: nowrap;height: 22px; 
						background: #c1d0f3;
						font-weight:600;
					}
					table.content-data  tr.style {
					 white-space: nowrap;
					
					}
					
					
					table.tb-footer{
						border-collapse:collapse;
						border:1px solid #000; 
						font-size:11px;
						font-family: 'Times New Roman','Khmer OS Battambang';
					}
					table.tb-footer tr{
					 line-height: 14px; font-size:11px; padding:2px 0px; height: 25px;
					}
					table tr td{
						padding:0 2px;
					}
					tr.voidclass {
						background: #fff7f7;
					}
					td.centerText{
						text-align: center;
					}
					.redBold {
						font-weight: 600;
						color: #f80000;
					}
					table.content-data tr td{
						padding: 1px;
					}
					@page {
						page:A4;
						size:landscape;
						margin:0;
       				 }
			
		</style>
			<tr>
				<td colspan="3" id="exportExcel">
						<table class="content-data" cellpadding="5"​ border="1" >
							<thead>
								<tr class="style" align="center">
									<td scope="col"><input type="checkBox" onclick="checkAllStudent('<?php echo count($this->rs);?>');" name="checkall" id="checkall" /></td>
									<td scope="col"><?php echo $tr->translate("NUM");?></td>
									<td scope="col"><?php echo $tr->translate("BRANCH");?></td>
									<td scope="col"><?php echo $tr->translate("ID_CARD");?></td>
									<td scope="col"><?php echo $tr->translate("TEACHER_NAME");?></td>
									<td scope="col"><?php echo $tr->translate("SEX");?></td>
									<td scope="col"><?php echo $tr->translate("NATIONALITY");?></td>
									<td scope="col"><?php echo $tr->translate("TYPE");?></td>
									<td scope="col"><?php echo $tr->translate("DEGREE");?></td>
									<td scope="col"><?php echo $tr->translate("TEACHER_TYPE");?></td>
									<td scope="col">&nbsp;<?php echo $tr->translate("POSITION");?>&nbsp;</td>
									<td scope="col"><?php echo $tr->translate("PHONE");?></td>
									<td scope="col"><?php echo $tr->translate("EMAIL");?></td>
									<td scope="col"><?php echo $tr->translate("WORKING_STATUS");?></td>
									<td scope="col"><?php echo $tr->translate("NOTE");?><input type="hidden" name="id_selected" id="id_selected" dojoType="dijit.form.TextBox" /></td>
								</tr>
							</thead>
							<?php $i=0;$degree=0; if(!empty($this->rs)){ foreach ($this->rs AS $row) { $i++;?>
							<tr class="style  hover" >
								<td  align="center">
									<input style="height: 15px;margin-top: 5px;" type="checkBox" onClick="checked_id(<?php echo $i?>)" name="check_box<?php echo $i?>" id="check_box<?php echo $i?>" />
									<input type="hidden" name="staff_id<?php echo $i;?>" id="staff_id<?php echo $i;?>" value="<?php echo $row['id'];?>" dojoType="dijit.form.TextBox" />
								</td>
								<td data-label="<?php echo $tr->translate("NUM");?>"  align="center"><?php echo $i;?></td>
								<td data-label="<?php echo $tr->translate("BRANCH");?>"  ><?php echo $row['branch_name'];?></td>
								<td data-label="<?php echo $tr->translate("ID_CARD");?>"  ><?php echo $row['teacher_code'];?></td>
								<td data-label="<?php echo $tr->translate("TEACHER_NAME");?>"  align="left">&nbsp;<?php echo $row['teacher_name_kh'];?>&nbsp;</td>
								<td data-label="<?php echo $tr->translate("SEX");?>"  align="left">&nbsp;<?php echo $row['sex'];?>&nbsp;</td>
								<td data-label="<?php echo $tr->translate("NATIONALITY");?>"  ><?php echo $row['nationality'];?></td>
								<td data-label="<?php echo $tr->translate("TYPE");?>"  ><?php echo $row['staff_type_title'];?></td>
								<td data-label="<?php echo $tr->translate("DEGREE");?>"  ><?php echo $row['degree'];?></td>
								<td data-label="<?php echo $tr->translate("TEACHER_TYPE");?>"  ><?php if($row['staff_type']==1){ echo $row['teacher_type'];}else{ echo "-";}?></td>
								<td data-label="<?php echo $tr->translate("POSITION");?>"  ><?php echo $row['position_add'];?></td>
								<td data-label="<?php echo $tr->translate("PHONE");?>"  align="left">&nbsp;<?php echo $row['tel'];?></td>
								<td data-label="<?php echo $tr->translate("EMAIL");?>" ><?php echo $row['email'];?></td>	
								<td data-label="<?php echo $tr->translate("WORKING_STATUS");?>" ><?php echo $row['active_type'];?></td>	
								<td data-label="<?php echo $tr->translate("NOTE");?>" ><?php echo $row['note'];?></td>
							</tr>
						<?php }}?>	
						</table>	
				</td>
			</tr>
			<tr >
				<td colspan="3" width="100%">
					<?php echo $this->rsfooteracc;?>
				</td>
			</tr>
		</table>
		<div class="card-box SELECTED_STUDENT_OPTION">
			<div class="col-md-12 col-sm-12 col-xs-12" style=" padding: 0;">
				<div class="form-group" style=" background: #d8e0e2; padding: 5px 15px; margin: 0; border: solid 1px #697996; border-radius: 2px;">
					<label class="control-label bold col-md-2 col-sm-2 col-xs-12"><?php echo $tr->translate("SELECT_STUDENT");?> </label>
					<div class="col-md-5 col-sm-5 col-xs-12">
						<select name="staffID" id="staffID" dojoType="dijit.form.FilteringSelect" class="fullside" onchange="addRow();">
							<option value="0"><?php echo $tr->translate("SELECT_TEACHER");?></option>
							<?php if(!empty($this->rs)){ foreach ($this->rs AS $row) { ?>
							<option value="<?php echo $row['id']; ?>"><?php echo $row['teacher_code']." ".$row['teacher_name_kh'];?></option>
							<?php }} ?>
						</select>
					</div>
				</div>
				<div class="form-group">
					<table  border="1px" style="border-collapse: collapse; width:100%; border:1px solid #ccc;">
						<thead>
							<tr id="head-title" class="head-td" align="right" style="width: 100%;">
								<th width="5%"><?php echo $tr->translate("DEL");?></th>
								<th width="5%"><?php echo $tr->translate("N_O");?></th>
								<th ><?php echo $tr->translate("TEACHER_NAME");?></th>
							</tr>
						</thead>
						<tbody id="table_row">
						</tbody>
						<input type="hidden" name="identity" id="identity" dojoType="dijit.form.TextBox" value="" >
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
<table width="100%">
	<tr>
		<td align="center">
			<button dojoType="dijit.form.Button" id="printselected" iconClass="dijitEditorIcon dijitEditorIconPrint"
				type="button" onclick="printSelected();"><?php echo $tr->translate('Print Selected')?></button>
			<!-- <input type="button" dojoType="dijit.form.Button" label="<?php //echo $tr->translate('Print ID Card')?>" iconClass="dijitEditorIcon dijitEditorIconPrint"  onclick="printIDCard();" /> -->
		</td>
	</tr>
</table>

<div class="dijitHidden" style="width: 22cm !important; height: 11cm ; padding: 0px; margin: 0px;">
	<div data-dojo-type="dijit.Dialog"  align="center" data-dojo-props="title:'<?php echo $tr->translate("PAYMENT_RECEIPT");?>'" id="print_income" >
		
		<div id="print_student_card" >
			<style>
					.card-content-student-print{
						background-image: url('<?php echo $this->baseUrl()."/images/card/student_card_bg.jpg";?>');
						 background-size: 100%;background-repeat: no-repeat;
						 page-break-after:always;					
					}
					<?php if(!empty($this->groupByType)) foreach($this->groupByType as $bck){
						$imagebg = $this->baseUrl().'/images/card/default_card_bg.jpg';
						$color = "000000";
						
						$type = 3;
						if ($bck['staff_type']==1){
							$type = 2;
						}else if ($bck['staff_type']==1){
							$type = 3;
						}
						
						$bg = $_dbgb->getCardBackground($bck['branch_id'],$type);
						if(!empty($bg['background'])){
							if (file_exists(PUBLIC_PATH."/images/card/".$bg['background'])){
							$imagebg = $this->baseUrl().'/images/card/'.$bg['background'];
							}
							if (!empty($bg['colorcode'])){
								$color = str_replace("#", "", $bg['colorcode']);
							}
						}
						?>
						.card-content-print.staff-<?php echo $bck['staff_type'];?> {
								background-image: url('<?php echo $imagebg;?>');
							 	background-size: 100%;background-repeat: no-repeat;	
								
							}
						.card-content-print .name-card-block ul.list-data li .staff-id-<?php echo $bck['staff_type'];?>{
							color:#<?php echo $color;?>;
						}
					<?php }?>
					
					.profile-card-block {
								    position: relative;
								}
								.profile-card-block .photo {
								    text-align: center;
								    width: 100%;
								    position: absolute;
								    top: 96px;
									left: -0.58px;
								}
								.photo img {
								    width: 70.7px;
								    height: 92px;
								}
								.name-card-block {
								    position: relative;
								}
						
								.name-card-block ul.list-data {
								    list-style-type: none;
								    padding: 0;
								    width: 100%;
								    position: absolute;
								    text-align: center;
								    top: 182.5px;
								    color: #01049f;
								    font-weight: bold;
								    font-size: 12px;
								}	
							.name-card-block ul.list-data li{
								line-height: 16px;	    
							}
							.card-content-print .name-card-block ul.list-data li .staff-id{
								color:#000000;
							}		    
								
							.name-card-block ul.list-data li.utiliy-value{
								font-size: 10px;
								line-height: 14px;
							}
							.foot-left-block {
							    position: relative;
							}
							.qrimages {
							    position: absolute;
							    top: 262px;
							    width: 100%;
							    text-align: center;
							}
							.qrimages img {
							    width: 80%;
							    text-align: center;
								height: 17px;
							}
							.validdate {
							    position: relative;
							}
							.validdate .exp_date {
									 color: #01049f;
							    position: absolute;
							    top: 245.5px;
							    right: 5px;
							    font-size: 5px;
							    font-weight: 700 !important;
							}
						div.pagese{ page-break-inside:always; page-break-after:always; }
	</style>
		<?php $con=4;$i=0; $student= count($this->rs);
			if(!empty($this->rs)){foreach ($this->rs AS $key=> $row){ $i++;?>
					<div class="pagese">
				<div class="card-content-print staff-<?php echo $row['staff_type'];?>" style=" <?php if($key>0){ echo "margin-top :7px;";}?> line-height: 16.285px;  width: 5.1cm; height:8.35cm;   color: #3f3f95; font-family: 'Times New Roman', sans-serif,'Kh Battambang','Khmer Battambang'; ">
                    		<?php 
                    		
                    		$card_type = 3;
                    		if ($row['staff_type']==1){
                    			$card_type = 2;
                    		}else if ($row['staff_type']==1){
                    			$card_type = 3;
                    		}
                    		$bg = $_dbgb->getCardBackground($bck['branch_id'],$card_type);
                    		$prefix="";
							$validDate="";
							$teacher_name = $row['teacher_name_en'];
                    		if (!empty($bg)){
                    			$prefix = $bg['card_prefix'];
								$validDate = $bg['valid'];
								if ($bg['display_by']==2){
									$teacher_name = $row['teacher_name_kh'];
								}
                    		}
                    		
                    			$image = $this->baseUrl().'/images/no-profile-admin.png';
								  if(!empty($row['photo'])){
									if (file_exists(PUBLIC_PATH."/images/photo/".$row['photo'])){
									$image = $this->baseUrl().'/images/photo/'.$row['photo'];
									}
								  }
							?>
                    		<div class="profile-card-block">
                    			<div class="photo">
                    				<img  src="<?php echo $image;?>" alt="profile-image" >
                    			</div>
                    		</div>
                    		<div class="name-card-block">
	                    		<ul class="list-data">
	                    			<li><span class="title_value">&nbsp;<?php echo $teacher_name;?></span></li>
	                    			<li class="utiliy-value"><span class="title_value">Position:&nbsp;<?php echo $row['position_add'];?></span></li>
	                    			<li class="utiliy-value"><span class="title_value">Dept:&nbsp;<?php echo $row['dept_name'];?></span></li>
	                    			<li><span class="title_value staff-id-<?php echo $row['staff_type'];?>">&nbsp;ID: <?php echo $row['teacher_code'];?></span></li>
	                    		</ul>
	                    	</div>
	                    	<div class="validdate">
	                    		<span class="exp_date"><?php echo date("F j , Y",strtotime($validDate))?></span>
	                    	</div>
	                    	<?php  
// 	                    	$prefix = $this->data["prefix_barcode_teacher"];
// 	                    	if ($this->rs['staff_type']==2){
// 	                    		$prefix = $this->data["prefix_barcode_staff"];
// 	                    	}
	                    	$barcode = $prefix."-".$row['teacher_code']."-".date("y",strtotime($validDate));
	                    	$url = $this->url(array("module"=>"default","controller"=>"index","action"=>"barcode","codereader"=>$barcode),null,true);?>
	                    	<div class="foot-left-block">
                    			<div class="qrimages">
                    				<img  src="<?php echo $url;?>" alt="profile-image" >
                    			</div>
                    		</div>
                    		<div class="foot-right-block">
                    		</div>
                    </div>
				</div>
		<?php }
			}?>
		</div>		
	</div>
</div>
<script src="<?php echo $this->baseUrl();?>/js/help.js"></script>
<script type="text/javascript">
dojo.require("dojo.NodeList-manipulate");
dojo.require("dojo.data.ItemFileWriteStore"); 
var group_store  = getDataStorefromJSON('id','name',<?php print_r(Zend_Json::encode(array()));?> );
dojo.ready(function(){ 
	getBlogStaff();
});

var template = '';
	var col = 0;
	var no = 0;
	var title = 0;
	tmp = '';
	temp='';
function addRow(){ 
	staffID=dijit.byId("staffID").get("value");
	if(staffID=='' || staffID==0){return false;}
	var iden = $("#id_selected").val();
	var arrays = iden.split(',');
	 if(arrays!=""){
		 for(var i=0;i< arrays.length;i++) {
			 readychoose = dijit.byId('class_'+arrays[i]).get('value');
			 if(readychoose==staffID){
					alert("<?php echo $tr->translate("Choosen ready")?>");
				 	return false;
			 }
		}
	}
		col++;no++;
		labelStaff = dijit.byId("staffID").attr('displayedValue');
		template='';
		if(title!=1){
			$("#head-title").html("");    
			temp+='<th with="5%"><?php echo $tr->translate("DEL");?></th>';
			temp+='<th with="5%"><?php echo $tr->translate("N_O");?></th>';
			temp+='<th><?php echo $tr->translate("TEACHER_NAME");?></th>';
			dojo.query("#head-title").append(temp);
			title=1;
		}
			template+='<td width="5%"align="center"><img onclick="deleteRecord('+staffID+')" src="<?php echo $this->baseUrl();?>/images/Delete_16.png"></td>';
			template+='<td width="5%" align="center">'+no+'</td>';
			template+='<td>&nbsp;'+labelStaff+'<input type="hidden" dojoType="dijit.form.TextBox" required="true" id="class_'+staffID+'" name="class_'+staffID+'" value="'+staffID+'" /></td>';
		tmp='<tr " id="row'+staffID+'">';
		tmp+="</tr>";
		dojo.query("#table_row").append(tmp);

		if($("#id_selected").val()!="") {
			var identity = $("#id_selected").val();
			$("#id_selected").val(identity+','+staffID);
		} else {$("#id_selected").val(staffID);}
		dojo.html.set(dojo.byId("row"+staffID),template , {
		     parseContent: true,
		});
 }
  function deleteRecord(index){
	var identity = $('#id_selected').val();
	var arrays = identity.split(',');
	for(var i=0;i<arrays.length;i++) {
	if(arrays[i] == index) arrays.splice(i,1);
	}
	var strings = arrays.join(',');
	$('#id_selected').val(strings);
	dojo.query("#row"+index).remove();
}

function getKHMonthByNumber(m){
	var monthName=[
		"មករា",
		"កុម្ភៈ",
		"មីនា",
		"មេសា",
		"ឧសភា",
		"មិថុនា",
		"កក្កដា",
		"សីហា",
		"កញ្ញា",
		"តុលា",
		"វិច្ឆិកា",
		"ធ្នូ",
		];
		return (monthName[m-1]);
}	
	function printIDCard(){
		loadingBlock();
	  	 var contents = document.getElementById("print_student_card").innerHTML;
	 	  var frame1 = document.createElement('iframe');
	    frame1.name = "frame1";
	    frame1.style.position = "absolute";
	    frame1.style.top = "-1000000px";
	    document.body.appendChild(frame1);
	    var frameDoc = (frame1.contentWindow) ? frame1.contentWindow : (frame1.contentDocument.document) ? frame1.contentDocument.document : frame1.contentDocument; frameDoc.document.open();
	    frameDoc.document.write('<html><head><title>Employee ID</title>');
	    frameDoc.document.write('</head><body>');
	    frameDoc.document.write(contents);
	    frameDoc.document.write('</body></html>');
	    frameDoc.document.close();
	    setTimeout(function () {
	        window.frames["frame1"].focus();
	        window.frames["frame1"].print();
	        document.body.removeChild(frame1);
	        HideloadingBlock();
	    }, 10000);
	   return false;
	}
	function printSelected(){
		<?php 
			defined('BASE_URL')	|| define('BASE_URL', Zend_Controller_Front::getInstance()->getBaseUrl());
    		$tr = Application_Form_FrmLanguages::getCurrentlanguage();
    		$url_copy =$this->url(array('module'=>'allreport','controller'=>'allstaff','action'=>'staff-idselected'));
    	?>

    	 id_selected = dijit.byId('id_selected').get('value');
		 if(id_selected!=''){
			window.location.href = '<?php echo $url_copy;?>'+'/id/'+id_selected;
		 }else{
			alert('Please select record you want to print');
			return false;
		 }
	}
	function print(){
		window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint1').innerHTML;
	    window.frames["print_frame"].window.focus();
	    window.frames["print_frame"].window.print();
	}

	function checkAllStudent(array_length){
		dijit.byId('id_selected').attr('value','');
		
		if(dojo.byId('checkall').checked){
			for(var j=1;j<=array_length;j++){
				$("#check_box"+j).attr('checked', 'checked');
				checked_id(j);
			}
		}else{
			for(var j=1;j<=array_length;j++){
				$("#check_box"+j).removeAttr("checked");
				checked_id(j);
			}
		}
	}
	function checked_id(index){
		staff_id = dijit.byId('staff_id'+index).get('value');
		if(dojo.byId('check_box'+index).checked){
			if($("#id_selected").val()!="") {
				var identity = $("#id_selected").val();
				$("#id_selected").val(identity+','+staff_id);
			}else{
				$("#id_selected").val(staff_id);
			}
			
		}else{
			
			var identity = $('#id_selected').val();
			var arrays = identity.split(',');
			for(var i=0;i<arrays.length;i++) {
			if(arrays[i] == staff_id) arrays.splice(i,1);
			}
			var strings = arrays.join(',');
			$('#id_selected').val(strings);
		}
	}

	function getBlogStaff(){
		optionSelect=dijit.byId("optionSelect").get("value");
		if(optionSelect==1){
			$(".NORMAL_OPTION").css("display", "table");
			$(".SELECTED_STUDENT_OPTION").css("display", "none");
		}else{
			$("#id_selected").val('');
			dojo.query("#table_row").append("");
			$(".NORMAL_OPTION").css("display", "none");
			$(".SELECTED_STUDENT_OPTION").css("display", "block");
		}
		
	}

</script>