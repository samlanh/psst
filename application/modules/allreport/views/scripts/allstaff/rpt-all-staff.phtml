<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle('របាយការណ៏ សិស្ស'); 
	echo $this->headTitle(''); 
	$frm =  $this->form_search;
?>	
<style>
.hover:hover{ background:#ccc;}</style>
<div style="width: 30cm;margin: 0 auto;">
<form  id='foundation_class' action="<?php echo $this->url(array('module'=>'allreport','controller'=>'allstaff','action'=>'rpt-all-staff')); ?>" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
		<table width="100%">
	       <tr>
	           <td><?php echo $frm->getElement("title");?></td>
				<td><button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" name="search"  type="submit"><?php echo $tr->translate("SEARCH");?></button></td>
		 	</tr>
		</table>		
</form>
</div>
<script type="text/javascript">
function getKHMonthByNumber(m){
	var monthName=[
		"មករា",
		"កុម្ភៈ",
		"មីនា",
		"មេសា",
		"ឧសភា",
		"មិថុនា",
		"កក្កដា",
		"សីហា",
		"កញ្ញា",
		"តុលា",
		"វិច្ឆិកា",
		"ធ្នូ",
		];
		return (monthName[m-1]);
}	
</script>
<div style="border: 1px dotted #000;background: #fff;width:29cm;margin: 0 auto;min-height: 27cm;padding: 0.5cm;">
	<div id="divPrint">
		<table border="0" style="background:#fff; margin: 0 auto; width: 100%; ">
			<tr>
				<td width="15%" align="center">
					<img style="width: 60%;" alt="<?php ?>" src="<?php echo $this->baseUrl().'/images/logo.png'?>"> 
				</td>
				<td width="70%"  align="center">
				    <strong​​ style=" font-weight:bold;font-family: Arial Black;color:#000; font-size: 14px;font-family:'Khmer MEF2';"><?php echo $tr->translate("CUSTOMER_BRANCH");?></strong><br />
					<strong​​ style=" font-weight:bold;font-family: Arial Black;color:#000; font-size: 14px;font-family:'Khmer MEF2';"><?php echo $tr->translate("ALL_STUDENT_REPORT");?></strong><br />
					<strong​​ style=" font-weight:bold;font-family: Arial Black;color:#000; font-size: 13px;font-family:'Khmer MEF2';">From  <?php echo date('d-M-Y',strtotime($this->search['start_date']));?>  To   <?php echo date('d-M-Y',strtotime($this->search['end_date']));?> </strong>
				</td>
				<td width="15%" align="center">
				</td>
			</tr>
		<style>
			table tr th{
				border: 1px solid #000;	
			}
		</style>
			<tr>
				<td colspan="3">
				<div id="exportExcel">
					<table cellpadding="4"​ style="font-family:'Khmer OS Battambang' ; margin:0 auto;width:100%;border:1px solid #000; border-collapse: collapse;white-space: nowrap;"  border="1" >
						<tr style="font-size:11px; height: 20px;" align="center" >
							<td><input type="checkBox" onclick="checkAllStudent('<?php echo count($this->rs);?>');" name="checkall" id="checkall" /></td>
							<td>No.</td>
							<td>Branch Name</td>
							<td>Staff ID</td>
							<td>Name KH</td>
							<td>Name EN</td>
							<td>Sex</td>
							<td>Tel</td>
							<td>Address</td>
							<td>Position</td>
							<td>Expire Date</td>
							<td>Note</td>
						</tr>
						<input type="hidden" name="id_selected" id="id_selected" dojoType="dijit.form.TextBox" />
					<?php $i=0;foreach ($this->rs AS $row) { $i++;?>
						<tr style="font-size:11px; height: 23px;" align="center" class="hover" >
							<td>
								<input style="height: 15px;margin-top: 5px;" type="checkBox" onClick="checked_id(<?php echo $i?>)" name="check_box<?php echo $i?>" id="check_box<?php echo $i?>" />
								<input type="hidden" name="staff_id<?php echo $i;?>" id="staff_id<?php echo $i;?>" value="<?php echo $row['id'];?>" dojoType="dijit.form.TextBox" />
							</td>
							<td ><?php echo $i;?></td>
							<td ><?php echo $row['branch_name'];?></td>
							<td ><?php echo $row['teacher_code'];?></td>
							<td align="left">&nbsp;&nbsp;<?php echo $row['teacher_name_kh'];?>&nbsp;</td>
							<td align="left">&nbsp;&nbsp;<?php echo $row['teacher_name_en'];?>&nbsp;</td>
							<td ><?php echo $row['sex'];?></td>	
							<td ><?php echo $row['tel'];?></td>
							<td ><?php echo $row['address'];?></td>
							<td ><?php echo $row['staff_position'];?></td>	
							<td ><?php echo date('d-m-Y',strtotime($row['expired_date']));?></td>
							<td ><?php echo $row['note'];?></td>
						</tr>
					<?php }?>	
					</table>	
				</div>	
				</td>
			</tr>
			<tr>
				<td colspan="3">&nbsp;</td>
			</tr>
			<tr >
				<td colspan="3" width="100%">
					<table width="100%" style="font-family:'Khmer OS Battambang';">
						<tr>
							<td  width="25%" align="center">
								<span style=" font-size: 14px;"><?php echo $tr->translate('VERIFIED_BY')?></span>
							</td>
							<td  width="50%">
								&nbsp;
							</td>
							<td align="center"  width="25%">
								<span style="font-size: 14px;text-align: right;"><?php echo $tr->translate('PREPARED_BY')?></span>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
	</div>
	<table width="100%">
		<tr>
			<td align="center">
				<button dojoType="dijit.form.Button" id="printselected" iconClass="dijitEditorIcon dijitEditorIconPrint"
					type="button" onclick="printSelected();">Print Selected</button>
				<input type="button" dojoType="dijit.form.Button" label="Print ID Card" iconClass="dijitEditorIcon dijitEditorIconPrint"  onclick="printIDCard();" />
			</td>
		</tr>
	</table>
</div>
<div class="dijitHidden" style="width: 22cm !important; height: 11cm ; padding: 0px; margin: 0px;">
	<div data-dojo-type="dijit.Dialog" style="width:22cm;" align="center" data-dojo-props="title:'<?php echo $tr->translate("PAYMENT_RECEIPT");?>'" id="print_income" >
		<div id="divPrint1" style="width: 21cm !important; height: 13cm ; padding: 0px; margin: 0px;">
		<?php $con=4;$margin=5;$i=0;if(!empty($this->rs)){ foreach ($this->rs AS $row){ $i++;?>	
			<table  width="100%" style="white-space: nowrap;font-size:10px;font-family: 'Khmer OS Battambang';" class="print" cellspacing="1"  cellpadding="0">
				<thead>
				<style>
					table { page-break-inside:auto }
					tr{ page-break-inside:avoid; page-break-after:auto }
				</style>
				<tr>
					<td width="50%" align="right">
						<table style="border: 2px solid #3dd833;height: 9cm;width: 6.8cm;font-size:11px;font-family: 'Khmer OS Battambang';color:#00007b;">
							<tr style="">
								<td colspan="3" valign="top" align="center" width="100%" style="line-height: 25px;white-space: nowrap;font-size: 14px;background-color: #ffc107;border-radius:10px;">
									<div style="margin-top: 3px;">
										<span style="font-family: 'Khmer OS Muol Light';">សាលាកម្ពុជា - អូស្ត្រាលី </span><br />
										CAMBODIA - AUSTRALIA SCHOOL <br />
										Quality Discipline Morality <br />
									</div>
								</td>
							</tr>
							<?php 
								$address_kh='អាសយដ្ឋាន<br />  អាគារលេខ ២D ផ្លូវលេខ៣៧១ សឡា <br /> 
											 ភូមិ ទ្រា សង្កាត់ ស្ទឹងមានជ័យ <br /> ខណ្ឌ មានជ័យ រាជធានីភ្នំពេញ<br />
											ទូរស័ព្ទលេខ: ០១៧ ៦៨៣ ៤៧៥ <br />  ឬ  ០៨៦ ៣៦ ៥០ ៥៨
											<br />បណ្ណនេះប្រើប្រាស់សម្រាប់កិច្ចការ<br />សាលាតែប៉ុណ្ណោះ។';
							?>
							<tr>
								<td align="center" valign="top"  colspan="3" style="line-height: 25px;font-size: 15px;"> 
									<img style="width:35%;" src="<?php echo $this->baseUrl().'/images/style.png'?>">
									<div style="margin-bottom: -15px; padding: 10px;">
									
										<?php echo $address_kh;?>
										
									</div>
								</td>
							</tr>
						</table>
					</td>
					<?php 
						if($row['sex']=='1' ){
							$sex_en = "Male";
							$sex_kh = "ប្រុស";
						}else{
							$sex_en = "Female";
							$sex_kh = "ស្រី";
						}
						$staff_id = explode('/', $row['teacher_code']);
					?>
					<td width="50%">
						<table style="white-space:nowrap; border: 2px solid #3dd833;height: 9cm;width: 6.8cm;font-size:11px;font-family: 'Khmer OS Battambang',Arial,sans-serif;color:#00007b;" cellspacing="0" cellpadding="0">
							<tr height="0">
								<td colspan="4" align="center">
									<img style="width:25%;margin: 5px 0px;" src="<?php echo $this->baseUrl().'/images/logo.png'?>">
								</td>
							</tr>
							<tr style="height: 0;line-height:22px;">
								<td colspan="4" align="center" valign="top" style="background: #ffc107;">
									<div style="font-family: 'Khmer OS Muol Light';margin-top: 5px;">បណ្ណសម្គាល់ខ្លួនបុគ្គលិក</div>
									<div style="margin-top: -4px;"><?php echo 'លេខ';?>: <label id="stu_code<?php echo $i;?>"></label></div>
									
									<script type="text/javascript">
										letter = '<?php echo $staff_id['1']?>';
										staff_code = '<?php echo $staff_id['0']?>';
										result = convertEnglishToKhmerNumber(staff_code);
										dojo.byId('stu_code<?php echo $i;?>').innerHTML=result + '/' + letter;
									</script>
								</td>
							</tr>
							<tr style="height: 0;line-height: 25px" >
								<td width="25%">
									&nbsp;&nbsp;ឈ្មោះ
								</td>
								<td width="50%">
									: <span style="font-family: 'Khmer OS Muol Light';"><?php echo $row['teacher_name_kh'];?></span>
								</td>
								<td width="15%">
									ភេទ :
								</td>
								<td width="12%">
									<?php echo $sex_kh;?>
								</td>
							</tr>
							<tr style="height: 0;line-height: 18px">
								<td >
									&nbsp;&nbsp;Name
								</td>
								<td >
									: <span style="font-family: 'Khmer OS Muol Light';"><?php echo $row['teacher_name_en'];?></span>
								</td>
								<td >
									Sex :
								</td>
								<td >
									<?php echo $sex_en;?>&nbsp;
								</td>
							</tr>
							<tr style="height: 0;line-height: 18px">
								<td >
									&nbsp;&nbsp;<?php echo 'កាលកំណើត';?>
								</td>
								<td colspan="3">
									: <label id="dob<?php echo $i;?>"></label>
									<script type="text/javascript">
									<?php if($row['dob']==null || $row['dob']==''){ ?>
											dob = '';
									<?php }else{?>
											dob = 'ថ្ងៃទី ' + convertEnglishToKhmerNumber('<?php echo date('d',strtotime($row['dob']));?>')+' ខែ '+getKHMonthByNumber('<?php echo date('m',strtotime($row['dob']));?>')+' ឆ្នាំ '+ convertEnglishToKhmerNumber('<?php echo date('Y',strtotime($row['dob']));?>');
											dojo.byId('dob<?php echo $i;?>').innerHTML=dob;
									<?php }?>
									</script>
									
								</td>
							</tr>
							
							<tr style="height: 0;line-height: 18px">
								<td >
									&nbsp;&nbsp;<?php echo 'តួនាទី';?>
								</td>
								<td colspan="3">
									: <?php echo $row['staff_position'];?>
									
								</td>
							</tr>
							
							<tr style="height: 0;line-height: 18px">
								<td >
									&nbsp;&nbsp;<?php echo 'សុពលភាព';?>
								</td>
								<td colspan="3">
								: <label id="year<?php echo $i;?>"></label>
									<script type="text/javascript">
										kh_date = 'ថ្ងៃទី '+convertEnglishToKhmerNumber('<?php echo date('d',strtotime($row['expired_date']));?>')+' ខែ '+getKHMonthByNumber('<?php echo date('m',strtotime($row['expired_date']));?>')+' ឆ្នាំ '+ convertEnglishToKhmerNumber('<?php echo date('Y',strtotime($row['expired_date']));?>');
										dojo.byId('year<?php echo $i;?>').innerHTML=kh_date;
									</script>
								</td>
							</tr>
							
							<tr>
								<td colspan="4">
									<table width="100%" style="font-size:11px;font-family: 'Khmer OS Battambang';color:#00007b;">
										<tr>
											<td width="3%">
												&nbsp;
											</td>
											<td width="27%" >
												<img style="width:100%;height: 80px;border: 1px solid rgba(0, 0, 0, 0.1);" src="<?php echo $this->baseUrl().'/images/'.$row['photo'];?>">
											</td>
											<td width="70%" align="center" valign="top" colspan="2">
												<div style="margin-top: -5px;">
													<?php echo 'ធ្វើនៅថ្ងៃទី';?> : <label id="create_date<?php echo $i;?>"></label>
													<script type="text/javascript">
														create_date = convertEnglishToKhmerNumber('<?php echo date('d');?>')+' ខែ '+getKHMonthByNumber('<?php echo date('m');?>')+' ឆ្នាំ '+ convertEnglishToKhmerNumber('<?php echo date('Y');?>');
														dojo.byId('create_date<?php echo $i;?>').innerHTML=create_date;
													</script>
												
												</div>
												<div style="margin-top: -2px;font-family: Khmer OS Muol Light;"><?php echo 'នាយក';?></div><br />
												<div style="margin-top: 15px;font-family: Khmer OS Muol Light;"><?php echo 'ផាន់ សិទ្ធី';?></div>
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				</thead>
			</table>
		<?php }}?>
		</div>
		<table width="100%">
			<tr>
				<td align="center">
					<iframe name=print_frame width=0 height=0 frameborder=0 src=about:blank></iframe>
					<button dojoType="dijit.form.Button" id="printall" iconClass="dijitEditorIcon dijitEditorIconPrint"
						type="button" onclick="print();">Print ID Card</button>
				</td>
			</tr>
		</table>
		
	</div>
</div>
<script type="text/javascript">
	function printIDCard(){
		window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint1').innerHTML;
	    window.frames["print_frame"].window.focus();
	    window.frames["print_frame"].window.print();
	}
	function printSelected(){
		<?php 
			defined('BASE_URL')	|| define('BASE_URL', Zend_Controller_Front::getInstance()->getBaseUrl());
    		$tr = Application_Form_FrmLanguages::getCurrentlanguage();
    		$url_copy =$this->url(array('module'=>'allreport','controller'=>'allstaff','action'=>'staff-idselected'));
    	?>

    	 id_selected = dijit.byId('id_selected').get('value');
		 if(id_selected!=''){
			window.location.href = '<?php echo $url_copy;?>'+'/id/'+id_selected;
		 }else{
			alert('Please select record you want to print');
			return false;
		 }
	}
	function print(){
		window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint1').innerHTML;
	    window.frames["print_frame"].window.focus();
	    window.frames["print_frame"].window.print();
	}

	function checkAllStudent(array_length){
		dijit.byId('id_selected').attr('value','');
		
		if(dojo.byId('checkall').checked){
			for(var j=1;j<=array_length;j++){
				$("#check_box"+j).attr('checked', 'checked');
				checked_id(j);
			}
		}else{
			for(var j=1;j<=array_length;j++){
				$("#check_box"+j).removeAttr("checked");
				checked_id(j);
			}
		}
	}
	function checked_id(index){
		staff_id = dijit.byId('staff_id'+index).get('value');
		if(dojo.byId('check_box'+index).checked){
			if($("#id_selected").val()!="") {
				var identity = $("#id_selected").val();
				$("#id_selected").val(identity+','+staff_id);
			}else{
				$("#id_selected").val(staff_id);
			}
			
		}else{
			
			var identity = $('#id_selected').val();
			var arrays = identity.split(',');
			for(var i=0;i<arrays.length;i++) {
			if(arrays[i] == staff_id) arrays.splice(i,1);
			}
			var strings = arrays.join(',');
			$('#id_selected').val(strings);
		}
	}
</script>