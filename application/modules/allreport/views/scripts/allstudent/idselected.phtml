<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
?>	
<script type="text/javascript">
function getKHMonthByNumber(m){
	var monthName=[
		"មករា",
		"កុម្ភៈ",
		"មីនា",
		"មេសា",
		"ឧសភា",
		"មិថុនា",
		"កក្កដា",
		"សីហា",
		"កញ្ញា",
		"តុលា",
		"វិច្ឆិកា",
		"ធ្នូ",
		];
		return (monthName[m-1]);
}	
</script>
<div class="dijitHidden" style="width: 22cm !important; height: 11cm ; padding: 0px; margin: 0px;">
	<div data-dojo-type="dijit.Dialog" style="width:22cm;" align="center" data-dojo-props="title:'<?php echo $tr->translate("PAYMENT_RECEIPT");?>'" id="print_income" >
		<div id="divPrint1" style="width: 21cm !important; height: 13cm ; padding: 0px; margin: 0px;">
		<style>
				table tr.page-break{
				  page-break-after:always
				} 
				table.page-break{
				  page-break-after:always
				}
		</style>
		<?php $con=4;$margin=5;$i=0;
			$r=0;
		if(!empty($this->rs)){foreach ($this->rs AS $row){?>	
			<?php 
			$row['dept']=1;
			if($r==4){$r=0;?>
				<table class="page-break"><tr class="page-break"><td></td></tr></table>
			<?php }$i++;$r++;?>
			<table  width="100%" style="white-space: nowrap;font-size:10px;font-family: 'Khmer OS Battambang';" class="print" cellspacing="1"  cellpadding="0">
				<tr>
					<td width="50%" align="right">
						<table style="border: 3px solid #FFC107;<?php if($row['dept']<=2){echo 'height: 5.9cm;';}else{echo 'height: 5.95cm;';}?> width: 8.5cm;font-size:11px;font-family: 'Khmer OS Battambang';color:#00007b;">
							<tr>
								<td width="25%" align="left" valign="top">
									<img style="width:100%;" src="<?php echo $this->baseUrl().'/images/logo.png'?>">
								</td>
								<td valign="top" align="center" width="65%" style="line-height: 20px;white-space: nowrap;">
									<div style="margin-right: 20px;margin-top: 3px;">
										<span style="font-family: 'Khmer OS Muol Light';"><?php echo $tr->translate("CUSTOMER_BRANCH");?></span><br />
										<?php echo $tr->translate("SCHOOL_NAME");?><br />
										<?php echo $tr->translate("SLOGAN_SCHOOL");?><br />
										<img style="width:40%;" src="<?php echo $this->baseUrl().'/images/style.png'?>">
									</div>
								</td>
								<td width="10%">&nbsp;</td>
							</tr>
							<?php 
								$address_kh=$tr->translate("CUSTOMER_ADDRESS").'<br />
											ទូរស័ព្ទលេខ: '.$tr->translate("CUSTOMER_TEL").'<br />
											ប័ណ្ណនេះប្រើប្រាស់សម្រាប់កិច្ចការសាលាតែប៉ុណ្ណោះ។';
								$address_en=$tr->translate("CUSTOMER_ADDRESS").'<br />Telephone: '.$tr->translate("CUSTOMER_TEL").'<br />
										This ID Card is to be used within school only.';
							?>
							<tr>
								<td align="center" valign="top" colspan="3" style="line-height: 20px;"> 
									<div style="margin-top: -20px;"><?php if($row['dept']<=2){echo 'ឆ្នាំសិក្សា';}else{echo 'Academic Year';}?> &nbsp;<label id="academic_year<?php echo$i;?>"></label><br />
										<script type="text/javascript">
											<?php if($row['dept']<=2){?>
												year = convertEnglishToKhmerNumber('<?php echo $row['start_year']?>')+'-'+convertEnglishToKhmerNumber('<?php echo $row['end_year']?>');
											<?php }else{?>
												year = '<?php echo $row['academic_year'];?>';
											<?php } ?>
											dojo.byId('academic_year<?php echo $i;?>').innerHTML=year;
										</script>
										<?php if($row['dept']<=2){echo $address_kh;}else{echo $address_en;}?>
										
									</div>
								</td>
							</tr>
						</table>
					</td>
					<?php 
						if($row['sex']=='M' ){
							$sex_en = "Male";
							$sex_kh = "ប្រុស";
						}else{
							$sex_en = "Female";
							$sex_kh = "ស្រី";
						}
					?>
					<td width="50%">
						<table style="border: 3px solid #FFC107;height: 5.9cm;width: 8.5cm;font-size:11px;font-family: 'Khmer OS Battambang',Arial,sans-serif;color:#00007b;" cellspacing="0" cellpadding="0">
							<tr style="height: 0;">
								<td colspan="4" align="center" valign="top">
									<div style="font-family: 'Khmer OS Muol Light';margin-top: 5px;">អត្តសញ្ញាណប័ណ្ណសិស្ស</div>
									<div style="margin-top: -4px;"><?php if($row['dept']<=2){echo 'អត្តលេខ';}else{echo 'ID N<sup>o</sup>';}?>: <label id="stu_code<?php echo $i;?>"></label></div>
									<script type="text/javascript">
										test1 = '<?php echo $row['stu_code'];?>';
										dojo.byId('stu_code<?php echo $i;?>').innerHTML=test1;
									</script>
								</td>
							</tr>
							<tr style="height: 0;line-height: 18px" >
								<td width="25%">
									&nbsp;&nbsp;ឈ្មោះ
								</td>
								<td width="45%">
									: <span style="font-family: 'Khmer OS Muol Light';"><?php echo $row['stu_khname'];?></span>
								</td>
								<td width="30%" colspan="4" rowspan="4">
									<img style="margin-right:20px;width:92%;height: 73px;border: 1px solid #000" src="<?php echo $this->baseUrl().'/images/'.$row['photo'];?>">
								</td>
							</tr>
							<tr style="height: 0;line-height: 18px">
								<td >
									&nbsp;&nbsp;Name
								</td>
								<td >
									: <span style="font-family: 'Khmer OS Muol Light';"><?php echo $row['stu_enname'];?></span>
								</td>
							</tr>
							<tr style="height: 0;line-height: 18px">
								<td>&nbsp;&nbsp;ភេទ/Gender</td>
								<td>: <?php echo $sex_kh."/".$sex_en;?></td>
							</tr>
							<tr style="height: 0;line-height: 18px">
								<td >
									&nbsp;&nbsp;<?php if($row['dept']<=2){echo 'ថ្ងៃខែឆ្នាំកំណើត';}else{echo 'D.O.B';}?>
								</td>
								<td>
									: <label id="dob<?php echo $i;?>"></label>
									<script type="text/javascript">
									<?php if($row['dob']==null || $row['dob']==''){ ?>
											dob = '';
									<?php }else{ if($row['dept']<=2){ ?>
												dob = 'ថ្ងៃទី ' + convertEnglishToKhmerNumber('<?php echo date('d',strtotime($row['dob']));?>')+' ខែ '+getKHMonthByNumber('<?php echo date('m',strtotime($row['dob']));?>')+' ឆ្នាំ '+ convertEnglishToKhmerNumber('<?php echo date('Y',strtotime($row['dob']));?>');
											<?php }else{?>
												dob = "<?php echo date('d F Y',strtotime($row['dob']));?>";
											<?php }?>
											dojo.byId('dob<?php echo $i;?>').innerHTML=dob;
									<?php }?>
									</script>
								</td>
							</tr>
							<tr style="height: 0;line-height: 18px">
								<td >
									&nbsp;&nbsp;<?php if($row['dept']<=2){echo 'សិស្សថ្នាក់';}else{echo 'Level';}?>
								</td>
								<td colspan="3">
									: <?php  echo $row['grade'];?>
								</td>
							</tr>
							<tr style="height: 0;line-height: 18px">
								<td >
									&nbsp;&nbsp;<?php if($row['dept']<=2){
										echo 'ផុតកំណត់';}else{echo 'Expired Date';}?>
								</td>
								<td colspan="3">
								: <label id="year<?php echo $i;?>"></label>
									<script type="text/javascript">
										<?php if($row['dept']<=2){?>
											kh_date = 'ថ្ងៃទី ' + convertEnglishToKhmerNumber('<?php echo 30 //date('d',strtotime($row['end_date']));?>')+' ខែ '+getKHMonthByNumber('<?php echo 12;//date('m',strtotime($row['end_date']));?>')+' ឆ្នាំ '+ convertEnglishToKhmerNumber('<?php echo date('Y');?>');
										<?php }else{?>
											kh_date = '<?php echo date('F d , Y',strtotime($row['end_date']));?>';
										<?php }?>
										dojo.byId('year<?php echo $i;?>').innerHTML=kh_date;
									</script>
								</td>
							</tr>
							<tr>
								<td colspan="4" valign="top">
									<table width="100%" style="font-size:11px;font-family: 'Khmer OS Battambang';color:#00007b;">
										<tr>
											<td width="58%">
												<div style="margin-top: -3px;">
													<?php if($row['dept']<=2){echo 'ធ្វើនៅថ្ងៃទី ';}else{echo 'Date : ';}?><label id="create_date<?php echo $i;?>"></label>
													<script type="text/javascript">
														<?php if($row['dept']<=2){?>
															create_date = convertEnglishToKhmerNumber('<?php echo date('d');?>')+' ខែ '+getKHMonthByNumber('<?php echo date('m');?>')+' ឆ្នាំ '+ convertEnglishToKhmerNumber('<?php echo date('Y');?>');
														<?php }else{?>
															create_date = '<?php echo date('F d , Y');?>';
														<?php }?>
														dojo.byId('create_date<?php echo $i;?>').innerHTML=create_date;
													</script>
												</div>
											</td>
											<td width="4%" >
											</td>
											<td width="38%" align="center" valign="top" colspan="2">
												<div style="margin-top:-20px;font-family: 'Khmer OS Muol Light';">នាយក</div><br /><br /><?php echo $tr->translate("PRINCIPAL_NAME");?>
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<?php if($i==$con){$con = $con + 4;?>
				<table width="100%" height="100px" border="0">
					<tr>
						<td>&nbsp;</td>
					</tr>
				</table>
			
			<?php }?>
		<?php }}?>
		</div>
		<table width="100%">
			<tr>
				<td align="center">
					<iframe name=print_frame width=0 height=0 frameborder=0 src=about:blank></iframe>
					<button dojoType="dijit.form.Button" id="printall" iconClass="dijitEditorIcon dijitEditorIconPrint"
						type="button" onclick="print();">Print ID Card</button>
				</td>
			</tr>
		</table>
	</div>
</div>
<script type="text/javascript">
	dojo.ready(function(){
		print();
	});
	function print(){
		window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint1').innerHTML;
	    window.frames["print_frame"].window.focus();
	    window.frames["print_frame"].window.print();
	    <?php 
			defined('BASE_URL')	|| define('BASE_URL', Zend_Controller_Front::getInstance()->getBaseUrl());
    		$tr = Application_Form_FrmLanguages::getCurrentlanguage();
    		$url_copy =$this->url(array('module'=>'allreport','controller'=>'allstudent','action'=>'rpt-all-student'),null,true);
    	?>
    	window.location.href = '<?php echo $url_copy;?>';
	}
</script>