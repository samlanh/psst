<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
?>	
<script type="text/javascript">
function getKHMonthByNumber(m){
	var monthName=[
		"មករា",
		"កុម្ភៈ",
		"មីនា",
		"មេសា",
		"ឧសភា",
		"មិថុនា",
		"កក្កដា",
		"សីហា",
		"កញ្ញា",
		"តុលា",
		"វិច្ឆិកា",
		"ធ្នូ",
		];
		return (monthName[m-1]);
}	
</script>
<div class="dijitHidden" style="width: 22cm !important; height: 11cm ; padding: 0px; margin: 0px;">
	<div data-dojo-type="dijit.Dialog" align="center" data-dojo-props="title:'<?php echo $tr->translate("PAYMENT_RECEIPT");?>'" id="print_income" >
		<div id="divPrint1" >
		<style>
				.card-content-student-print{
							background-image: url('<?php echo $this->baseUrl()."/images/card/student_card_bg.jpg";?>');
						 background-size: 100%;background-repeat: no-repea
						 page-break-after:always					
						}
					.profile-card-block {
					    position: relative;
					}
					.profile-card-block .photo {
					    text-align: center;
					    width: 100%;
					    position: absolute;
					    top: 96px;
						left: -0.58px;
					}
					.photo img {
					    width: 70.7px;
					    height: 92px;
					}
					.name-card-block {
					    position: relative;
					}
			
					.name-card-block ul.list-data {
					    list-style-type: none;
					    padding: 0;
					    width: 100%;
					    position: absolute;
					    text-align: center;
					    top: 182.5px;
					    color: #01049f;
					    font-weight: bold;
					    font-size: 12px;
					}	
				.name-card-block ul.list-data li{
					line-height: 16px;	    
				}
				.name-card-block ul.list-data li.sdudent-id{
						margin-top:10px;
						color: #01731b;
					}
				.foot-left-block {
				    position: relative;
				}
				.qrimages {
				    position: absolute;
				    top: 262px;
				    width: 100%;
				    text-align: center;
				}
				.qrimages img {
				    width: 80%;
				    text-align: center;
				}
		</style>
		<?php $con=4;
			$i=0; $student= count($this->rs);
		if(!empty($this->rs)){foreach ($this->rs AS $key => $row){ $i++;
			if(!empty($row['photo'])){
				if (file_exists(PUBLIC_PATH."/images/photo/".$row['photo'])){
				$image = $this->baseUrl().'/images/photo/'.$row['photo'];
				}
			}
			?>
				<?php if ($key==0){?>
				<div style="display:inline-block; margin:10px 0; height:1px; width:100%; background: #000"></div>
				<?php }?>
				<?php if ($i==1){?>
				<div style="display:inline-block; margin-right:10px; height:8.3cm; width: 1px; background: #000"></div>
				<?php }?>
				<div class="card-content-student-print" style=" display:inline-block; margin-right:10px line-height: 16.285px;  width: 5.1cm; height:8.3cm;   color: #3f3f95; font-family: 'Times New Roman', sans-serif,'Kh Battambang','Khmer Battambang'; ">
					<div class="profile-card-block">
						<div class="photo">
							<img  src="<?php echo $image;?>" alt="profile-image" >
						</div>
					</div>
					<div class="name-card-block">
						<ul class="list-data">
							<li><span class="title_value">&nbsp;<?php echo $row['stu_khname'];?></span></li>
							<li><span class="title_value">&nbsp;Grade: <?php echo str_replace("Grade","",$row['group_name']);?></span></li>
							<li class="sdudent-id"><span class="title_value">&nbsp;ID: <?php echo $row['stu_code'];?></span></li>
						</ul>
					</div>
				<?php  
				$prefix = $this->data["prefix_barcode_grade_school"];
				$barcode = $prefix."-".$row['stu_code']."-".date("y");
				$url = $this->url(array("module"=>"default","controller"=>"index","action"=>"barcode","codereader"=>$barcode),null,true);?>
					<div class="foot-left-block">
						<div class="qrimages">
							<img  src="<?php echo $url;?>" alt="profile-image" >
						</div>
					</div>
					<div class="foot-right-block">
					</div>
				</div>	
				<?php if ($student>1){?>
				<div style="display:inline-block; margin:0 10px; height:8.3cm; width: 1px; background: #000"></div>
				<?php }?>
				<?php if ($i==4){ $i=0;?>
				<div style="display:inline-block; margin:10px 0; height:1px; width:100%; background: #000"></div>
				<?php }?>			
		<?php }}?>
		</div>
		<table width="100%">
			<tr>
				<td align="center">
					<iframe name=print_frame width=0 height=0 frameborder=0 src=about:blank></iframe>
					<button dojoType="dijit.form.Button" id="printall" iconClass="dijitEditorIcon dijitEditorIconPrint"
						type="button" onclick="print();">Print ID Card</button>
				</td>
			</tr>
		</table>
	</div>
</div>
<script type="text/javascript">
	dojo.ready(function(){
		print();
	});
	function print(){
		loadingBlock();
	  	 var contents = document.getElementById("divPrint1").innerHTML;
	 	  var frame1 = document.createElement('iframe');
	    frame1.name = "frame1";
	    frame1.style.position = "absolute";
	    frame1.style.top = "-1000000px";
	    document.body.appendChild(frame1);
	    var frameDoc = (frame1.contentWindow) ? frame1.contentWindow : (frame1.contentDocument.document) ? frame1.contentDocument.document : frame1.contentDocument; frameDoc.document.open();
	    frameDoc.document.write('<html><head><title>Employee ID</title>');
	    frameDoc.document.write('</head><body>');
	    frameDoc.document.write(contents);
	    frameDoc.document.write('</body></html>');
	    frameDoc.document.close();
	    setTimeout(function () {
	        window.frames["frame1"].focus();
	        window.frames["frame1"].print();
	        document.body.removeChild(frame1);
	        HideloadingBlock();
			<?php 
				defined('BASE_URL')	|| define('BASE_URL', Zend_Controller_Front::getInstance()->getBaseUrl());
				$tr = Application_Form_FrmLanguages::getCurrentlanguage();
				$url_copy =$this->url(array('module'=>'allreport','controller'=>'allstudent','action'=>'rpt-all-student'),null,true);
			?>
			window.location.href = '<?php echo $url_copy;?>';
	    }, 10000);
	   return false;

	    
	}
</script>