<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle('Report Student Drop'); 
	echo $this->headTitle(''); 
	$frm =  $this->form_search;
	//print_r($this->rs);
	$db_sub=new Allreport_Model_DbTable_DbRptStudentDrop();
	
	$day = array(
			1=>'Monday',
			2 =>'Tuesday',
			3 =>'Wednesday',
			4=>'Thursday',
			5=>'Friday',
	);
	
?>	
<div style="width: 28cm;margin: 0 auto;">
<form  id='foundation_class' action="" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
		
		<table width="100%" cellspacing="5">
	       <tr>
	           <td><?php echo $frm->getElement("title");?></td>
	           <td> <?php echo $frm->getElement("study_year");?></td>
	           <td> <?php echo $frm->getElement("group");?></td>
	           <td> <?php echo $frm->getElement("room");?></td>
	           <td> <?php echo $frm->getElement("grade");?></td>
			</tr>
			<tr>
			  <td> <?php echo $frm->getElement("start_date");?></td>
			   <td> <?php echo $frm->getElement("end_date");?></td>
			   <td>
			   		<button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" name="search"  type="submit"><?php echo $tr->translate("SEARCH");?></button>
	       	   </td>
	       </tr>
		</table>
</form>		
</div>
	<div style="border: 1px dotted #000;background: #fff;width: 27cm;margin: 0 auto;min-height: 27cm;padding: 0.5cm;">	
		<div id="divPrint">
							<table style="background:#fff; margin: 0 auto;width: 100%; font-family: 'Times New Roman','Kh Battambang','Khmer Battambang';">
								<tr>
									<td width="25%" align="left">
										<img style="width: 40%;" alt="<?php ?>" src="<?php echo $this->baseUrl().'/images/logo.png'?>"><br />
									</td>
									<td align="center">
										<strong​​ style="font-weight:bold;color:#000; font-size: 17px;font-family:'Khmer MEF2';"><?php echo $tr->translate("CUSTOMER_BRANCHCUSTOMER_BRANCH");?></strong><br />										
										<strong style="font-weight:bold;color:#000; font-size: 17px;font-family:'Khmer MEF2';"><?php echo $tr->translate("RPT_RESCHEDULE_BYGROUP");?></strong><br />
										<strong​​ style=" font-weight:bold;font-family: Arial Black;color:#000; font-size: 14px;font-family:'Khmer MEF2';"><?php if(!empty($this->search['start_date'])){?><?php echo date('d-M-Y',strtotime($this->search['start_date']));?><?php echo $tr->translate("TO");?><?php echo date('d-M-Y',strtotime($this->search['end_date']));}?> </strong>
									</td>
									<td width="25%" align="right">
									</td>
								</tr>
							<style>
								table tr th{
									border: 1px solid #000;	
								}
								.hover:hover{background: #ccc;}
								table { page-break-inside:auto }
								  tr{ page-break-inside:avoid; page-break-after:auto; }
								#header {
								  display: table-header-group;
								  page-break-inside:avoid; page-break-after:auto;
								}
								tr.head_schedule th {
								    padding:0;
								    text-align: center;
								}
								.head_schedule{background:#9db5fb;}
								ul.subject{list-style: none;line-height: 20px;}
							</style>
								<tr>
									<td colspan="3">
									<?php $title=0; $titles=0; $year='';$group='';$hour=''; if(!empty($this->rs)) 
										foreach ($this->rs As $rs){
										$timestudy = $db_sub->getTimeSchelduleByYGS($rs['year_id'],$rs['group_id']);
										?>
										<table border="1" cellpadding="2"​ style="font-family:'Khmer os battambang';margin:0 auto;width:100%; border-collapse: collapse;white-space: nowrap;border:1px solid #000;" >
											<thead>
												<tr>
													<th align="left" colspan="7" style="border:1px solid #fff;border-bottom: solid 1px #000;">
													<ul class="subject">
														<li><?php echo $tr->translate("ROOM");?>:&nbsp;<?php echo $rs['room_name']?></li>
														<li><?php echo $tr->translate("GROUP");?>:&nbsp;<?php echo $rs['group_code']?></li>													
													</ul>
													</th>
												</tr>
												<tr class="head_schedule" style="font-size:14px;border-top:1px solid #000 !important;" align="center" >
													<th rowspan="2" style="border:1px solid #000 !important;"><?php echo $tr->translate("TIME");?></th>
													<th colspan="5" style="border:1px solid #000 !important;"><?php echo $tr->translate("DAYS");?></th>
												</tr>
												<tr class="head_schedule" style="font-size:14px;" align="center" >
												<?php foreach ($day as $key => $days){?>
													<th style="width:18%;"><?php echo $tr->translate($days);?></th>
												<?php }?>
												</tr>
											</thead>
										<?php $session='';foreach($timestudy As $time){
											if($time['from_hour']<=12){
												if($title==0){?>
												<tr  align="center" >
													<th colspan="6" style="font-size:12px; padding: 0px 2px; text-decoration: underline;"><?php echo  $tr->translate("Morning");?></th>
												</tr>
										        <?php $title=1;}
											}else{
												if($titles==0){
									        ?>
									        	<tr  align="center" >
													<th colspan="6" style="font-size:12px; padding: 5px 2px; text-decoration: underline;"><?php echo  $tr->translate("Afternoon");?></th>
												</tr>
									        <?php $titles=1;}
												}
									        ?>
												<tr class="hover" style="font-size:13px; height: 20px;" align="center" >
													<td align="center" style="min-width:50px;white-space: nowrap;"><strong><?php echo $time['times'];?></strong></td>
													<?php foreach ($day as $key => $days){
														$subjecNteacher = $db_sub->getSubjectTeacherByScheduleAndGroup($rs['year_id'],$rs['group_id'],$time['times'], $key)
													?>
													<td align="center">
														<?php 
													 	if (!empty($subjecNteacher)){
													 		if (!empty($subjecNteacher['subject_name'])){
													 			echo "(".$subjecNteacher['subject_name'].")<br />";
													 		}
													 		if (!empty($subjecNteacher['teacher_name'])){echo "".$subjecNteacher['teacher_name']."<br />";}
															if (!empty($subjecNteacher['teacher_phone'])){echo "".$subjecNteacher['teacher_phone']."";}
													   }?>
													</td>
													<?php }?>
												</tr>
										 <?php }?>						 
										 <?php  foreach($db_sub->getSubjectListByYG($rs['year_id'],$rs['group_id'] ) As $key=>$rs_list){
										 	if($rs_list['total_hour']>1){
										        $h_label='hrs';
										 	}else{
										 		$h_label='hr';
										 	}
										 	
										 	$totalTime = $db_sub->getSubjectForCalculateTime($rs['year_id'], $rs['group_id'], $rs_list['subject_id'])
										 	?>
										 <tr>
										    <td style="border-left: 1px solid #fff;border-right: 1px solid #fff;border-bottom: 1px solid #fff;padding:0px;line-height: 20px;" colspan="2"><?php echo $key+1?>.&nbsp;<?php echo $rs_list['subject_name']?>:&nbsp;<?php echo $totalTime;//$rs_list['total_hour'].''.$h_label?></td>
										 </tr>
										 <?php }?>
										  <tr >
										 	<td colspan="7" align="right" style="border: 1px solid #fff;">
										 	Phnom Penh,&nbsp;<?php echo date('d F Y');?>
										 	</td>
										 </tr>
										</table>											
										<br/>
									<?php  }?>
									</td>
								</tr>
								<tr>
									<td colspan="3">&nbsp;</td>
								</tr>
								 
								<tr >
									<td align="center" width="25%">
										<span style="font-size: 14px;"><?php echo $tr->translate('VERIFIED_BY')?></span>
									</td>
									<td  width="50%">
										&nbsp;
									</td>
									<td align="center"  width="25%">
										<span style="font-size: 14px;text-align: right;"><?php echo $tr->translate('PREPARED_BY')?></span>
									</td>
								</tr>
							</table>
		</div>		
	</div>