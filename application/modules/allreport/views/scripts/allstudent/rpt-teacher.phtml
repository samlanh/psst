<?php
	$_dbgb = new Application_Model_DbTable_DbGlobal();
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle('របាយការណ៍ព័ត៌មានគ្រូ'); 
	echo $this->headTitle(''); 
	$frm =  $this->frm_search;
?>	
<style>
.hover:hover{ background:#ccc;}</style>
<div style="min-height:10cm; margin:0 auto; padding:0.5cm 0.5cm 0cm 0.5cm">	
	<form  id='foundation_class' action="<?php echo $this->url(array('module'=>'allreport','controller'=>'allstudent','action'=>'rpt-teacher')); ?>" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
		<table width="100%">
	       	<tr>
	           <td><?php echo $frm->getElement("title");?></td>
	           <td><?php echo $frm->getElement("branch_id");?></td>
	           <td><?php echo $frm->getElement("degree");?></td>
	           <td><?php echo $frm->getElement("staff_type");?></td>
	       	</tr>
	       	<tr>
	           <td><?php echo $frm->getElement("nationality");?></td>
	           <td><?php echo $frm->getElement("teacher_type");?></td>
			   <td><?php echo $frm->getElement("status_search");?></td>
			   <td><button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" name="search"  type="submit"><?php echo $tr->translate("SEARCH");?></button></td>
		 	</tr>
		</table>		
	</form>
<div id="divPrint">
		<table  style="background:#fff; margin: 0 auto; width: 100%; ">
			<tr>
				<td width="10%" align="right">
					<img style="height: 90px" alt="<?php ?>" src="<?php echo $this->baseUrl().'/images/logo.png'?>"><br />
				</td>
				<td width="60%" align="center">
				    <strong​​ style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 17px;font-family:'Khmer MEF2';"><?php echo $tr->translate("CUSTOMER_BRANCH");?></strong><br />
					<strong​​ style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 17px;font-family:'Khmer MEF2';"><?php echo $tr->translate("REPORT_INFORMATION_TEACHER");?></strong><br/>
				</td>
				<td width="5%" align="right">
				</td>
			</tr>
		<style>
			table tr th{
				border: 1px solid #000;	
				text-align: center;
			}
			table {page-break-inside:auto }
			tr{ page-break-inside:avoid; page-break-after:auto; }
			#header {
			  display: table-header-group;
			  page-break-inside:avoid; page-break-after:auto;
			}
		</style>
			<tr>
				<td colspan="3">
					<div id="exportExcel">
						<table cellpadding="4"​ style=";font-family:'Khmer OS Battambang' ; margin:0 auto;width:100%;border:1px solid #000; border-collapse: collapse;white-space: nowrap;"  border="1" >
							<thead>
							<tr style="font-size:12px; height: 25px;background:#ccd9ff;font-weight: bold;" align="center" >
								<th class=""><input type="checkBox" onclick="checkAllTeacher('<?php echo count($this->rs);?>');" name="checkall" id="checkall" /></th>
								<th><?php echo $tr->translate("NUM");?></th>
								<th><?php echo $tr->translate("BRANCH_NAME");?></th>
								<th><?php echo $tr->translate("ID_NUMBER");?></th>
								<th><?php echo $tr->translate("TEACHER_NAME");?></th>
								<th><?php echo $tr->translate("SEX");?></th>
								<th><?php echo $tr->translate("NATIONALITY");?></th>
								<th><?php echo $tr->translate("TYPE");?></th>
								<th><?php echo $tr->translate("DEGREE");?></th>
								<th><?php echo $tr->translate("TEACHER_TYPE");?></th>
								<th><?php echo $tr->translate("POSITION");?></th>
								<th><?php echo $tr->translate("PHONE");?></th>
								<th><?php echo $tr->translate("EMAIL");?></th>
								<th><?php echo $tr->translate("NOTE");?></th>
								<th><?php echo $tr->translate("STATUS");?></th>
								<input type="hidden" name="id_selected" id="id_selected" dojoType="dijit.form.TextBox" />
							</tr>
							</thead>
							<?php $i=0;$degree=0; if(!empty($this->rs)){ foreach ($this->rs AS $row) { $i++;?>
							<tr style="font-size:12px; height: 23px;" align="center" class="hover" >
								<td class="">
									<input style="height: 15px;margin-top: 5px;" type="checkBox" onClick="checked_id(<?php echo $i?>)" name="check_box<?php echo $i?>" id="check_box<?php echo $i?>" />
									<input type="hidden" name="id<?php echo $i;?>" id="id<?php echo $i;?>" value="<?php echo $row['id'];?>" dojoType="dijit.form.TextBox" />
								</td>
								<td ><?php echo $i;?></td>
								<td ><?php echo $row['branch_name'];?></td>
								<td ><?php echo $row['teacher_code'];?></td>
								<td align="left">&nbsp;&nbsp;&nbsp;<?php echo $row['teacher_name_kh'];?>&nbsp;</td>
								<td align="left">&nbsp;&nbsp;&nbsp;<?php echo $row['sex'];?>&nbsp;</td>
								<td ><?php echo $row['nationality'];?></td>
								<td ><?php echo $row['staff_type'];?></td>
								<td ><?php echo $row['degree'];?></td>
								<td ><?php echo $row['teacher_type'];?></td>
								<td ><?php echo $row['position_add'];?></td>
								<td align="left">&nbsp;<?php echo $row['tel'];?></td>
								<td><?php echo $row['email'];?></td>	
								<td><?php echo $row['note'];?></td>
								<td><?php echo $row['status'];?></td>
							</tr>
						<?php }}?>	
						</table>	
					</div>	
				</td>
			</tr>
			<tr>
				<td colspan="3">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="3">&nbsp;</td>
			</tr>
			<tr >
				<td colspan="3" width="100%">
					<table width="100%" style="font-family:'Khmer OS Battambang';">
						<tr>
							<td  width="25%" align="center">
								<span style=" font-size: 14px;"><?php echo $tr->translate('VERIFIED_BY')?></span>
							</td>
							<td  width="50%">
								&nbsp;
							</td>
							<td align="center"  width="25%">
								<span style="font-size: 14px;text-align: right;"><?php echo $tr->translate('PREPARED_BY')?></span>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		</div>
</div>
<table width="100%">
		<tr>
			<td align="center">
				<button dojoType="dijit.form.Button" id="printselected" iconClass="dijitEditorIcon dijitEditorIconPrint" type="button" onclick="printSelected();"><?php echo $tr->translate("SINGLE_IDPRINT");?></button>
				<input type="button" onclick="printIDCard();" dojoType="dijit.form.Button" label="<?php echo $tr->translate("PRINTED_ID");?>" iconClass="dijitEditorIcon dijitEditorIconPrint" />
			</td>
		</tr>
</table>
<div class="dijitHidden" style="width: 22cm !important; height: 11cm ; padding: 0px; margin: 0px;">
	<div data-dojo-type="dijit.Dialog"  align="center" data-dojo-props="title:'<?php echo $tr->translate("PAYMENT_RECEIPT");?>'" id="print_income" >
		
		<div id="print_teacher_card" >
			<style>
					.card-content-student-print{
						background-image: url('<?php echo $this->baseUrl()."/images/card/teacher_card_bg.jpg";?>');
						 background-size: 100%;background-repeat: no-repea
						 page-break-after:always;					
					}
					.card-content-print.staff-2{
						 background-image: url('<?php echo $this->baseUrl()."/images/card/staff_card_bg.jpg";?>');
						 background-size: 100%;background-repeat: no-repeat;								
						}
					.profile-card-block {
					    position: relative;
					}
					.profile-card-block .photo {
					    text-align: center;
					    width: 100%;
					    position: absolute;
					    top: 96px;
						left: -0.58px;
					}
					.photo img {
					    width: 70.7px;
					    height: 92px;
					}
					.name-card-block {
					    position: relative;
					}
			
					.name-card-block ul.list-data {
					    list-style-type: none;
					    padding: 0;
					    width: 100%;
					    position: absolute;
					    text-align: center;
					    top: 175.9px;
					    color: #01049f;
					    font-weight: bold;
					    font-size: 12px;
					}	
				.name-card-block ul.list-data li{
					line-height: 15px;	    
				}
				.name-card-block ul.list-data li.sdudent-id{
						margin-top:10px;
						color: #01731b;
					}
				.foot-left-block {
				    position: relative;
				}
				.qrimages {
				    position: absolute;
				    top: 262px;
				    width: 100%;
				    text-align: center;
				}
				.title_value {
					top: 262px;
					color: blue;
					font-size: 10px;
				}
				.sdudent_id{
					font-size: 12;
					color: red;
				}
				.qrimages img {
				    width: 80%;
				    text-align: center;
					height: 17px;}
				
				.validdate {
				    position: relative;
				}
				.validdate .exp_date {
					color: #01049f;
				    position: absolute;
				    top: 250px;
				    right: 5px;
				    font-size: 5px;
				    font-weight: 700 !important;
				}
	</style>
		<?php $con=4;$i=0; $teacher= count($this->rs);
			if(!empty($this->rs)){foreach ($this->rs AS $key=> $row){ $i++;?>
					<?php 
					$prefix="";
					$validDate="";
						$stu_name = $row['teacher_name_kh'];
						$image = $this->baseUrl().'/images/no-profile.png';
						if(!empty($row['photo'])){
							if (file_exists(PUBLIC_PATH."/images/photo/".$row['photo'])){
							$image = $this->baseUrl().'/images/photo/'.$row['photo'];
							}
							
						}
						?>
						<div class="card-content-student-print <?php echo "card".$row['schoolOption'];?>" style=" display:inline-block; margin-right:10px line-height: 16.285px;  width: 5.1cm; height:8.3cm;   color: #3f3f95; font-family: 'Times New Roman', sans-serif,'Kh Battambang','Khmer Battambang'; ">
                    		<div class="profile-card-block">
                    			<div class="photo">
                    				<img  src="<?php echo $image;?>" alt="profile-image" >
                    			</div>
                    		</div>
                    		<div class="name-card-block">
	                    		<ul class="list-data">
	                    			<li><span class="title_value">&nbsp;<?php echo $stu_name;?></span></li>
                    				<li><span class="title_value">&nbsp;Position: <?php echo str_replace("position","",$row['position_add']);?></span></li>
                    				<li><span class="title_value">&nbsp;Dept: <?php echo str_replace("dept","",$row['dept_name']);?></span></li>
									<li><span class="sdudent-id">&nbsp;ID: <?php echo $row['teacher_code'];?></span></li>
                    			</ul>
                    		</div>
                    		 
                    	<?php  
                    	$barcode = $prefix."-".$row['teacher_code']."-".date("y",strtotime($validDate));
                    	$url = $this->url(array("module"=>"default","controller"=>"index","action"=>"barcode","codereader"=>$barcode),null,true);?>
	                    	<div class="foot-left-block">
                    			<div class="qrimages">
                    				<img  src="<?php echo $url;?>" alt="profile-image" >
                    			</div>
                    		</div>
                    	</div>	
                    	<?php if ($teacher>1){?>
                    	<div style="display:inline-block; margin:0 10px; height:8.3cm; width: 1px; background: #000"></div>
                    	<?php }?>
                    	<?php if ($i==4){ $i=0;?>
                    	<div style="display:inline-block; margin:10px 0; height:1px; width:100%; background: #000"></div>
                    	<?php }?>
		<?php }
			}?>
		</div>		
	</div>
</div>
<script type="text/javascript">
	function setID(type){
		if(type==1){
			id = dijit.byId('stu_id').get('value');
			dijit.byId('stu_name').attr('value',id);
		}else{
			id = dijit.byId('stu_name').get('value');
			dijit.byId('stu_id').attr('value',id);
		}
	}

	function printSelected(){
		<?php 
			defined('BASE_URL')	|| define('BASE_URL', Zend_Controller_Front::getInstance()->getBaseUrl());
    		$tr = Application_Form_FrmLanguages::getCurrentlanguage();
    		$url_copy =$this->url(array('module'=>'allreport','controller'=>'allstudent','action'=>'idselectform'));
    	?>

    	 id_selected = dijit.byId('id_selected').get('value');
		 if(id_selected!=''){
			window.location.href = '<?php echo $url_copy;?>'+'/id/'+id_selected;
		 }else{
			alert('Please select record you want to print');
			return false;
		 }
	}

	function print(){
		window.frames["print_frame"].document.body.innerHTML=dojo.byId('print_teacher_card').innerHTML;
	    window.frames["print_frame"].window.focus();
	    window.frames["print_frame"].window.print();
	}
	
	function printIDCard(){
		loadingBlock();
	  	 var contents = document.getElementById("print_teacher_card").innerHTML;
	 	  var frame1 = document.createElement('iframe');
	    frame1.name = "frame1";
	    frame1.style.position = "absolute";
	    frame1.style.top = "-1000000px";
	    document.body.appendChild(frame1);
	    var frameDoc = (frame1.contentWindow) ? frame1.contentWindow : (frame1.contentDocument.document) ? frame1.contentDocument.document : frame1.contentDocument; frameDoc.document.open();
	    frameDoc.document.write('<html><head><title>Employee ID</title>');
	    frameDoc.document.write('</head><body>');
	    frameDoc.document.write(contents);
	    frameDoc.document.write('</body></html>');
	    frameDoc.document.close();
	    setTimeout(function () {
	        window.frames["frame1"].focus();
	        window.frames["frame1"].print();
	        document.body.removeChild(frame1);
	        HideloadingBlock();
	    }, 10000);
	   return false;
	}

	function checkAllTeacher(array_length){
		dijit.byId('id_selected').attr('value','');
		if(dojo.byId('checkall').checked){
			for(var j=1;j<=array_length;j++){
				$("#check_box"+j).attr('checked', 'checked');
				checked_id(j);
			}
		}else{
			for(var j=1;j<=array_length;j++){
				$("#check_box"+j).removeAttr("checked");
				checked_id(j);
			}
		}
	}
	function checked_id(index){
		stu_id = dijit.byId('id'+index).get('value');
		if(dojo.byId('check_box'+index).checked){
			
			if($("#id_selected").val()!="") {
				var identity = $("#id_selected").val();
				$("#id_selected").val(identity+','+stu_id);
			}else{
				$("#id_selected").val(stu_id);
			}
		}else{
			var identity = $('#id_selected').val();
			var arrays = identity.split(',');
			for(var i=0;i<arrays.length;i++) {
			if(arrays[i] == stu_id) arrays.splice(i,1);
			}
			var strings = arrays.join(',');
			$('#id_selected').val(strings);
		}
	}
</script>