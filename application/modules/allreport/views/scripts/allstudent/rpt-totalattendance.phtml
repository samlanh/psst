<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle($tr->translate("Total Student Attendance List")); 
	echo $this->headTitle();
	$base_url = Application_Form_FrmMessage::getUrl("/");
?>	
	<style>
	.hide{visibility:visible !important;
	}
	</style>
<div style="min-height:15cm; margin:0 auto; padding:0.5cm 0.5cm 0cm 0.5cm">
	<div class="card-box">
    	<div class="col-sm-12 border-botom">
		   	<div class="col-sm-8 pd-0">
	    		<h4 class="m-b-0"><i class="fa fa-file " aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('Total Student Attendance List');?></h4>
    		</div>
    		<div class="col-sm-4 text-right">
    		</div>
    	</div>
    </div>
	<div id="divPrint">
		<table style="background:#fff; margin: 0 auto; width: 100%;" >
				<tr>
					<td colspan="3"><?php echo $this->rsheader;?></td>
				</tr>
				<tr class="line"><td colspan="3"></td></tr>
				<tr>
					<td>&nbsp;</td>
				</tr>
				<tr>
					<td style="width:200px;">
					</td>
					<td align="center" >
						<strong style="font-weight:bold;color:#4839bd; font-size: 14px;font-family:'Khmer MEF2';"><?php echo $tr->translate("Total Student Attendance List");?></strong><br />
						<strong style="font-weight:bold;color:#4839bd; font-size: 12px;font-family:'Khmer MEF2';white-space: nowrap;"><?php echo $tr->translate("ACADEMIC_YEAR");?> : <?php echo $this->rr['academic'];?></strong><br />
						<strong style="font-weight:bold;color:#4839bd; font-size: 12px;font-family:'Khmer MEF2';"><?php echo $tr->translate("STUDY_GROUP");?> : <?php echo $this->rr['group_code'];?> </strong><br />
					</td>
					<td style="width:200px;"></td>
				</tr>
				<tr>
					<td>&nbsp;</td>
				</tr>
				<tr>
					<td colspan="3" id="exportExcel">
						<table cellpadding="3" class="padd" width="99%" border="1" align="center" style="border-collapse:collapse;color:#4839bd;white-space:nowrap;font-family:Time New Roman , Khmer OS Battambang;"  >
							<style> td{padding:0 3px; }
							.cheader{height: 30px;font-weight: bold; background: #ccc; white-space: nowrap;}
							table{ page-break-inside:auto;font-family:Arial,'Khmer OS Battambang'; }
							tr{ page-break-inside:avoid; page-break-after:auto }
							#header {
							  display: table-header-group;
							  page-break-inside:avoid; page-break-after:auto;
							}
							.hover:hover{ background: #ccc;}
							tr.line td{ border-bottom: 2px solid #000;padding-top: 5px; }
							</style>
							<thead>
							<tr style="background: #ccd9ff;" class="cheader" align="center" >
								<td><?php echo $tr->translate("NUM");?></td>
								<td><?php echo $tr->translate("STUDENT_ID");?></td>
								<td><?php echo $tr->translate("STUDENT_NAMEKHMER");?></td>
								<td><?php echo $tr->translate("NAME_ENGLISH");?></td>
								<td><?php echo $tr->translate("SEX");?></td>
								<td align="center"><?php echo $tr->translate("ABSENT");?></td>
								<td align="center"><?php echo $tr->translate("PERMISSION");?></td>
								<td align="center"><?php echo $tr->translate("LATE");?></td>
								<td align="center"><?php echo $tr->translate("EARLY_LEAVE");?></td>			
							</tr>
							</thead>
							<?php  
							$db = new Home_Model_DbTable_DbStudent();
							$A=0;
							$P=0;
							$L=0;
							$EL=0;
							$i=0;
							$male=0;$femle=0;
							foreach ($this->rs as $row){ $i++;?>
							<tr style="font-size:12px;height: 23px;"â€‹ align="center" class="hover">
								<td><?php echo $i;?></td>
								<td><?php echo $row['stu_code'];?></td>
								<td align="left"><?php echo $row['kh_name'];?></td>
								<td align="left"><?php echo $row['en_name'];?></td>
								<td><?php echo $row['sex'];
									if($row['gender']==1){
										$male=$male+1;
									}else{
										$femle=$femle+1;
									}
								?></td>
								<?php 
								$attentence_status = $db->getSumStatusAttendence($row['stu_id'], $row['group_id']);
								$absent=0;
								$permission=0;
								$late=0;
								$early_leave=0;
								foreach ($attentence_status as $rs){
										if ($rs['attendence_status']==2){
											$absent =$absent+$rs['total'];
											$A=$A+1;
											//Absent
										}
										else if ($rs['attendence_status']==3){
											$permission =$permission+$rs['total'];
											 $P = $P+1;
											//Permission
										}
										else if ($rs['attendence_status']==4){
											$late =$late+$rs['total'];
											$L = $L+1;
											//Late
										}
										else if ($rs['attendence_status']==5){
											$early_leave =$early_leave+$rs['total'];
											$EL = $EL+1;
											//Early Leave
										}else{
											echo " ";
										}
									}
								?>
								<td width="10%" align="center"><?php echo $absent;?></td>
								<td width="10%" align="center"><?php echo $permission;?></td>
								<td width="10%" align="center"><?php echo $late;?></td>
								<td width="10%" align="center"><?php echo $early_leave;?></td>
							</tr>
							<?php }?>	
						</table>	
					</td>
				</tr>
				<tr>
				<td colspan="3" style="border:1px solid #fff;">
					<table cellpadding="0" cellspacing="0" width="100%" style="font-family:'Khmer OS Battambang';font-size: 14px">
						<tr>
							<td width="35%" align="center">
								<span style="color:#4839bd; font-size: 14px;font-family:'khmer os battambang';"><?php echo $tr->translate("CHECKANDAPPROVED");?></span><br />
								<span style="color:#4839bd; font-size: 14px;font-family:'Khmer OS Muol Light';"><?php echo $tr->translate("PRINCIPAL");?></span>
							</td>
							<td width="30%">&nbsp;</td>
							<td width="35%" align="center">
								<span style="color:#4839bd; font-size: 14px;font-family:'khmer os battambang';"><?php echo $tr->translate("CREATE_WORK_DATE");?></span><br />
								<span style="color:#4839bd; font-size: 14px;font-family:'Khmer OS Muol Light';"><?php echo $tr->translate("PREPARE_BY");?></span>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
	</div>
</div>