<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$frm =  $this->frm_search;
	$classHideHeight=classHideHeight;
?>	
<title><?php echo $tr->translate('STUDENT_BORROW_BOOK_DETAIL_REPORT');?></title>
<div style="min-height:15cm; margin:0 auto; padding:0.5cm 0.5cm 0cm 0.5cm">

		<div class="card-box">
				<div class="col-sm-12 border-botom">
					<div class="col-sm-8 pd-0">
						<h4 class="m-b-0"><i class="fa fa-file " aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('STUDENT_BORROW_BOOK_DETAIL_REPORT');?></h4>
					</div>
					<div class="col-sm-4 text-right">
					</div>
				</div>
		</div>

		<form  id='foundation_class' action="<?php echo $this->url(array('module'=>'allreport','controller'=>'library','action'=>'rpt-borrowdetail')); ?>" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
			

			<div class="form-group">
					<div class="col-md-2 col-sm-2 col-xs-12">
						<?php echo $frm->getElement("title");?>
                   </div>
                   <div class="col-md-2 col-sm-2 col-xs-12">
				   		<?php echo $frm->getElement('is_type_bor')?>
                   </div>
                   <div class="col-md-2 col-sm-2 col-xs-12">
				   		<?php echo $frm->getElement('student_name')?>
                   </div>
                   <div class="col-md-2 col-sm-2 col-xs-12">
				 		  <?php echo $frm->getElement("cood_book");?>
                   </div>
				   <div class="col-md-2 col-sm-2 col-xs-12">
				 		  <?php echo $frm->getElement("parent");?>
                   </div>
				  
					
				</div>
				<div class="form-group">
					<div class="col-md-2 col-sm-2 col-xs-12">
						<?php echo $frm->getElement('start_date');?> 
					</div>
					<div class="col-md-2 col-sm-2 col-xs-12">
						<?php echo $frm->getElement('end_date');?> 
					</div>
					

					<div class="col-md-2 col-sm-2 col-xs-12">
						<select name="is_return" id="is_return" class="fullside" dojoType="dijit.form.FilteringSelect" >
							<option value="-1"><?php echo $tr->translate('STATUS');?></option>
							<option value="1" <?php if($this->search['is_return']==1){echo "selected";}?>><?php echo $tr->translate('IS_RETURN');?></option>
							<option value="0" <?php if($this->search['is_return']==0){echo "selected";}?>><?php echo $tr->translate('NOT_RETURN');?></option>
						</select>
					</div>

					<div class="col-md-2 col-sm-2 col-xs-12">
						<select name="is_broken" id="is_broken" class="fullside" dojoType="dijit.form.FilteringSelect" >
							<option value="-1"><?php echo $tr->translate('STATUS');?></option>
							<option value="1" <?php if($this->search['is_broken']==1){echo "selected";}?>><?php echo $tr->translate('BROKEN');?></option>
							<option value="0" <?php if($this->search['is_broken']==0){echo "selected";}?>><?php echo $tr->translate('NOT_BROKEN');?></option>
						</select>
					</div>
						<div class="col-md-2 col-sm-2 col-xs-12">
							<button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button> 
					</div>
					
				</div>

			
		</form>	

		<style>
		.hover:hover{background: #ddd;}
		</style>

	<div id="divPrint">
	   <style>
				.style{
					line-height: 20px;font-size: 11px !important;
							font-family: 'Times New Roman','Khmer OS Battambang';
						}
						.hideblog{display: none;}
						.hiddenblog{display: block !important;}
						.style1:hover{ background: #ccc; }
						table tr td ul li{text-align: center;list-style: none;line-height: 25px; }
						table { page-break-inside:auto }
						tr{ page-break-inside:avoid; page-break-after:auto; }
						#header {
						display: table-header-group;
						page-break-inside:avoid; page-break-after:auto;
						margin-top: 100px;
						}
						.hide{visibility: hidden;}
						@media print {
						div.divFooter {
							position: fixed;
							top: 0;
							width: 100%;
							height: 100px;
							bottom:0px;
							margin:0;
						}
							.hide{visibility: visible; height: <?php echo $classHideHeight;?>;}
							
						}
						.center{text-align: center !important;}
						table.content-data{
							border-collapse:collapse;
							border:1px solid #000; 
							font-size:8px;
						}
						table.content-data thead tr.style {
						line-height: 25px; font-size:10px !important; padding:1px 0px; white-space: nowrap;height: 22px; 
							background: #c1d0f3;
							font-weight:600;
						}
						table.content-data tr.style {
						white-space: nowrap;
						
						}
						table.tb-footer{
							border-collapse:collapse;
							border:1px solid #000; 
							font-size:11px;
							font-family: 'Times New Roman','Khmer OS Battambang';
						}
						table.tb-footer tr{
						line-height: 14px; font-size:11px; padding:2px 0px; height: 25px;
						}
						table tr td{
							padding:0 2px;
						}
						tr.voidclass {
							background: #fff7f7;
						}
						td.centerText{
							text-align: center;
						}
						.redBold {
							font-weight: 600;
							color: #f80000;
						}
		</style>
		<table style="background:#fff;width:90%; margin: 0 auto;width: 100%;font-family:'Khmer OS Battambang';">
			<tr>
				<td width="20%" align="center">
					<img style="width:60%;" src="<?php echo $this->baseUrl().'/images/logo.png'?>">
				</td>
				<td align="center" width="60%" style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 16px;font-family:'Khmer MEF2';​">
					<span style="padding-left: 0px;  color:#000; font-size: 14px;font-family:'Times New Roman','Khmer OS Muol Light';"><?php echo $tr->translate("STUDENT_BORROW_BOOK_DETAIL_REPORT"); ?></span><br />
					
					<strong style=" font-weight:bold;font-family: Arial Black;color:#000; font-size: 13px;font-family:'Khmer MEF2';"><?php if(!empty($this->search['start_date'])){?><?php echo date('d-M-Y',strtotime($this->search['start_date']));?> <?php echo $tr->translate('TO');?> <?php echo date('d-M-Y',strtotime($this->search['end_date']));}?> </strong>
				</td>
				<td width="20%" >
					&nbsp;
				</td>
			</tr>
			<tr>
				<td colspan="3" id="exportExcel">
					<table cellpadding="5"​ class="content-data"  border="1" width="100%">
						<thead>
						<tr class="style" align="center" >
							<td scope="col"><?php echo $tr->translate("N_O"); ?></td>
							<td scope="col"><?php echo $tr->translate("BORROW_NO"); ?></td>
							<td scope="col"><?php echo $tr->translate("TYPE"); ?></td>
							<td scope="col"><?php echo $tr->translate("CODE"); ?></td>
							<td scope="col"><?php echo $tr->translate("NAME"); ?></td>
							<td scope="col"><?php echo $tr->translate("PHONE"); ?></td>
							<td scope="col"><?php echo $tr->translate("BOOK_NAME"); ?></td>
							<td scope="col"><?php echo $tr->translate("SERIAL_NO"); ?></td>
							<td scope="col"><?php echo $tr->translate("BORROW_DATE"); ?></td>
							<td scope="col"><?php echo $tr->translate("RETURN_DATE"); ?></td>
							<td scope="col"><?php echo $tr->translate("USER"); ?></td>
							<td scope="col" colspan="2"><?php echo $tr->translate("STATUS"); ?></td>
						</tr>
						</thead>
						<?php $total=0;$name="";$code="";
							$is_return = array(1=>$tr->translate("IS_RETURN"),0=>$tr->translate("NOT_RETURN"));
							$is_broken = array(1=>$tr->translate("BROKEN"),0=>$tr->translate("NOT_BROKEN"));
						?>
					<?php $i=0;$totalpaid=0;$totalbalance=0; if(!empty($this->borr_detail))foreach ($this->borr_detail AS $row) { $i++;
							if($row['borrow_type']==1){
								$name=$row['stu_name'];
								$code=$row['stu_code'];
							}else{
								$name=$row['name'];
								$code=$row['card_id'];
							}
					?>
						<tr class="style hover" align="center" >
							<td  data-label="<?php echo $tr->translate("N_O"); ?>"><?php echo $i;?></td>
							<td data-label="<?php echo $tr->translate("BORROW_NO"); ?>"><?php echo $row['borrow_no'];?></td>
							<td data-label="<?php echo $tr->translate("TYPE"); ?>">&nbsp;<?php echo $row['type'];?></td>
							<td data-label="<?php echo $tr->translate("CODE"); ?>" align="left">&nbsp;<?php echo $code;?></td>
							<td data-label="<?php echo $tr->translate("NAME"); ?>" align="left">&nbsp;<?php echo $name;?></td>
							<td data-label="<?php echo $tr->translate("PHONE"); ?>" align="left">&nbsp;<?php echo $row['phone'];?></td>
							<td data-label="<?php echo $tr->translate("BOOK_NAME"); ?>" align="left">&nbsp;<?php echo $row['book_name'];?></td>
							<td data-label="<?php echo $tr->translate("SERIAL_NO"); ?>" align="left">&nbsp;<?php echo $row['serial']." - ".$row['barcode'];?>&nbsp;</td>
							<td data-label="<?php echo $tr->translate("BORROW_DATE"); ?>"><?php echo date("d-M-Y",strtotime($row['borrow_date']));?>&nbsp;</td>
							<td data-label="<?php echo $tr->translate("RETURN_DATE"); ?>" style="<?php if($row['is_return']==0){echo 'color:red;';}?>">&nbsp;<?php echo date("d-M-Y",strtotime($row['return_date']));?>&nbsp;</td>
							<td data-label="<?php echo $tr->translate("USER"); ?>"><?php echo $row['user_name'];?></td>	
							<td data-label="<?php echo $tr->translate("STATUS"); ?>" style="<?php if($row['is_return']==0){echo 'color:red;';}?>">&nbsp;<?php echo $is_return[$row['is_return']];?></td>
							<td data-label="<?php echo $tr->translate("STATUS"); ?>" style="<?php if($row['is_broken']==1){echo 'color:red;';}?>">&nbsp;<?php echo $is_broken[$row['is_broken']];?></td>
						</tr>
					<?php }?>	 
					</table>	
				</td>
			</tr>
			<tr>
				<td colspan="3">
					<?php echo $this->rsfooteracc;?>
				</td>
			</tr>
		</table>
	</div>		
</div>
<script type="text/javascript">
function doPrint() {
	window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint').innerHTML;
    window.frames["print_frame"].window.focus();
    window.frames["print_frame"].window.print();
    hideDialog();
}
function preview()
{ 
  var disp_setting="toolbar=no,status=no,resizable=no,location=no,directories=yes,menubar=no,"; 
      disp_setting+="scrollbars=no,width=1200, height=700, left=100, top=25"; 
  var content_vlue = document.getElementById("divPrint").innerHTML; 
  
  var docprint=window.open("","",disp_setting); 
   docprint.document.open(); 
   docprint.document.write('<html><head>'); 
   docprint.document.write('</head><div style=" font-size:16px !important; margin:0px; font-family:Verdana;"><style>table th {font-size:14px !important;} table td{font-size:12px !important;}</style><center>');          
   docprint.document.write(content_vlue);          
   docprint.document.write('</center></div></html>'); 
   docprint.document.close(); 
   docprint.focus(); 
}
function exportExcel(){
	$('#exportExcel').tableExport({type:'excel',escape:'false'});
}
</script>




