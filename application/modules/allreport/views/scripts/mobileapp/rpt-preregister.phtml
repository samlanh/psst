<?php
$tr = Application_Form_FrmLanguages::getCurrentlanguage();
$this->headTitle($tr->translate('RPT_PRE_REGISTER_ACCOUNT'));
echo $this->headTitle('');
$frm =  $this->form_search;
$classHideHeight = "110px";

?>
<style>
	.hover:hover {
		background: #ccc;
	}

	.hidden {
		visibility: visible !important;
		display: table-cell !important;
	}
</style>
<div class="reportblog">
	<div class="card-box">
		<div class="col-sm-12 border-botom">
			<div class="col-sm-8 pd-0">
				<h4 class="m-b-0"><i class="fa fa-file " aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('RPT_PRE_REGISTER_ACCOUNT'); ?></h4>
			</div>
			<div class="col-sm-4 text-right">
			</div>
		</div>
	</div>
	<form id='foundation_class' action="" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
		<div class="form-group">
			<div class="col-md-2 col-sm-2 col-xs-12">
				<?php echo $frm->getElement("adv_search"); ?>
			</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
				<?php echo $frm->getElement("degree"); ?>
			</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
				<input id="grade" />
			</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
				<?php echo $frm->getElement("start_date"); ?>
			</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
				<?php echo $frm->getElement("end_date"); ?>
			</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
				<button class="button-class button-primary" iconClass="glyphicon glyphicon-search" dojoType="dijit.form.Button" showLabel="true" name="search" type="submit"><?php echo $tr->translate("SEARCH"); ?></button>
			</div>
		</div>
	</form>
	<div id="divPrint">
		<table border="0" style="background:#fff; margin: 0 auto; width: 100%; ">
			<tr>
				<td colspan="3"><?php echo $this->rsheader; ?></td>
			</tr>
			<tr>
				<td width="15%" align="center">
				</td>
				<td width="70%" align="center">
					<strong style="font-weight:normal;font-family: Arial Black;color:#000; font-size: 14px;font-family:'Khmer OS Muol Light';"><?php echo $tr->translate("RPT_PRE_REGISTER_ACCOUNT"); ?></strong><br />
					<strong style="font-weight:normal;font-family: Arial Black;color:#000; font-size: 12px;font-family:'Khmer OS Muol Light';"><?php if (!empty($this->search['start_date'])) { ?><?php echo date('d-M-Y', strtotime($this->search['start_date'])); ?> <?php echo $tr->translate("TO"); ?> <?php echo date('d-M-Y', strtotime($this->search['end_date']));
																																																																										} ?> </strong>
				</td>
				<td width="15%" align="center">
				</td>
			</tr>
			<style>
				.style {
					line-height: 20px;
					font-size: 11px !important;
					font-family: 'Times New Roman', 'Khmer OS Battambang';
				}

				.hideblog {
					display: none;
				}

				.hiddenblog {
					display: block !important;
				}

				.style1:hover {
					background: #ccc;
				}

				table tr td ul li {
					text-align: center;
					list-style: none;
					line-height: 25px;
				}

				table.content-data {
					page-break-inside: auto
				}

				tr.content-data {
					page-break-inside: avoid;
					page-break-after: auto;
				}

				#header {
					display: table-header-group;
					page-break-inside: avoid;
					page-break-after: auto;
					margin-top: 100px;
				}

				.hide {
					visibility: hidden;
				}

				@media print {
					div.divFooter {
						position: fixed;
						top: 0;
						width: 100%;
						height: 100px;
						bottom: 0px;
						margin: 0;
					}

					.hide {
						visibility: visible;
						height: <?php echo $classHideHeight; ?>;
					}

				}

				.center {
					text-align: center !important;
				}

				table.content-data {
					border-collapse: collapse;
					border: 1px solid #000;
					font-size: 8px;
					width: 100%;

				}

				table.content-data thead tr.style {
					line-height: 25px;
					font-size: 10px !important;
					padding: 2px 0px;
					white-space: nowrap;
					height: 22px;
					background: #c1d0f3;
					font-weight: 600;
				}

				table.content-data tr.style {
					white-space: nowrap;
				}

				table.tb-footer {
					border-collapse: collapse;
					border: 1px solid #000;
					font-size: 11px;
					font-family: 'Times New Roman', 'Khmer OS Battambang';
				}

				table.tb-footer tr {
					line-height: 14px;
					font-size: 11px;
					padding: 2px 0px;
					height: 25px;
				}

				table tr td {
					padding: 0 2px;
				}

				tr.voidclass {
					background: #fff7f7;
				}

				td.centerText {
					text-align: center;
				}

				.redBold {
					font-weight: 600;
					color: #f80000;
				}

				table.content-data tr td {
					padding: 1px;
				}

				table tr th {
					border: 1px solid #000;
					text-align: center;
				}

				@media print {
					@page {
						margin: 0.3cm 0.7cm 0cm 0.7cm;
						page-break-before: avoid;
						-webkit-transform: scale(0.5);
						/* Chrome, Safari 3.1+  */
						-moz-transform: scale(0.5);
						/* Firefox 3.5-15 */
						-ms-transform: scale(0.5);
						/* IE 9 */
						-o-transform: scale(0.5);
						/* Opera 10.50-12.00 */
						transform: scale(0.5);
						page: A4;
						size: portrait;
					}
				}
			</style>
			<tr>
				<td colspan="3">
					<div id="exportExcel">
						<table class="content-data" cellpadding="4" border="1">
							<thead>

								<tr class="style" style="text-align:center;">
									<th scope="col"><?php echo $tr->translate("NUM"); ?></th>
									<th scope="col"><?php echo $tr->translate("STUDENT_NAMEKHMER"); ?></th>
									<th scope="col"><?php echo $tr->translate("NAME_ENGLISH"); ?></th>
									<th scope="col"><?php echo $tr->translate("DATE_OF_BIRTH"); ?></th>
									<th scope="col"><?php echo $tr->translate("SEX"); ?></th>
									<th scope="col"><?php echo $tr->translate("PHONE"); ?></th>
									<th scope="col"><?php echo $tr->translate("EMAIL"); ?></th>
									<th scope="col"><?php echo $tr->translate("DEGREE"); ?></th>
									<th scope="col"><?php echo $tr->translate("GRADE"); ?></th>
									<th scope="col"><?php echo $tr->translate("CREATE_DATE"); ?></th>
								</tr>
							</thead>
							<?php $i = 0;
							$degree = 0;
							foreach ($this->rs as $row) {
								$i++;
								$degree = $row['degree']; ?>
								<tr align="center" class="hover style">
									<td data-label="<?php echo $tr->translate("NUM"); ?>">&nbsp;<?php echo $i; ?>&nbsp;</td>
									<td data-label="<?php echo $tr->translate("STUDENT_NAMEKHMER"); ?>" align="left">&nbsp;<?php echo $row['fullKhName']; ?>&nbsp;</td>
									<td data-label="<?php echo $tr->translate("NAME_ENGLISH"); ?>" align="left">&nbsp;<?php echo $row['lastName'] . " " . $row['firstName']; ?>&nbsp;</td>
									<td data-label="<?php echo $tr->translate("DATE_OF_BIRTH"); ?>">&nbsp;<?php
																											$format = 'd-M-Y';
																											$dateString = $row["dob"];
																											$date = new DateTime($dateString);
																											$disableDate = $date->format($format);
																											echo $disableDate;
																											?>&nbsp;</td>
									<td data-label="<?php echo $tr->translate("PHONE"); ?>" align="left">&nbsp;<?php echo  $row['sex']; ?>&nbsp;</td>
									<td data-label="<?php echo $tr->translate("PHONE"); ?>" align="left">&nbsp;<?php echo $row['countryCode'] . " " . $row['phoneNumber']; ?>&nbsp;</td>
									<td data-label="<?php echo $tr->translate("PHONE"); ?>" align="left">&nbsp;<?php echo  $row['email']; ?>&nbsp;</td>
									<td data-label="<?php echo $tr->translate("DEGREE"); ?>">&nbsp;<?php echo $row['degree']; ?>&nbsp;</td>
									<td data-label="<?php echo $tr->translate("GRADE"); ?>" align="left">&nbsp;<?php echo $row['grade']; ?>&nbsp;</td>

									<td data-label="<?php echo $tr->translate("CREATE_DATE"); ?>">&nbsp;<?php
																										$format = 'd-M-Y';
																										$dateString = $row["createDate"];
																										$date = new DateTime($dateString);
																										$disableDate = $date->format($format);
																										echo $disableDate;
																										?>&nbsp;</td>
								</tr>
							<?php } ?>
						</table>
					</div>
				</td>
			</tr>
			<tr>
				<td colspan="3">
					<?php echo $this->rsfooteracc; ?>
				</td>
			</tr>
		</table>
	</div>
</div>
<script src="<?php echo $this->baseUrl(); ?>/js/help.js"></script>
<script type="text/javascript">
	dojo.require("dojo.data.ItemFileWriteStore");
	var group_store = getDataStorefromJSON('id', 'name', <?php print_r(Zend_Json::encode(array())); ?>);
	dojo.ready(function() {
		new dijit.form.FilteringSelect({
			queryExpr: "*${0}*",
			autoComplete: false,
			required: false,
			id: "grade",
			name: "grade",
			class: 'fullside',
			placeHolder: "<?php echo $tr->translate("SELECT_GRADE"); ?>",
			onChange: function() {}
		}, "grade");

		getallGrade();

	});

	var url_dept = '<?php echo $this->url(array('module' => 'global', 'controller' => 'grade', 'action' => 'get-grade')); ?>';

	function getallGrade() {
		dept_id = dijit.byId('degree').get('value');
		if (dept_id == '' || dept_id == -1) {
			return false;
		}
		dojo.xhrPost({
			url: url_dept,
			content: {
				'dept_id': dept_id,
				'noaddnew': 1
			},
			handleAs: "json",
			load: function(data) {
				dijit.byId('grade').attr('value', '');
				grade_store = getDataStorefromJSON('id', 'name', data);
				dijit.byId('grade').set('store', grade_store);
				dijit.byId('grade').attr('value', '<?php echo $this->search['grade'] ?>');
			},
			error: function(err) {}
		});
	}
</script>