<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle($tr->translate("Semester Score Result")); 
	echo $this->headTitle();
	$frm =  $this->form_search;
	$base_url = Application_Form_FrmMessage::getUrl("/");
	$db = new Allreport_Model_DbTable_DbRptStudentScore();
	$dbgb = new Application_Model_DbTable_DbGlobal();
	$day = array(
		"Mon" =>'ច័ន្ទ',
		"Tue" =>'អង្គារ',
		"Wed" =>'ពុធ',
		"Thu" =>'ព្រហស្បតិ៍',
		"Fri" =>'សុក្រ',
		"Sat" =>'សៅរ៍',
		"Sun" =>'អាទិត្យ',
	);
	$month = array(
		"01"=>"មករា",
		"02"=>"កុម្ភៈ",
		"03"=>"មីនា",
		"04"=>"មេសា",
		"05"=>"ឧសភា",
		"06"=>"មិថុនា",
		"07"=>"កក្កដា",
		"08"=>"សីហា",
		"09"=>"កញ្ញា",
		"10"=>"តុលា",
		"11"=>"វិច្ឆិកា",
		"12"=>"ធ្នូ"
	);
?>	
<script type="text/javascript">
	dojo.require("dojo.data.ItemFileWriteStore");  
	dojo.require("dojo.data.ObjectStore");
	dojo.ready(function(){
	});
</script>
<form  action="" dojoType="dijit.form.Form" method="post">
</form>
	<div style="background: #fff;width:28cm;margin: 0 auto;min-height: 27cm;padding: 0.5cm;">
		<div id="divPrint">
		<style type="text/css">
			.style{
				line-height: 20px; 
				font-family: Arial,'Khmer OS Battambang';
				white-space: nowrap;
				color:#000;
			}
			.padding{ padding: 0 1px !important;}
			table{ page-break-inside:auto;font-family:Arial,'Khmer OS Battambang'; }
			tr{ page-break-inside:avoid; page-break-after:auto }
			.cheader{ white-space: nowrap;}
			#header {
			  display: table-header-group;
			  page-break-inside:avoid; page-break-after:auto;
			}
			td span {
			    line-height: initial !important;
			}
		</style>
		<table style="width:27cm;background:#fff; margin: 0 auto; font-family: Arial,'Khmer OS Battambang'; ">
				<?php
							$semester_str = array(1=>"I",2=>"II");
							$student=0; $female=0;
							 $old_groupid=0; $i=0; $count_fail=0;  $old_totalscore = 0; $old_rank=0;
							 $duplicate=0;$count_pass=0;
							 
							 $pass_female=0;
							 $fail_female=0;
							 if (!empty($this->studentgroup)){ foreach($this->studentgroup as $key=> $rs){ 
								if($rs['sex']==1){ $sex = $tr->translate("MALE_SHORT");}else{ $female++; $sex = $tr->translate("FEMALE_SHORT");}
								$student++;
							?>
							<?php if ($old_groupid!=$rs['group_id']){  ?>
						    <?php $i=0; $count_fail=0;?>
				<!-- 
				<tr>
					<td colspan="3">
						<?php //echo $this->header;?>
					</td>
				</tr>
				 -->
				 <tr>
						<td valign="top" align="center" width="32%" rowspan="2">
							<span​​ style="color:#000; font-size: 14px;font-family: Arial,'Khmer OS Muol Light';">
								<br /><br />
								<?php echo $tr->translate("MINISTRY_INPHNOMPENH");?>
								<?php $image=$this->baseUrl()."/images/logo.pmg";
								if (!empty($rs['branch_logo'])){
									$image=$this->baseUrl()."/images/".$rs['branch_logo'];
								}
								
								?>
								<img style='max-width: 98%;max-height:90px;' src="<?php echo $image;?>">
							</span>
						</td>
						<td align="center" width="36%">
						</td>
						<td valign="top" align="center" width="32%">
							<strong​​ style="color:#000; font-size: 14px;font-family: Arial,'Khmer OS Muol Light';">
								<?php echo $tr->translate("NATIONALITY_OFKINGDOM");?><br />
								<?php echo $tr->translate("NATION_RELIGION_KING");?>
							</strong>
						</td>
					</tr>
				<tr>
					<td colspan="1" align="center" style="border-top: 1px solid #fff;  border-left: 1px solid #fff; border-right: 1px solid #fff;">
						<span​​ style="color: black;font-size: 12px;font-family: Arial,'Khmer OS Muol Light';"><?php echo $tr->translate("ចំណាត់ថ្នាក់ប្រចាំឆមាសលើកទី").$dbgb->getNumberInkhmer($rs['for_semester']);?></span><br />
						<span​​ style="color: black;font-size: 12px;font-family: Arial,'Khmer OS Muol Light';"><?php echo $tr->translate("GROUP")." ".$rs['group_code'];?></span><br />
						<span​​ style="color: black;font-size: 12px;font-family: Arial,'Khmer OS Muol Light';"><?php echo $tr->translate("ACADEMIC_YEAR")." ".$dbgb->getNumberInkhmer($rs['start_year'])."-".$dbgb->getNumberInkhmer($rs['end_year']);?></span>
					</td>
					<td ></td>
				</tr>
				<tr>
					<td colspan="3" id="exportExcel">
						<table border="1" cellpadding="0"​ style=" font-size:12px; margin:0 auto;width:100%;border-collapse:collapse;border:1px solid #000;"  >
							<tr class="cheader" align="center"  style="font-size:14px;font-family: Arial,'Khmer OS Battambang';">
								<td><?php echo $tr->translate("NUM");?></td>
								<td><?php echo $tr->translate("STUDENT_NAMEKHMERWORD");?></td>
								<td><?php echo $tr->translate("SEX");?></td>
								<td><?php echo $tr->translate("ម.ប្រចាំខែ");?></td>
								<td><?php echo $tr->translate("ម.ប្រឡងឆមាស");?></td>
								
								<td><?php echo $tr->translate("ម.ប្រចាំឆមាស");?></td>
								<td><?php echo $tr->translate("RANK");?>
									<input type="hidden" name="group_id" id="group_id" value="<?php echo $rs['group_id'];?>" dojoType="dijit.form.TextBox" />
									<input type="hidden" name="semester" id="semester" value="<?php echo $rs['for_semester'];?>" dojoType="dijit.form.TextBox" />
								</td>
							</tr>
							<?php }$i++;?>
							<tr class="style">
								<td align="center">&nbsp;<?php echo $dbgb->getNumberInkhmer($i);?>&nbsp;</td>
								<td style="white-space:nowrap;">&nbsp;<?php if(!empty($rs['stu_khname'])){echo $rs['stu_khname'];}else{echo $rs['stu_enname'];}?>&nbsp;</td>
								<td align="center">&nbsp;<?php echo $sex;?>&nbsp;</td>
								<?php 
									$total_score = 0; 
									$avg_semester = $rs['avg_forsemester'];
									$avg_allmonth = $rs['avg_formonth'];
									$score_average = ($avg_semester+$avg_allmonth)/2;
									if($score_average==$old_totalscore){
										$duplicate=$duplicate+1;
									}else{
										$old_rank=$old_rank+1+$duplicate;
										$duplicate=0;
									}
									
									if($score_average>=($rs['max_score']/2)){
										$count_pass++;
										if($rs['sex']==2){
											$pass_female=$pass_female+1;
										}//femail
									}else{
										$count_fail++;
										if($rs['sex']==2){
											$fail_female = $fail_female+1;
										}
									}
								?>
								<td align="center"><?php echo number_format($avg_allmonth,2); ?></td>
								<td align="center"><?php echo number_format($avg_semester,2);?></td>
								<td align="center"><?php echo number_format(($avg_semester+$avg_allmonth)/2,2);?></td>
								<td align="center" style="color:red;"><label id="record<?php echo $i;?>"></label><strong><?php echo $old_rank;?></strong></td>
							</tr>
							<?php 
								$old_groupid=$rs['group_id'];
								$old_totalscore = $score_average;
							?>
							<?php }}?>
							<?php if (!empty($this->studentgroup)){
								for($i;$i<=45;$i++){
							?>
								<tr>
									<td align="center"><?php echo $dbgb->getNumberInkhmer($i);?></td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
								</tr>
								<?php }?>
								<tr>
									<td align="right" colspan="9" style="  border-left: 1px solid #fff; border-right: 1px solid #fff;"></td>
								</tr>
								<tr>
									<td align="right" colspan="9" style="  border: 1px solid #fff; border-right: 1px solid #fff;">
										<table cellpadding="0" cellspacing="0" width="100%" style="font-family:Arial,'Khmer OS Battambang';font-size: 12px">
											<tr>
												<td valign="top" width="33%" >
												សិស្សសរុបចំនួន <span style="display: inline-block; min-width: 10px; text-align: center;"><?php echo $dbgb->getNumberInkhmer(sprintf("%02d",$student));?></span> នាក់ <span style="display: inline-block; min-width: 10px;"></span> ស្រី <span style="display: inline-block; min-width: 10px; text-align: center;"><?php echo $dbgb->getNumberInkhmer(sprintf("%02d", $female));?></span> នាក់<br />
												<span style="display: inline-block; min-width: 120px;">សិស្សលើមធ្យមភាគ</span> : <span style="display: inline-block; min-width: 50px; text-align: center;"><?php echo $dbgb->getNumberInkhmer(sprintf("%02d",$count_pass));?></span>នាក់ <span style="display: inline-block; min-width: 10px;"></span>  ស្រី <span style="display: inline-block; min-width: 50px; text-align: center;"><?php echo $dbgb->getNumberInkhmer(sprintf("%02d", $pass_female));?></span> នាក់<br />
												<span style="display: inline-block; min-width: 120px;">សិស្សក្រោមមធ្យមភាគ</span> : <span style="display: inline-block; min-width: 50px; text-align: center;"><?php echo $dbgb->getNumberInkhmer(sprintf("%02d",$count_fail));?></span>នាក់ <span style="display: inline-block; min-width: 10px;"></span>  ស្រី <span style="display: inline-block; min-width: 50px; text-align: center;"><?php echo $dbgb->getNumberInkhmer(sprintf("%02d", $fail_female));?></span> នាក់
												</td>
												<td width="33%" valign="top"></td>
												<td width="33%" style="white-space: nowrap;" valign="top" align="center">
												ភ្នំពេញថ្ងៃទី.............ខែ...............ឆ្នាំ.............
												<br />
												គ្រូប​ន្ទុកថ្នាក់
												
												</td>
											</tr>
											<tr>
												<td valign="top" width="33%" valign="top" align="center">
													បានឃើញ និងឯកភាព<br/>
													ជ.នាយិកាសាលា
												</td>
												<td width="33%" valign="top"></td>
												<td width="33%"  align="center" style="white-space: nowrap;" valign="top"><br /><br /><?php echo @$this->studentgroup[0]['teacher_name'];?></td>
											</tr>
											
										</table>
									</td>
								</tr>
							<?php }?>
						</table>
					</td>
				</tr>
			</table>
		</div>
		<table>
			<tr>
				<td colspan="3"><button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" name="search"  type="button" onclick="printSelected();"><?php echo $tr->translate("OUTSTANDING_STUDENT");?></button></td>
			</tr>
		</table>
		
	</div>
<script>
	function printSelected(){
		group = dijit.byId('group_id').get('value');
		semester = dijit.byId('semester').get('value');
		<?php 
			defined('BASE_URL')	|| define('BASE_URL', Zend_Controller_Front::getInstance()->getBaseUrl());
			$url_copy =$this->url(array('module'=>'allreport','controller'=>'score','action'=>'semester-outstanding-student'));
		?>
		 if(group!='' && semester!=''){
			window.location.href = '<?php echo $url_copy;?>';
		 }else{
			alert('Please select record you want to print');
			return false;
		 }
	}
</script>	