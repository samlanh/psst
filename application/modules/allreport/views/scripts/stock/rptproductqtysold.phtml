<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle($tr->translate('RPT_STATISTIC_PRODUCT_SOLD')); 
	echo $this->headTitle(''); 
	$frm =  $this->form_search;
?>	
<div style="width: 28cm;margin: 0 auto;">
	<form  id='foundation_class' action="" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
		<table width="100%">	
			<tr> 
				 <td>
				 	<select name="pro_name" id="pro_name" dojoType="dijit.form.FilteringSelect" class="fullside" >
				 		<option value=""><?php echo $tr->translate("SELECT_PRODUCT")?></option>
				 		<?php if(!empty($this->all_pro)){foreach ($this->all_pro as $pro){?>
				 		<option value="<?php echo $pro['id']?>" <?php if($pro['id']==$this->search['pro_name']){echo "selected='selected'";}?>><?php echo $pro['title']?></option>
				 		<?php }}?>
				 	</select>
				 </td>
				 <td><?php echo $frm->getElement("start_date");?></td>
				 <td><?php echo $frm->getElement("end_date");?></td>
				 <td> <button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button></td>
			</tr>
		</table>
	</form>	
</div>
<style>
	.hover:hover{background: #ddd;}
</style>
<div style="border: 1px dotted #000;background: #fff;width: 27cm;margin: 0 auto;min-height: 27cm; padding: 0.5cm;">
	<div id="divPrint">
		<table style="background:#fff;width:90%; margin: 0 auto;white-space: nowrap;width: 100%;">
			<tr>
				<td width="15%" align="center"><img style="width:60%;" src="<?php echo $this->baseUrl().'/images/logo.png'?>"><br /></td>
				<td align="center"  width="70%">
					<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 16px;font-family:'Khmer MEF2'; "><?php echo $tr->translate("CUSTOMER_BRANCH"); ?></strong><br />
					<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 16px;font-family:'Khmer MEF2'; "><?php echo $tr->translate("RPT_STATISTIC_PRODUCT_SOLD"); ?></strong><br />
					<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 13px;font-family:'Khmer MEF2';"><?php if(!empty($this->search['start_date'])){?>&nbsp <?php echo date("d-M-Y",strtotime($this->search["start_date"]))?> ដល់ <?php echo date("d-M-Y",strtotime($this->search["end_date"]));}?></strong>
				</td>
				<td width="15%" align="right">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="3" id="exportExcel">
					<table cellpadding="5"​ style="font-family:Khmer OS Battambang,Times New Roman; border: 1px solid #000;width:100%; border-collapse: collapse;white-space: nowrap;"  border="1" >
						<tr style="font-size:14px;font-weight:bold; height: 20px;border: 1px solid #000; background: #ccd9ff; line-height: 30px;" align="center" >
							<td>&nbsp;<?php echo $tr->translate("N_O"); ?>&nbsp;</td>
						    <td>&nbsp;<?php echo $tr->translate("PRODUCT_NAME");?>&nbsp;</td>
						    <td>&nbsp;<?php echo $tr->translate("QTY");?>&nbsp;</td>
						    <td>&nbsp;<?php echo $tr->translate("TOTAL");?>&nbsp;</td>
						</tr>
					<?php $pro_qty=0;$pro_id=0;$total=0;$i=0; $pro_name="";$grand_total=0;
						if(!empty($this->rspro)){foreach ($this->rspro AS $key => $row) { 
							if($key>0 && $pro_id!=$row['pro_id']){$i++;
								
						?>
								<tr style="font-size:12px; height: 20px;border: 1px solid #000;" align="center" class="hover" >
									<td style="border: 1px solid #000;"><?php echo $i;?></td>
									<td align="left" style="border: 1px solid #000;">&nbsp;&nbsp;<?php echo $pro_name;?></td>	
									<td align="center" style="border: 1px solid #000;">&nbsp;<?php echo number_format($pro_qty);?></td>
									<td align="center" style="border: 1px solid #000;">&nbsp;<?php echo "$ ".number_format($total,2);?></td>
		 						</tr>
		 						
	 						<?php 
	 							$pro_id=$row['pro_id'];
								$pro_name = $row['pro_name'];
								$pro_qty = $row['qty'];
								$total = $row['total'];

							}else{
 								$pro_id=$row['pro_id'];
 								$pro_name = $row['pro_name'];
 								$pro_qty = $pro_qty+$row['qty'];
 								$total = $total + $row['total'];
							}

							$grand_total = $grand_total + $row['total'];
								  
 							?>
 						
					<?php }}?>	
						<tr style="font-size:12px; height: 20px;border: 1px solid #000;" align="center" class="hover" >
							<td style="border: 1px solid #000;"><?php echo $i+1;?></td>
							<td align="left" style="border: 1px solid #000;">&nbsp;<?php echo $pro_name;?></td>	
							<td align="center" style="border: 1px solid #000;">&nbsp;<?php echo number_format($pro_qty);?></td>
							<td align="center" style="border: 1px solid #000;">&nbsp;<?php echo "$ ".number_format($total,2);?></td>
 						</tr>
 						
 						<tr style="font-size:13px; height: 20px;border: 1px solid #000;font-weight: bold;" align="center" class="hover" >
							<td colspan="3" style="border: 1px solid #000;">Grand Total </td>
							<td align="center" style="border: 1px solid #000;font-weight: bolder;">&nbsp;<?php echo "$ ".number_format($grand_total,2);?></td>
 						</tr>
					</table>
				</td>
			</tr>
		</table>
		<table style="background:#fff;width:90%;margin:0 auto;white-space: nowrap;width:100%;font-family:Khmer OS Battambang,Times New Roman;">
			<tr>
				<td colspan="3">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="3">&nbsp;</td>
			</tr>
			<tr>
				<td align="center" width="25%">
					<span style=" font-size: 14px;"><?php echo $tr->translate('VERIFIED_BY')?></span>
				</td>
				<td  width="50%">&nbsp;</td>
				<td align="center"  width="25%">
					<span style=" font-size: 14px;text-align: right;"><?php echo $tr->translate('PREPARED_BY')?></span>
				</td>
			</tr>
		</table>
	</div>		
</div>
<script type="text/javascript">
function doPrint() {
	window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint').innerHTML;
    window.frames["print_frame"].window.focus();
    window.frames["print_frame"].window.print();
    hideDialog();
}
function preview()
{ 
  var disp_setting="toolbar=no,status=no,resizable=no,location=no,directories=yes,menubar=no,"; 
  disp_setting+="scrollbars=no,width=1200, height=700, left=100, top=25"; 
  var content_vlue = document.getElementById("divPrint").innerHTML; 
  var docprint=window.open("","",disp_setting); 
   docprint.document.open(); 
   docprint.document.write('<html><head>'); 
   docprint.document.write('</head><div style=" font-size:16px !important; margin:0px; font-family:Verdana;"><style>table th {font-size:14px !important;} table td{font-size:12px !important;}</style><center>');          
   docprint.document.write(content_vlue);          
   docprint.document.write('</center></div></html>'); 
   docprint.document.close(); 
   docprint.focus(); 
}
function exportExcel(){
	$('#exportExcel').tableExport({type:'excel',escape:'false'});
}
</script>