<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	echo $this->headTitle($tr->translate("EDIT_CRM"));
	$frm_items = $this->frm_crm;
?>
<style>
table.history-record {
    width: 100%;
    font-size: 12px;
}
table.history-record thead tr th {
    text-align: center;
    padding: 5px 2px;
    background: #e0eafb;
    border-bottom: solid 1px #afadad;
}
table.history-record tbody tr {
    border-bottom: solid 1px #e8e8e8;
}
table#table_row_study {
    width: 100%;
}
table.history-record tbody tr td {
    padding: 5px;
	vertical-align: top;
}
</style>
<div class="card">
	<div class="card-content collapse show">
		<div class="card-box">
       		<div class="col-sm-12 border-botom">
		    	<div class="col-sm-8 pd-0">
	    			<h4 class="m-b-0"><i class="fa fa-graduation-cap" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('EDIT_CRM');?></h4>
    			</div>
    			<div class="col-sm-4 text-right"></div>
    		</div>
    	</div>
    	<form  id='edit-major' action="" dojoType="dijit.form.Form" method="post" enctype="multipart/form-data">
			<script type="dojo/method" event="onSubmit">			
				if(this.validate()) {
					branch_id = dijit.byId('branch_id').get('value');
					if(branch_id=="" || branch_id==-1){
						alert("<?php echo $tr->translate("PLEASE_SELECT_BRANCH");?>");
						return false;
					}
					identity = $("#identity").val();
					if(identity==''){
						dijit.byId('kh_name_stu').focus();
						return false;
					}
					loadingBlock();
					return true;
				}else {
					return false;
				}
			</script>
			<div class="card-box">
				<div class="col-md-4 col-sm-4 col-xs-12">
					<div class="card-blogform">
						<div class="card-body"> 
							<div class="form-group">
								<div class="d-flex"> 
									<div class="settings-main-icon ">
										<i class="glyphicon glyphicon-user" aria-hidden="true"></i>
									</div> 
									<div class="col-md-10 col-sm-10 col-xs-12"> 
										<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("CUSTOMER_INFO");?></p>
									</div> 
								</div>
							</div>
							<div class="form-group">
				                <label class="control-label bold  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("BRANCH");?> <span class="required">*</span></label>
				                <div class="col-md-7 col-sm-7 col-xs-12">
				                	<?php echo $frm_items->getElement("branch_id");?>
				                	<?php echo $frm_items->getElement("id");?>
				                </div>
				             </div>
							<div class="form-group">
				                <label class="control-label bold  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("STUDENT_NAMEKHMER").$tr->translate("IN_KHMER");?> <span class="required">*</span></label>
				                <div class="col-md-7 col-sm-7 col-xs-12">
				                	<?php echo $frm_items->getElement("kh_name");?>
				                </div>
				             </div>
			                <div class="form-group">
			                    <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("Last Name");?>
			                   </label>
			                   <div class="col-md-7 col-sm-7 col-xs-12">
			                   		<?php echo $frm_items->getElement("last_name");?>
			                   </div>
			                   <div class="clearfix"></div>
			                </div>
			                <div class="form-group">
			                    <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("First Name");?>
			                   </label>
			                  <div class="col-md-7 col-sm-7 col-xs-12">
			                   		<?php echo $frm_items->getElement("first_name");?>
			                   </div>
			                 </div>
			                 <div class="form-group">
				               <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("GENDER");?> </label>
				               <div class="col-md-7 col-sm-7 col-xs-12">
				                	<?php echo $frm_items->getElement("sex");?>
				                </div>
				             </div>
				             <div class="form-group">
			                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("PHONE");?> <span class="required">*</span>
			                   </label>
			                   <div class="col-md-7 col-sm-7 col-xs-12">
			                   		<?php echo $frm_items->getElement("tel");?>
			                   </div>
			                </div>
							<div class="form-group">
			                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("CURRENT_ADDRESS");?>
			                   </label>
			                   <div class="col-md-7 col-sm-7 col-xs-12">
			                   		<?php echo $frm_items->getElement("current_address");?>
			                   </div>
			                 </div>
			              </div>
			        </div>
			             <div class="card-blogform">
							<div class="card-body"> 
									<div class="form-group">
										<div class="d-flex"> 
											<div class="settings-main-icon ">
												<i class="glyphicon glyphicon-list-alt" aria-hidden="true"></i>
											</div> 
											<div class="col-md-10 col-sm-10 col-xs-12"> 
												<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("COLLECTION_INFORMATION");?></p>
											</div> 
										</div>
									</div>
						             <div class="form-group">
						               <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("ASK_FOR");?> </label>
						               <div class="col-md-7 col-sm-7 col-xs-12">
						                	<?php echo $frm_items->getElement("ask_for");?>
						                </div>
						             </div>
						             <div class="form-group">
						               <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("Previous Concern");?> </label>
						               <div class="col-md-7 col-sm-7 col-xs-12">
						                	<input value="<?php echo $this->prevconcern;?>" type="text" id="e15" name="prev_concern"  style="width: 100%">
						                </div>
						             </div>
						             <div class="form-group">
						               <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("KNOW_BY");?> </label>
						               <div class="col-md-7 col-sm-7 col-xs-12">
						                	<?php echo $frm_items->getElement("know_by");?>
						                </div>
						             </div>
					                <div class="form-group">
						                <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("FROM_SCHOOL");?> </label>
						                <div class="col-md-7 col-sm-7 col-xs-12">
						                	<?php echo $frm_items->getElement("old_school");?>
						                </div>
						             </div>
						             <div class="form-group">
					                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("REASON");?>
					                   </label>
					                   <div class="col-md-7 col-sm-7 col-xs-12">
					                   		<?php echo $frm_items->getElement("reason");?>
					                   </div>
					                </div>
					                <div class="form-group">
					                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("STATUS");?>
					                   </label>
					                   <div class="col-md-7 col-sm-7 col-xs-12">
					                   		<?php echo $frm_items->getElement("crm_status");?>
					                   </div>
					                </div>
	                 			</div>
	               		</div>
		        </div>
				<div class="col-md-8 col-sm-8 col-xs-12">
					<div class="card-blogform">
						<div class="card-body"> 
							<div class="form-group">
								<div class="d-flex"> 
									<div class="settings-main-icon ">
										<i class="glyphicon glyphicon-user" aria-hidden="true"></i>
									</div> 
									<div class="col-md-10 col-sm-10 col-xs-12"> 
										<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("STUDENT_INFORMATION");?></p>
									</div> 
								</div>
							</div>
							<div class="col-md-6 col-sm-6 col-xs-12">
		                	  <div class="form-group">
			                		 <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("STUDENT_NAMEKHMER").$tr->translate("IN_KHMER");?>
				                     </label>
			                		<div class="col-md-7 col-sm-7 col-xs-12">
				                   		<?php echo $frm_items->getElement("kh_name_stu");?>
			                   		</div>
			                   </div>
			                   <div class="form-group">
				                    <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("Last Name");?>
				                     </label>
				                   <div class="col-md-7 col-sm-7 col-xs-12">
				                   		<?php echo $frm_items->getElement("last_name_stu");?>
				                   </div>
				                </div>
				                <div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("First Name");?>
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
				                   		<?php echo $frm_items->getElement("first_name_stu");?>
				                   </div>
				                </div>
				                <div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("GENDER");?>
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
				                   		<?php echo $frm_items->getElement("sex_stu");?>
				                   </div>
				                </div>
				                <div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" >
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
				                    	<input type="button" label="<?php echo $tr->translate('PAST_FROM_CUSTOMER');?>" dojoType="dijit.form.Button" 
										class="button-class button-primary"  iconClass="glyphicon glyphicon-paste" onclick="copyfromcustomer();" />
				                   </div>
				                </div>
			                </div>
			                <div class="col-md-6 col-sm-6 col-xs-12">
		                		<div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("AGE");?>
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
				                   		<?php echo $frm_items->getElement("age_stu");?>
				                   </div>
				                </div>
				                <div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("PHONE");?>
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
				                   		<?php echo $frm_items->getElement("tel_stu");?>
				                   </div>
				                </div>
		                		<div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("DEGREE");?>
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
				                   		<?php echo $frm_items->getElement("degree");?>
				                   </div>
				                </div>
				                <div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("GRADE");?>
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
				                   		<input id="grade" />
				                   </div>
				                </div>
								<div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("PART_TIME_LIST");?>
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
				                   		<input id="part_time_list" />
				                   </div>
				                </div>
				                <div class="form-group">
				                	 <label class="control-label  col-md-5 col-sm-5 col-xs-12" >
				                     </label>
				                    <div class="col-md-7 col-sm-7 col-xs-12">
					                    <input type="button" label="<?php echo $tr->translate('SAVE_TEMP');?>" dojoType="dijit.form.Button" 
											class="button-class button-primary"  iconClass="glyphicon glyphicon-paste" onclick="addRow();" />
				                   </div>
				                </div>
			                </div>
					</div>
				</div>
				<div class="card-blogform">
						<div class="card-body">
							  <div class="form-group">
									<div class="d-flex"> 
										<div class="settings-main-icon ">
											<i class="glyphicon glyphicon-education" aria-hidden="true"></i>
										</div> 
										<div class="col-md-10 col-sm-10 col-xs-12"> 
											<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("STUDY_INFO");?></p>
										</div> 
									</div>
							  </div>
				              <div class="form-group">
					         	 	<table id="table_row" style="border-collapse: collapse; border:1px solid #ccc;width:100%;">
										<tr id="head-title" class="head-td" align="right" style="white-space:nowrap;"></tr>
									</table>
									<input type="hidden" name="identity" id="identity"  />
					         	 </div>
								<div class="form-group">
				                   <label class="control-label  col-md-12 col-sm-12 col-xs-12" ><?php echo $tr->translate("NOTE");?>
				                   </label>
				                </div>
				                <div class="form-group">
				                   <div class="col-md-12 col-sm-12 col-xs-12">
				                   		<?php echo $frm_items->getElement("note");?>
				                   </div>
				                </div>
				                <?php if (!empty($this->history)){?>
				                <div class="form-group">
				                   <label class="control-label col-md-12 col-sm-12 col-xs-12 title-blog bold" ><i class="fa fa-hand-o-right" aria-hidden="true"></i> <?php echo $tr->translate("CONTACT_HISTORY");?> 
				                   </label>
				                </div>
				                <div class="form-group">
				                	<table class="history-record" >
				                		<thead>
				                			<tr>
				                				<th><?php echo $tr->translate("NUM");?></th>
				                				<th><?php echo $tr->translate("CONTACT_DATE");?></th>
				                				<th style="width: 150px;"><?php echo $tr->translate("FEEDBACK");?></th>
				                				<th><?php echo $tr->translate("NEXT_DATE_CONTACT");?></th>
				                				<th><?php echo $tr->translate("CONTACT_BY");?></th>
				                			</tr>
				                		</thead>
				                		<tbody>
				                			<?php foreach ($this->history as $key => $record){?>
				                			<tr>
				                				<td align="center">&nbsp;<?php echo $key+1;?>&nbsp;</td>
				                				<td align="center">&nbsp;<?php echo date("d/M/Y",strtotime($record['contact_date']))?>&nbsp;</td>
				                				<td align="left">&nbsp;<?php echo $record['feedback'];?>&nbsp;</td>
				                				<td align="center">&nbsp;<?php echo date("d/M/Y",strtotime($record['next_contact']))?>&nbsp;</td>
				                				<td align="center">&nbsp;<?php echo $record['user_contact_name'];?>&nbsp;</td>
				                			</tr>
				                			<?php }?>
				                		</tbody>
				                	</table>
				                </div>
				                <?php }?>
				              </div>
				         </div>
				         <div class="clearfix"></div>
				         <div class="card-box mt-20">
			               	<div class="col-md-12 col-sm-12 col-xs-12 border-top mt-20 ptb-10 text-center">
			               		<input type="submit"  value="save_close" name="save_close" id="save_close" label="<?php echo $tr->translate('SAVE_CLOSE');?>" dojoType="dijit.form.Button" 
								 class="button-class button-primary"  iconClass="glyphicon glyphicon-floppy-remove" />
								
			               	</div>
			             </div>  
		         </div>
			</div>
		</form>
    </div>
</div>
<style>
.bd-bg {
    background: #f7f7f7;
    padding: 5px 10px;
    border: solid 1px #062b61;
    margin-bottom: 10px;
}
.bd-bg .form-group {
    margin-bottom: 0;
}
table#table_row tr td {
    padding: 5px 2px;
    background: #f7f7f7;
}
</style>
 <link href="<?php echo $this->baseUrl()."/admin/"?>/3.5.0/select2.min.css" /> 
 <script src="<?php echo $this->baseUrl()."/admin/"?>/3.5.0/select2.min.js"></script>
  <?php 
 $tags="";
 if (!empty($this->prev_concern)) foreach ($this->prev_concern as $rs){
 	if (empty($tags)){
 		$tags = '"'.$rs['name'].'"';
 	}else{
 		if (!empty($rs['name'])){
 		$tags=$tags.',"'.$rs['name'].'"';
 		}
 	}
 }
?>
<script src="<?php echo $this->baseUrl();?>/js/help.js"  type="text/javascript"></script>
<script>
require(["dojo/ready"], function(ready){
	ready(function(){
		 $("#e15").select2({tags:[<?php echo $tags;?>],placeholder: "<?php echo $tr->translate("Previous Concern");?>",allowClear: true});
	});
});
dojo.require("dijit.form.Textarea");
dojo.require('dijit.form.NumberTextBox');
dojo.require("dojo.data.ObjectStore");
dojo.require("dojo.data.ItemFileWriteStore");  
dojo.require("dojo.NodeList-manipulate");

var grade_store  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode(array()));?> );
var grade_result_store  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode(array()));?> );
var part_time_list_store = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode(array()));?> );
dojo.ready(function(){
	new dijit.form.FilteringSelect({
		store: grade_store,
		autoComplete: false,
		queryExpr:'*${0}*',                        
		required: false,
		id: "grade",
		name: "grade",           
		class: "fullside", 
		placeHolder:"<?php echo $tr->translate('SELECT_GRADE');?>",          
		onChange:function(){  
		}
	}, "grade");

	new dijit.form.FilteringSelect({
		store: part_time_list_store,
		autoComplete: false,
		queryExpr:'*${0}*',                        
		required: false,
		id: "part_time_list",
		name: "part_time_list",           
		class: "fullside", 
		placeHolder:"<?php echo $tr->translate('PART_TIME_LIST');?>",          
		onChange: function() {  
		}
	}, "part_time_list");

	var degree = dijit.byId('degree');
	degree.on('change', function(evt) {
		 getPartTimeListByDregree();
 	 });

	getAllGrade();	
	getPartTimeListByDregree();
	initailize();
});

var url_get_parttime = '<?php echo $this->url(array('module'=>'global','controller'=>'parttimelist','action'=>'get-parttime')); ?>';
function getPartTimeListByDregree(part_time=0){
	dijit.byId('part_time_list').set('value',''); 
	degree = dijit.byId('degree').get('value');
	branchId = dijit.byId('branch_id').get('value');
	if(degree==''){
		return false;
	}
	dojo.xhrPost({
		url:url_get_parttime,
		content:{
			'degree':degree,
			'branchId':branchId,
			},
		handleAs:"json",
		load: function(data) {
			part_time_list_store  = getDataStorefromJSON('id','name', data);
			dijit.byId('part_time_list').set('store',part_time_list_store);  
			if(part_time>0){
				part_time = dijit.byId('part_time_list').attr("value",part_time);  
			}
		},
		error: function(err) {
		}
	});
}

var url_get_grade = '<?php echo $this->url(array('module'=>'global','controller'=>'grade','action'=>'get-grade')); ?>';
function getAllGrade(grade_id=0){
	dijit.byId('grade').set('value',''); 
	dept_id = dijit.byId('degree').get('value');
	if(dept_id==''){
		return false;
	}
	dojo.xhrPost({
		url:url_get_grade,
		content:{
			'dept_id':dept_id,
			'noaddnew':1
			},
		handleAs:"json",
		load: function(data){
			grade_store  = getDataStorefromJSON('id','name', data);
			dijit.byId('grade').set('store',grade_store);
			if(grade_id>0){
				grade = dijit.byId('grade').attr("value",grade_id);  
			}
		},
		error: function(err){
		}
	});
}
var col = 0;
var no = 0;
var title = 0;
tmp = '';
temp='';
function addRow(){
	kh_name_stu = dijit.byId('kh_name_stu').get('value');
	first_name_stu = dijit.byId('first_name_stu').get('value');
	last_name_stu = dijit.byId('last_name_stu').get('value');
	sex_stu = dijit.byId('sex_stu').get('value');
	age_stu = dijit.byId('age_stu').get('value');
	tel_stu = dijit.byId('tel_stu').get('value');

	degree = dijit.byId('degree').get('value');
	part_time = dijit.byId('part_time_list').get('value');
	if(degree==''){
		dijit.byId('degree').focus();
		return false;
	}
	grade = dijit.byId('grade').get('value');
	if(grade==''){
		//dijit.byId('grade').focus();
		//return false;
	}
	
	degreelabel = dijit.byId("degree").attr('displayedValue');
	gradelabel = dijit.byId("grade").attr('displayedValue');
	parttimelabel = dijit.byId("part_time_list").attr('displayedValue');
	sex_stulabel = dijit.byId("sex_stu").attr('displayedValue');
	if(kh_name_stu==""){
		alert("<?php echo $tr->translate("Please Enter Name Kh");?>");
		dijit.byId('kh_name_stu').focus();
		return false;
	}
	if(degree==""){ degreelabel = ""}
	 if (isNaN(age_stu)) { age_stu = ""}
	col++;no++;
	template='';
	if(title!=1){
		$("#head-title").html("");
		temp+='<th><?php echo $tr->translate("DEL");?></th>';
		temp+='<th><?php echo $tr->translate("N_O");?></th>';
		temp+='<th style="white-space: nowrap;" ><?php echo $tr->translate("STUDENT_NAMEKHMER");?></th>';
		temp+='<th ><?php echo $tr->translate("Last Name");?></th>';
		temp+='<th ><?php echo $tr->translate("First Name");?></th>';
		temp+='<th ><?php echo $tr->translate("SEX");?></th>';
		temp+='<th ><?php echo $tr->translate("AGE")." (".$tr->translate("YEAR").")";?></th>';
		temp+='<th ><?php echo $tr->translate("PHONE");?></th>';
		temp+='<th ><?php echo $tr->translate("DEGREE");?></th>';
		temp+='<th ><?php echo $tr->translate("GRADE");?></th>';
		temp+='<th ><?php echo $tr->translate("EDIT");?></th>';
		dojo.query("#head-title").append(temp);
		title=1;
	}
		template+='<td width="4%"align="center"><img onclick="deleteRecord('+col+')" src="<?php echo $this->baseUrl();?>/images/Delete_16.png"></td>';
		template+='<td width="4%" align="center">'+no+'</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("STUDENT_NAMEKHMER");?>" required="1" dojoType="dijit.form.TextBox" class="fullside" name="kh_name_'+col+'" id="kh_name_'+col+'" value="'+kh_name_stu+'" type="hidden">'+kh_name_stu+'&nbsp;</td>';	
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("Last Name");?>" required="1" dojoType="dijit.form.TextBox" class="fullside" name="last_name_'+col+'" id="last_name_'+col+'" value="'+last_name_stu+'" type="hidden">'+last_name_stu+'&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("First Name");?>" required="1" dojoType="dijit.form.TextBox" class="fullside" name="first_name_'+col+'" id="first_name_'+col+'" value="'+first_name_stu+'" type="hidden">'+first_name_stu+'&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" dojoType="dijit.form.TextBox" class="fullside" name="gender_'+col+'" id="gender_'+col+'" value="'+sex_stu+'" type="hidden">'+sex_stulabel+'&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("AGE");?>" dojoType="dijit.form.TextBox" class="fullside" name="age_'+col+'" id="age_'+col+'" value="'+age_stu+'" type="hidden">'+age_stu+'&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("PHONE");?>" dojoType="dijit.form.TextBox" class="fullside" name="tel_'+col+'" id="tel_'+col+'" value="'+tel_stu+'" type="hidden">'+tel_stu+'&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("DEGREE");?>" dojoType="dijit.form.TextBox" class="fullside" name="degree_'+col+'" id="degree_'+col+'" value="'+degree+'" type="hidden">'+degreelabel+'&nbsp;<br>';
			template+='<input style="width:100%;" placeholder="<?php echo $tr->translate("PART_TIME");?>" dojoType="dijit.form.TextBox" class="fullside" name="part_time_list_'+col+'" id="part_time_list_'+col+'" value="'+part_time+'" type="hidden"><label class="text-primary">'+parttimelabel+'</label></td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("GRADE");?>" dojoType="dijit.form.TextBox" class="fullside" name="grade_'+col+'" id="grade_'+col+'" value="'+grade+'" type="hidden">'+gradelabel+'&nbsp;</td>';
		template+='<td width="4%"align="center"><img style="width:15px;" onclick="editStudent('+col+');deleteRecord('+col+')" src="<?php echo $this->baseUrl();?>/images/edit.jpg"></td>';
	tmp='<tr id="row'+col+'">';
	tmp+="</tr>";
	dojo.query("#table_row").append(tmp);

	if($("#identity").val()!="") {
		var identity = $("#identity").val();
		$("#identity").val(identity+','+col);
	} else {$("#identity").val(col);}
	dojo.html.set(dojo.byId("row"+col),template , {
	     parseContent: true,
	});

	kh_name_stu = dijit.byId('kh_name_stu').set('value','');
	first_name_stu = dijit.byId('first_name_stu').set('value','');
	last_name_stu = dijit.byId('last_name_stu').set('value','');
	sex_stu = dijit.byId('sex_stu').set('value',1);
	age_stu = dijit.byId('age_stu').set('value','');
	age_stu = dijit.byId('tel_stu').set('value','');
	grade = dijit.byId('grade').set('value','');
	part_time = dijit.byId('part_time_list').set('value','');
}
function initailize(){
	<?php if (!empty($this->rowdetail)) foreach ($this->rowdetail as $rs){?>
	col++;no++;
	template='';
	if(title!=1){
		temp+='<th><?php echo $tr->translate("DEL");?></th>';
		temp+='<th><?php echo $tr->translate("N_O");?></th>';
		temp+='<th style="white-space: nowrap;" ><?php echo $tr->translate("STUDENT_NAMEKHMER");?></th>';
		temp+='<th><?php echo $tr->translate("Last Name");?></th>';
		temp+='<th><?php echo $tr->translate("First Name");?></th>';
		temp+='<th><?php echo $tr->translate("SEX");?></th>';
		temp+='<th><?php echo $tr->translate("AGE")." (".$tr->translate("YEAR").")";?></th>';
		temp+='<th ><?php echo $tr->translate("PHONE");?></th>';
		temp+='<th><?php echo $tr->translate("DEGREE");?></th>';
		temp+='<th><?php echo $tr->translate("GRADE");?></th>';
		temp+='<th ><?php echo $tr->translate("EDIT");?></th>';
		dojo.query("#head-title").append(temp);
		title=1;
	}
		template+='<td width="4%"align="center"><?php if ($rs['customer_type']==3){?><img onclick="deleteRecord('+col+')" src="<?php echo $this->baseUrl();?>/images/Delete_16.png"><?php }?></td>';
		template+='<td width="4%" align="center">'+no+'</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("STUDENT_NAMEKHMER");?>" required="1" dojoType="dijit.form.TextBox" class="fullside" name="kh_name_'+col+'" id="kh_name_'+col+'" value="<?php echo $rs['stu_khname'];?>" type="hidden"><?php echo $rs['stu_khname'];?>&nbsp;</td>';	
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("Last Name");?>" required="1" dojoType="dijit.form.TextBox" class="fullside" name="last_name_'+col+'" id="last_name_'+col+'" value="<?php echo $rs['last_name'];?>" type="hidden"><?php echo $rs['last_name'];?>&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("First Name");?>" required="1" dojoType="dijit.form.TextBox" class="fullside" name="first_name_'+col+'" id="first_name_'+col+'" value="<?php echo $rs['stu_enname'];?>" type="hidden"><?php echo $rs['stu_enname'];?>&nbsp;</td>';	
		template+='<td>&nbsp;<input style="width:100%;" dojoType="dijit.form.TextBox" class="fullside" name="gender_'+col+'" id="gender_'+col+'" value="<?php echo $rs['sex'];?>" type="hidden"><?php echo $rs['sextitle'];?>&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("AGE");?>" dojoType="dijit.form.TextBox" class="fullside" name="age_'+col+'" id="age_'+col+'" value="<?php echo $rs['age'];?>" type="hidden"><?php echo $rs['age'];?>&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("PHONE");?>" dojoType="dijit.form.TextBox" class="fullside" name="tel_'+col+'" id="tel_'+col+'" value="'+'<?php echo $rs['tel'];?>'+'" type="hidden">'+'<?php echo $rs['tel'];?>'+'&nbsp;</td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("DEGREE");?>" dojoType="dijit.form.TextBox" class="fullside" name="degree_'+col+'" id="degree_'+col+'" value="<?php echo $rs['crm_degree'];?>" type="hidden"><?php echo $rs['degree_title'];?>&nbsp;<br>';
		template+='<input style="width:100%;" placeholder="<?php echo $tr->translate("PART_TIME");?>" dojoType="dijit.form.TextBox" class="fullside" name="part_time_list_'+col+'" id="part_time_list_'+col+'" value="<?php echo $rs['crm_partime_id'];?>" type="hidden"><label class="text-primary"><?php echo $rs['parttime_title'];?></label></td>';
		template+='<td>&nbsp;<input style="width:100%;" placeholder="<?php echo $tr->translate("GRADE");?>" dojoType="dijit.form.TextBox" class="fullside" name="grade_'+col+'" id="grade_'+col+'" value="<?php echo $rs['crm_grade'];?>" type="hidden"><?php echo $rs['grade_title'];?>&nbsp;<input dojoType="dijit.form.TextBox" class="fullside" name="detailid'+col+'" id="detailid'+col+'" value="<?php echo $rs['stu_id'];?>" type="hidden"></td>';
		template+='<td width="4%"align="center"><?php if ($rs['customer_type']==3){?><img style="width:15px;" onclick="editStudent('+col+');deleteRecord('+col+');" src="<?php echo $this->baseUrl();?>/images/edit.jpg"><?php }?></td>';
	tmp='<tr id="row'+col+'">';
	tmp+="</tr>";
	dojo.query("#table_row").append(tmp);

	if($("#identity").val()!="") {
		var identity = $("#identity").val();
		$("#identity").val(identity+','+col);
	} else {$("#identity").val(col);}
	dojo.html.set(dojo.byId("row"+col),template , {
	     parseContent: true,
	});
	<?php } ?>
}
function deleteRecord(index) {
	var identity = $('#identity').val();
	var arrays = identity.split(',');
	for(var i=0;i<arrays.length;i++) {
	if(arrays[i] == index) arrays.splice(i,1);
	}
	var strings = arrays.join(',');
	$('#identity').val(strings);
	dojo.query("#row"+index).remove();
}
function editStudent(index) {
	kh_name = dijit.byId('kh_name_'+index).get("value");
	last_name = dijit.byId('last_name_'+index).get("value");
	first_name = dijit.byId('first_name_'+index).get("value");
	gender = dijit.byId('gender_'+index).get("value");
	age = dijit.byId('age_'+index).get("value");
	tel = dijit.byId('tel_'+index).get("value");
	degree = dijit.byId('degree_'+index).get("value");
	grade = dijit.byId('grade_'+index).get("value");
	part_time = dijit.byId('part_time_list_'+index).get("value");
	
	dijit.byId("kh_name_stu").attr("value",kh_name);
	dijit.byId("last_name_stu").attr("value",last_name);
	dijit.byId("first_name_stu").attr("value",first_name);
	dijit.byId("sex_stu").attr("value",gender);
	dijit.byId("age_stu").attr("value",age);
	dijit.byId("tel_stu").attr("value",tel);
	dijit.byId("degree").attr("value",degree);
	getAllGrade(grade);
	getPartTimeListByDregree(part_time);
	
}

</script>