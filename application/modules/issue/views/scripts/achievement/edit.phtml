<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	echo $this->headTitle($tr->translate("EDIT_STUDENT_ACHIEVEMENT"));
	$frm = $this->frm;
?>
<script src="<?php echo $this->baseUrl();?>/js/help.js"></script>

<div class="card">
	<div class="card-content collapse show">
		<div class="card-box">
       		<div class="col-sm-12 border-botom">
		    	<div class="col-sm-8 pd-0">
	    			<h4 class="m-b-0"><i class="fa fa-edit " aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('EDIT_STUDENT_ACHIEVEMENT');?></h4>
    			</div>
    			<div class="col-sm-4 text-right">
    			</div>
    		</div>
    	</div>
    	<form id='frm_submit' action="" dojoType="dijit.form.Form" method="post" enctype="multipart/form-data">
    	<script type="dojo/method" event="onSubmit">			
					if(this.validate()) {
						branch_id = dijit.byId('branch_id').get('value');
						if(branch_id==-1 || branch_id==""){
							alert('<?php echo $tr->translate("PLEASE_SELECT_BRANCH");?>');
							dijit.byId('branch_id').focus();
							return false;
						}
						groupId = dijit.byId('groupId').get('value');
						if(groupId=='' || groupId==-1){
							alert('<?php echo $tr->translate("PLEASE_SELECT_GROUP");?>');
							dijit.byId('groupId').focus();
							return false;
						}
						studentId = dijit.byId('studentId').get('value');
						if(studentId=='' || studentId==-1){
							alert('<?php echo $tr->translate("PLEASE_SELECT_STUDENT");?>');
							dijit.byId('studentId').focus();
							return false;
						}
						loadingBlock();
						return true;
					}else {
						return false;
					}
				</script>
    		<div class="card-box">
				<div class="col-md-4 col-sm-4 col-xs-12">
					<div class="card-blogform">
						<div class="card-body"> 
							<div class="row"> 
								<div class="col-md-12 col-sm-12 col-xs-12"> 
									<div class="d-flex"> 
										<div class="settings-main-icon ">
											<i class="material-icons-outlined">class</i>
										</div> 
										<div class="col-md-10 col-sm-10 col-xs-12"> 
											<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("GROUP_STUDENT_INFO");?></p>
										</div> 
									</div>
									<br />
									<div class="form-group">
										<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("BRANCH");?> <span class="required">*</span></label>
										<div class="col-md-7 col-sm-7 col-xs-12">
											<?php echo $frm->getElement("branch_id");?>
											<?php echo $frm->getElement("id");?>
										</div>
									 </div>
									 <div class="form-group">
										<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("ACADEMIC_YEAR");?></label>
										<div class="col-md-7 col-sm-7 col-xs-12">
											<?php echo $frm->getElement("academic_year");?>
										</div>
									 </div>
									<div class="form-group">
									   <label class="control-label bold col-md-5 col-sm-5 col-xs-12" id="lblNameControl" ><?php echo $tr->translate("GROUP");?> <span class="required">*</span>:</label>
									   <div class="col-md-7 col-sm-7 col-xs-12">
											<input id="groupId" />
									   </div>
									</div>
									<div class="form-group">
									   <label class="control-label bold col-md-5 col-sm-5 col-xs-12" id="lblNameControl" ><?php echo $tr->translate("STUDENT_NAME");?> <span class="required">*</span>:</label>
									   <div class="col-md-7 col-sm-7 col-xs-12">
											<input id="studentId" />
									   </div>
									</div>
									<div class="form-group">
										<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("achievementType");?> </label>
										<div class="col-md-7 col-sm-7 col-xs-12">
											<?php echo $frm->getElement("achievementType");?>
										</div>
									 </div>
									 <div class="form-group">
										<label class="control-label bold col-md-12 col-sm-12 col-xs-12"><?php echo $tr->translate("NOTE");?></label>
									 </div>
									 <div class="form-group">
										<div class="col-md-12 col-sm-12 col-xs-12">
											<?php echo $frm->getElement("note");?>
										</div>
									 </div>
									  <div class="form-group">
										<label class="control-label custom-switch float-end "> 
											<a href="javascript:void(0);" class="switchButton status"><?php echo $tr->translate("STATUS");?></a> 
											<input type="checkbox" id="status" name="status" class="custom-switch-input"  <?php if(!empty($this->row['status'])){ echo "checked";} ?> > 
											<span class="custom-switch-indicator custom-radius switch-status"></span> 
										</label>
									</div>
									
								 </div>
							 </div>
						 </div>
					 </div>
		         </div>
		         <div class="col-md-8 col-sm-8 col-xs-12">
					<div class="card-blogform">
						<div class="card-body"> 
							<div class="row"> 
								<div class="col-md-12 col-sm-12 col-xs-12"> 
									<div class="d-flex"> 
										<div class="settings-main-icon ">
											<i class="material-icons-outlined">feed</i>
										</div> 
										<div class="col-md-10 col-sm-10 col-xs-12"> 
											<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("TITLE");?></p>
										</div> 
									</div>
									<br />
									<div class="form-group">
										<div class="col-md-12 col-sm-2 col-xs-12">
											<?php echo $frm->getElement("title");?>
										</div>
									 </div>
									 <div class="form-group">
										<label class="control-label bold col-md-12 col-sm-12 col-xs-12"><?php echo $tr->translate("DESCRIPTION");?> </label>
										<div class="col-md-12 col-sm-2 col-xs-12">
											<?php echo $frm->getElement("description");?>
										</div>
									 </div>
								 </div>
							 </div>
						 </div>
					 </div>
					 <div class="card-blogform">
						<div class="card-body"> 
							<div class="row"> 
								<div class="col-md-12 col-sm-12 col-xs-12"> 
									<div class="form-group">
										<div class="d-flex">
											<div class="settings-main-icon ">
												<i class="glyphicon glyphicon-education" aria-hidden="true"></i>
											</div>
											<div class="col-md-10 col-sm-10 col-xs-12">
												<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("APP_NOTIFICATION"); ?></p>
											</div>
										</div>
									</div>
									<div class="form-group">
										<label class="custom-switch">
											<input type="checkbox" onChange="pushFucntionCheck();" id="push_notify" name="push_notify" class="custom-switch-input">
											<span class="custom-switch-indicator custom-radius"></span>
											<a href="javascript:void(0);" class="tx-14 mb-0 me-2"><?php echo $tr->translate('PUSH_NOTIFICATION') ?></a>
										</label>
									</div>
								 </div>
							 </div>
						 </div>
					 </div>
		         </div>
    		</div>
    		<div class="clearfix"></div>
	        <div class="card-box mt-20">
               	<div class="col-md-12 col-sm-12 col-xs-12 border-top mt-20 ptb-10 text-center">
               		 <input type="submit" class="button-class button-primary" iconClass="glyphicon glyphicon-floppy-remove" label="<?php echo $tr->translate("SAVE_CLOSE");?>" id="save_close" name="save_close" value="save_close" dojoType="dijit.form.Button" />
               	</div>
            </div>
        </form>
    </div>
</div>
<div class="dijitHidden">
	<div data-dojo-type="dijit.Dialog" data-dojo-props="title:'<?php echo $tr->translate("achievementType")?>'"  id="frmAchievementType" >
		<form id="form_propertytype" >
			<div class="card-blogform">
				<div class="card-body"> 
					<div class="row"> 
						<div class="col-md-12 col-sm-12 col-xs-12"> 
							<div class="d-flex"> 
								<div class="settings-main-icon ">
									<i class="material-icons-outlined">feed</i>
								</div> 
								<div class="col-md-10 col-sm-10 col-xs-12"> 
									<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("TITLE");?></p>
								</div> 
							</div>
							<br />
							<div class="form-group">
								<div class="col-md-12 col-sm-2 col-xs-12">
									<input dojoType="dijit.form.ValidationTextBox" placeholder="<?php echo $tr->translate("TITLE")?>" required="true" class="fullside" id="newAchievementType" name="newAchievementType" value="" type="text">
								</div>
							 </div>
						 </div>
					 </div>
				 </div>
				 <div class="clearfix"></div>
				<div class="card-box mt-20">
					<div class="col-md-12 col-sm-12 col-xs-12 border-top mt-20 ptb-10 text-center">
						 <input type="button" id="saveAchievementType" value="Save" label="<?php echo $tr->translate('GO_SAVE');?>" dojoType="dijit.form.Button"
							iconClass="dijitEditorIcon dijitEditorIconSave" onclick="addNewAchievementType();"/>
					</div>
				</div>
			 </div>
		</form>
	</div>
</div>
<script type="text/javascript">
dojo.require("dojo.data.ItemFileWriteStore");  
dojo.require("dijit.form.NumberTextBox");
dojo.require("dijit.form.DateTextBox");
dojo.require("dijit.form.Textarea");
dojo.require("dojo.NodeList-manipulate");

var group_store  = getDataStorefromJSON('id','name',<?php print_r(Zend_Json::encode(array()));?> );
dojo.ready(function(){
	new dijit.form.FilteringSelect({
		store: group_store,
	    queryExpr: "*${0}*",
		autoComplete: false,                     
		required: true,                      
	    id: "groupId",
	    name: "groupId",  
	    class: 'fullside', 
	    required:false,
	    placeHolder:"<?php echo $tr->translate("SELECT_GROUP");?>",          
	    onChange: function() {  
	    	getAllStudentName();
	    }
	}, "groupId");
	
	new dijit.form.FilteringSelect({
		autoComplete: false,
		queryExpr: "*${0}*",                     
		id: "studentId",
		name: "studentId",   
		required:true,        
		class: 'fullside', 
		placeHolder:"<?php echo $tr->translate("SELECT_STUDENT_NAME");?>",          
		onChange: function(){  
			
		}
	}, "studentId");
	
	getAllGroupByBranch();
	getAllStudentName();
}); 

var oldBranch = '<?php echo empty($this->row['branchId']) ? 0 : $this->row['branchId'];?>';
var oldGroupId = '<?php echo empty($this->row['groupId']) ? 0 : $this->row['groupId']; ?>';
var oldStudentId = '<?php echo empty($this->row['studentId']) ? 0 : $this->row['studentId']; ?>';

url_getgroup = '<?php echo $this->url(array('module'=>'foundation','controller'=>'group','action'=>'getallgroup'));?>';
function getAllGroupByBranch(){
	dijit.byId('groupId').reset();
	branch_id = dijit.byId('branch_id').get('value');
	if(branch_id=='' || branch_id==-1){
		var groupStore  = getDataStorefromJSON('id','name',<?php print_r(Zend_Json::encode(array()));?> );
		dijit.byId('groupId').set('store',groupStore);  
		dijit.byId('branch_id').focus();
		return false;
	}
	academic_year = dijit.byId('academic_year').get('value');
	
	dojo.xhrPost({
		url: url_getgroup,
		content:{
			'branch_id':branch_id,
			'academic_year':academic_year,
			'noaddnew':1,
			'forfilter':1
			},
		handleAs:"json",
		load: function(data) {
			groupStore  = getDataStorefromJSON('id','name', data);
			dijit.byId('groupId').set('store',groupStore);   
			if(oldBranch==branch_id){
				dijit.byId('groupId').set('value',oldGroupId);
			}
		},
		error: function(err) {
		}
	});
}

function getAllStudentName(){
	url_data = '<?php echo $this->url(array('module'=>'registrar','controller'=>'register','action'=>'getliststudenturl')); ?>';

	dijit.byId("studentId").reset();
	branchId = dijit.byId("branch_id").attr("value");
	if(branchId==''){
		dijit.byId("branch_id").focus();
		return false;
	}
	groupId = dijit.byId("groupId").get("value");
	if(groupId=='' || groupId=="-1"){
		groupId=0;	
	}
	dojo.xhrPost({
		url:url_data,
		content:{
			'student_name':1,
			'branch_id':branchId,
			'branchId':branchId,
			'customerType':1,
			'joinGroup':1,
			'groupId':groupId,
			'issueResult':1//for get student test get result
		},
		handleAs:"json",
		load: function(data) {
		    dijit.byId('studentId').set('store',getDataStorefromJSON('id','name', data));  
			if(oldGroupId==groupId){
				dijit.byId('studentId').set('value',oldStudentId);
			}
		},
		error: function(err) {
		}
	}); 
}

function checkAchievementType(){
	achievementType = dijit.byId("achievementType").attr("value");
	if(achievementType=='-1'){
		dijit.byId('frmAchievementType').show();
		return false;
	}
}

var achievementTypeStore  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode($this->achievementType));?> );
function addNewAchievementType(){
	if(dijit.byId('frmAchievementType').validate()) {
		var Itemmake = {					
				id: dijit.byId('newAchievementType').get('value'),
			    name: dijit.byId('newAchievementType').get('value')
		};		
		addDataToSelectbox(dijit.byId('achievementType'), achievementTypeStore, Itemmake, dijit.byId('newAchievementType').get('value'));	
		dijit.byId('newAchievementType').attr('value',dijit.byId('newAchievementType').get('value'));
		
		dijit.byId('frmAchievementType').reset();
		dijit.byId('frmAchievementType').hide();

		
	}
}
</script>