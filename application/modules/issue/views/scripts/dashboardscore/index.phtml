<?php

	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$pageTitle = $tr->translate("TEACHER_DASHBOARD_ISSUE");
	echo $this->headTitle($pageTitle);
	$base_url = Application_Form_FrmMessage::getUrl("/");
	$frm =  $this->form_search;
	$dbgb = new Application_Model_DbTable_DbGlobal();
	print_r($this->row);
?>

<style>

	ul {
	display: inline;
	margin: 0;
	padding: 0;
	}
	ul.sub_list li:hover{
		background-color: #cccccc;
	}
	ul.sub_list li{
		float: left;
		list-style: none;
	}
	ul.bg-color li{
		background-color: #cccccc;
		padding: 3px;
		border-radius: 3px;
	}
	ul.bg-head li{
		background-color: #575f69;
		padding: 4px;
		border-radius: 3px;
	}
	ul.bg li{
		background-color: white;
		padding: 3px;
		border-radius: 3px;
	}	
	.btn-sm {
		padding: 0px 10px;
		font-size: 10px;
		line-height: 1.5;
		border-radius: 3px;
	}
	
	.score-dashboard .col-md-6.col-sm-6.col-xs-12.classListSubject {
		height: 480px;
		overflow: auto;
	}
</style>
	<link href="<?php echo $base_url;?>admin/build/css/external-template.css" rel="stylesheet">
	<div class="row"> 
		<div class="col-md-12 col-sm-12 col-xs-12">
			<div class="card mb-1 pb-3 ">
				<div class="card-header pb-1"> 
					<h3 class="card-title mb-1 "><?php echo $tr->translate("SEARCH"); ?></h3> 
				</div>
				<div class="card-content">
					<div class="card-body">
						<form id="list" name="list" action="" dojoType="dijit.form.Form" method="post">
							<script type="dojo/method" event="onSubmit">			
								if(this.validate()) {
									academic_year=dijit.byId('academic_year').get('value');
									if(academic_year=='' || academic_year==0){
										alert('<?php echo $tr->translate('PLEASE_SELECT_YEAR');?>!');
										dijit.byId('academic_year').focus(); 
										return false;
									}
									exam_type=dijit.byId('exam_type').get('value');
									if(exam_type=='' || exam_type==0){
										alert('<?php echo $tr->translate('SELECT_EXAM_TYPE');?>!');
										dijit.byId('exam_type').focus(); 
										return false;
									}else if(exam_type==2){
										for_semester=dijit.byId('for_semester').get('value');
										if(for_semester=='' || for_semester==0){
											alert('<?php echo $tr->translate('SELECT_SEMESTER');?>!');
											dijit.byId('for_semester').focus(); 
											return false;
										}
									}else if(exam_type==1){
										for_month=dijit.byId('for_month').get('value');
										if(for_month=='' || for_month==0){
											alert('<?php echo $tr->translate('CHOOSE_MONTH');?>!');
											dijit.byId('for_month').focus(); 
											return false;
										}
									}
									loadingBlock();
									return true;
								}else {
									return false;
								}
							</script>
							<div class="form-group">
								<div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("adv_search");?>
								</div>
								
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("academic_year");?>
							   </div>
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("degree");?>
							   </div>
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<input id="grade" />
							   </div>
							   <div class="col-md-2 col-sm-3 col-xs-12">
									<?php echo $frm->getElement("exam_type");?>
								</div>
						   </div>
							<div class="form-group"> 
								<div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("for_semester");?>
								</div>
								<div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("for_month");?>
								</div>
								<div class="col-md-2 col-sm-2 col-xs-12"> <?php echo $frm->getElement("start_date");?></div>
								<div class="col-md-2 col-sm-2 col-xs-12"> <?php echo $frm->getElement("end_date");?></div>
								<div class="col-md-2 col-sm-2 col-xs-12">
									<button class="button-class button-primary" iconClass="glyphicon glyphicon-search" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button>
								</div>
							</div>
					   </form>
				   </div>
			   </div>
			   <div class="row score-dashboard"> 
					<?php if(!empty($this->row)) foreach($this->row as $gindex =>$row){ 
						$cardClass = "border-top-primary border-top-darken-1";
						$bgClass = "border-primary bg-gradient-directional-primary";
						if($this->search['exam_type']==2){
							$cardClass = "border-top-warnings border-top-darken-1";
							$bgClass = "border-warnings bg-gradient-directional-warnings";
						}
					?>
					<div class="col-md-12 col-sm-12 col-xs-12 classListSubject"> 
						<div class="card mb-1 <?php echo $cardClass; ?> border-top-5">
							<div class="card-content">
								<div class="row d-flex">
									<div class="col-xs-2 pr-0">
										<div class="d-flex align-items-center h-100 <?php echo $bgClass; ?>">
											<span class="text-white font-large-2 text-center">
												<?php echo $row['group_code']; ?>
												<small class="timeSchedule text-white mt-0 mb-3"><i class="glyphicon glyphicon-blackboard"></i> <?php  echo $row['room_name']; ?></small>
												<small class="timeSchedule text-white mt-0 mb-3"><i class="glyphicon glyphicon-blackboard"></i> <?php  echo $row['teaccher']; ?></small>
												<?php 
												$examType  = $this->search['exam_type'];
												$month	   = $this->search['for_month'];
												$semester  = $this->search['for_semester'];
												if($examType==1){
                                                  $examlabel =  $tr->translate("TEACHERSCORE")." : ".$tr->translate("MONTHLY")." ".$month; 
												}elseif($examType==2){
													if($semester==1){
														$examlabel= $tr->translate("TEACHERSCORE")." : ".$tr->translate("SEMESTER1");
													}elseif($semester==2){
														$examlabel= $tr->translate("TEACHERSCORE")." : ".$tr->translate("SEMESTER2");
													}
												}
											
												?>
												
											</span>
										</div>
									</div>
									<div class="col-xs-10 pl-0">
										<table class="table table-bordered">
											<thead>
												<tr>
													<th><?php echo $tr->translate("NUM"); ?></th>
													<th><?php echo $tr->translate("SUBJECT"); ?></th>
													<th><?php echo $tr->translate("TEACHER"); ?></th>
													<?php
													$criterrialList = json_decode($row["criterialList"], true);
													if(!empty($criterrialList)) foreach($criterrialList as $cindex =>$cr){ ?>
														<th><?php echo $cr['criterialTitle']; ?></th>
													<?php } ?>
												</tr>
											</thead>
											<tbody class="table-border-bottom-0">
												<?php
													$num=0;
													$jsonSubjectList = json_decode($row["jsonSubjectList"], true);
													if(!empty($jsonSubjectList)) foreach($jsonSubjectList as $sjindex =>$sj){
														$num++; ?>
														<tr>
															<td> <?php echo $num; ?> </td>
															<td> <?php echo $sj['shortcut']; ?> </td>
															<td> <?php echo $sj['teacher']; ?> </td>
															<?php
															if(!empty($criterrialList)) foreach($criterrialList as $cindex =>$cr){ ?>
																<td> 
																	<?php 
																		// $gradingTpm = array(
																		// 	'gradingId' => $row['gradingId'],
																		// 	'groupId'   => $row['id'],
																		// 	'subjectId' => $sj['subject_id'],
																		// 	'criteriaId' => $cr['criteriaId'],
																		// 	'examType'    => $examType ,
																		// 	'forSemester' => $semester ,
																		// 	'forMonth' 	  => $month ,
																		// 	'teacherId'   => $rs['teacher'] ,
																		// );
																		// $rsCriterrial= $dbg->checkCriterial($gradingTpm);
																	 ?>
																	<a class="btn btn-primary  btn-sm" href="#" role="button">11/11/24</a>
																</td>
															<?php } ?>
														</tr>
													<?php } ?>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
					<?php } ?>
				</div>
	
			</div>
		</div>
	</div>
	
<script src="<?php echo $this->baseUrl();?>/js/help.js"></script>
<script type="text/javascript">
					dojo.require('dijit.form.DateTextBox');

// $( document ).ready(function() {
//    setPageTitle('<?php echo $pageTitle; ?>');
// });

dojo.require("dojo.data.ItemFileWriteStore"); 
dojo.ready(function(){

	new dijit.form.FilteringSelect({
		queryExpr: "*${0}*",
		autoComplete: false, 
		required: false,
		id: "grade",
		name: "grade",           
		class: 'fullside',  
		placeHolder:"<?php echo $tr->translate("SELECT_GRADE");?>",          
		onChange: function() {  
		}
	}, "grade");
	
	getallGrade();
	<?php if(!empty($this->search['academic_year'])){?>
	 dijit.byId('academic_year').attr('value','<?php echo $this->search['academic_year'];?>'); 
	<?php } ?>
});

var url_dept = '<?php echo $this->url(array('module'=>'global','controller'=>'grade','action'=>'get-grade')); ?>';
function getallGrade(){
	dept_id = dijit.byId('degree').get('value');
	if(dept_id=='' || dept_id==-1){return false;}
		dojo.xhrPost({
			url:url_dept,
			content:{
				'dept_id':dept_id,
				'noaddnew':1
				},
			handleAs:"json",
			load: function(data) {
				dijit.byId('grade').attr('value','');
				grade_store  = getDataStorefromJSON('id','name', data);
			    dijit.byId('grade').set('store',grade_store); 
			    dijit.byId('grade').attr('value','<?php echo $this->search['grade']?>');    
			},
			error: function(err) {
			}
		});
}
</script>
<?php 
	//echo $this->render('externalFoot.phtml');
?>