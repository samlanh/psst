<?php 

$xml=simplexml_load_file(PUBLIC_PATH."/xml/schedule.xml", 'SimpleXMLElement', LIBXML_NOCDATA) or die("Error: Cannot create object");
$dbxml = new Issue_Model_DbTable_DbImportxml;
$array = json_decode(json_encode((array)$xml), TRUE);
//print_r($xml->attributes);

// print_r($array["periods"]["@attributes"]["columns"]);
// $tableData = $array["daysdefs"]["daysdef"];
// $periodsColumn = $array["daysdefs"]["@attributes"]["columns"];
// $columnList = explode(',', $periodsColumn);

// if(!empty($tableData)) foreach($tableData as $row){
// 	foreach ($columnList as $i){
// 		echo $i."=".$row["@attributes"][$i]." ";
// 	}
// 	echo "<br />";
// }


// function getTableData($tableName, $rowName){
// 	print_r($array["$tableName"]["@attributes"]["columns"]);
// 	$tableData = $array["daysdefs"]["daysdef"];
// 	$periodsColumn = $array["$tableName"]["@attributes"]["columns"];
// 	$columnList = explode(',', $periodsColumn);
// }



// $tableData = $array["subjects"]["subject"];
// $periodsColumn = $array["subjects"]["@attributes"]["columns"];
// $columnList = explode(',', $periodsColumn);
// if(!empty($tableData)) foreach($tableData as $row){

// 	$subjectTitle =$row["@attributes"]['name'];
// 	$strId =$row["@attributes"]['id'];
// 	$Subject = $dbxml->getSubjectId($subjectTitle,$strId);
// }

// $tableData = $array["teachers"]["teacher"];
// $periodsColumn = $array["teachers"]["@attributes"]["columns"];
// $columnList = explode(',', $periodsColumn);
// if(!empty($tableData)) foreach($tableData as $row){

// 	$teacherTitle =$row["@attributes"]['name'];
// 	$strId =$row["@attributes"]['id'];
// 	$gender =$row["@attributes"]['gender'];
// 	$teacher = $dbxml->getTeacherId($teacherTitle,$gender,$strId);
// }

// $tableData = $array["classes"]["class"];
// $periodsColumn = $array["classes"]["@attributes"]["columns"];
// $columnList = explode(',', $periodsColumn);

// if(!empty($tableData)) foreach($tableData as $row){
// 	$groupCode = str_replace('Grade ','',$row["@attributes"]['name']);
// 	$strId =$row["@attributes"]['id'];
// 	$groupId = $dbxml->getGroupId($groupCode,$strId);
// }

// $tableData = $array["cards"]["card"];
// if(!empty($tableData)) foreach($tableData as $row){
// 	$lessionId = $row["@attributes"]['lessonid'];
// 	$period = $row["@attributes"]['period'];
// 	$days = $row["@attributes"]['days'];
// 	$dbxml->addcard($lessionId,$period,$days);
// }

$tableData = $array["lessons"]["lesson"];
$periodsColumn = $array["classes"]["@attributes"]["columns"];
$columnList = explode(',', $periodsColumn);

if(!empty($tableData)) foreach($tableData as $row){
	$subjectId= $dbxml->getSubjectIdbyStrId($row["@attributes"]['subjectid']);
	$teacherId = $dbxml->getTeacherIdbyStrId($row["@attributes"]['teacherids']);
	$groupId = $dbxml->getGroupIdbyStrId($row["@attributes"]['classids']);
	
// 	echo $subjectId."subject<br />";
// 	echo $teacherId."teacherId<br />";
// 	echo $groupId."groupId<br />";
	
	$lessionId = $row["@attributes"]['id'];
	
	$data = array(
					'subject_id'=>$subjectId,
					'techer_id' =>$teacherId,
					'note'=>'abc',
			);
// 	$dbxml->updateExistingSchedule($lessionId,$data,$groupId);
}



?>
