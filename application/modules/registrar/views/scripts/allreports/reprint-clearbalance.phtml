<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle('Reprint Student test Payment'); 
	echo $this->headTitle();
	$base_url = Application_Form_FrmMessage::getUrl("/");
?>
<style>
#footer{display: none;}
table tr td strong{
	padding-left: 0px;
}
.defaulheight{line-height: 22px !important;}
</style>
<table width="100%" style="margin: 0px; font-family:'khmer os battambang';">
   <tr>
       <td colspan="5">
			<div class="menureport">
				<ul>
					<li class="preview"><a title="Preview" href="#" onclick="preview();"></a></li>
					<li class="print"><a href="#" title="Print" onclick="doPrint();" ></a></li>
					<li class="excel"><a href="#"  title="Export"  onclick="exportExcel();"></a></li>
				</ul>
			</div>
      </td>
	</tr>
</table>	
<div style="border: 1px dotted #000;background: #fff; margin: 0 auto;min-height: 27cm;width:22cm;padding:1cm;">
		<div id="divPrint">
			<?php 
			$amount_print = $this->data['receipt_print'];
			for($prin=0;$prin<$amount_print;$prin++){?>
			<table width="100%"  class="print" cellspacing="0"  cellpadding="0" style="height:10.97cm; font-family: 'Khmer OS Battambang' !important; font-size:11px !important; margin-top: -14px;white-space:nowrap;">
				<tr height="90px;">
					<td colspan="10"  style="" align="center" valign="top">
						<?php echo $this->header?>
					</td>
				</tr>
				
				<style>
					.bold{
						font-weight:bold;
						}
				</style>
				<tr height="40px;">
					<td colspan="10"  style="" align="center" valign="top">
						<table width="100%" style="font-size: 10px;margin-top: -15px;">
							<tr>
								<td width="30%"></td>
								<td align="center" width="40%" style="font-size: 16px;font-weight: bold;line-height: 20px;">
									<div style="font-family:Khmer OS Muol, Times New Roman;font-size: 16px;">បង្កាន់ដៃបង់ប្រាក់</div>
									OFFICIAL RECEIPT
								</td>
								<td width="30%" valign="center" align="center">
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<style>
					.h{ margin-top: -3px;margin-bottom: 3px;}
					.tab_row{ margin-top: -8px;}
					
					.h1{ margin-top: -6px;}
					.values{ min-height: 25px; padding: 3px 5px;display: block; font-family: Khmer OS battambang ,Times New Roman;margin-top:3px;}
							
					.fonteng{font-size:16px;}
					.one{white-space:nowrap;font-size:16px;}
					.border{border:1px solid #000; min-width:220px}
				</style>
				<tr>
					<td colspan="10" valign="top">
						<table class='defaulheight' width="100%" border="0" style="font-family: Khmer OS Battambang , Times New Roman;font-size:12px; white-space:nowrap;margin-top:-5px;line-height: 20px;">
							<tr style="height: 30px;">
								<td class="one ">&nbsp;<?php echo $tr->translate("STUDENT_ID");?>&nbsp;</td>
								<td class="border values one"><?php echo $this->row['stu_code']?> </td>
								<td class="one " align="left">&nbsp;<?php echo $tr->translate("RECEIPT");?>&nbsp;</td>
								<td class="border values one"><?php echo $this->row['receipt_no'];?><?php if($this->row['is_void']==1){echo "(Void)";}?></td>
							</tr>
							
							<tr style="height: 30px;">
								<td class="one ">&nbsp;<?php echo $tr->translate("NAME_KH");?>&nbsp;</td>
								<td class="border values one"><?php echo $this->row['stu_khname']?> </td>
								<td class="one " align="left">&nbsp;<?php echo $tr->translate("TOTAL_BALANCE");?>&nbsp;</td>
								<td class="border values one"><?php echo "$ ".number_format($this->row['total_balance'],2)?></td>
							</tr>
							
							<tr style="height: 30px;">
								<td class="one ">&nbsp;<?php echo $tr->translate("NAME_EN");?>&nbsp;</td>
								<td class="border values one"><?php echo $this->row['stu_enname']?> </td>
								<td class="one " align="left">&nbsp;<?php echo $tr->translate("PAID_AMOUNT");?>&nbsp;</td>
								<td class="border values one"><?php echo "$ ".number_format($this->row['paid_amount'],2)?></td>
							</tr>
							
							<tr style="height: 30px;">
								<td class="one ">&nbsp;<?php echo $tr->translate("ON_RECEIPT");?>&nbsp;</td>
								<td class="border values one"><?php echo $this->row['receipt_number']?> </td>
								<td class="one " align="left">&nbsp;<?php echo $tr->translate("BALANCE");?>&nbsp;</td>
								<td class="border values one"><?php echo "$ ".number_format($this->row['balance'],2)?></td>
							</tr>
							
							<tr style="height: 30px;">
								<td class="one ">&nbsp;<?php echo $tr->translate("DATE_BALANCE");?>&nbsp;</td>
								<td class="border values one"><?php echo date("d/m/Y",strtotime($this->row['date_balance']))?> </td>
								<td class="one " align="left">&nbsp;<?php echo $tr->translate("NOTE");?>&nbsp;</td>
								<td class="border values one">&nbsp;<?php echo $this->row['note']?></td>
							</tr>
							
							<tr style="font-size: 15px; font-weight:bold;font-family:'Khmer MEF2'">
								<td colspan="2" align="center" >អ្នកប្រគល់</td>
								<td colspan="2" align="center">អ្នកទទួល</td>
							</tr>
							<tr style="font-size: 15px;">
								<td colspan="4" align="center">&nbsp;</td>
							</tr>
							<tr style="font-size: 15px;">
								<td colspan="4" align="center">&nbsp;</td>
							</tr>
							<tr style="font-size: 15px;">
								<td colspan="2" align="center"></td>
								<td colspan="2" align="center" style="line-height: 13px;">
									<h4 style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 13px;font-family:'Khmer OS Battambang';"> 
								        <?php 
										   echo $this->row['last_name']." ".$this->row['first_name'];
										?>
					        		</h4>
					        		<div style="font-size: 12px;margin-top:-10px;">
					        			<?php  echo date("F j, Y, g:i a",strtotime($this->row['create_date']));?>
					        		</div>
					        	</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<?php //if($print==0){?>
				<!-- <hr style="border:1px dotted #000;" /> -->
			<?php }//}?>
			
	</div>	
</div>

<?php if($this->row['is_void']==0){?>
<form id='office_receipt' action="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'reprint-clearbalance')); ?>" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
	<div class="card-box">
		<div class="col-sm-12 border-top mt-20 ptb-10 text-center">
				<input type="button" name="save_close" id="save_close" onclick="confirmBeforePrint();" value="1" label="<?php echo $tr->translate('IS_VOID');?>"   dojoType="dijit.form.Button" 
			 iconClass="dijitEditorIcon dijitEditorIconSave"  />
		</div>
	</div>
</form>
<?php }?>

<div class="dijitHidden" style="padding: 0px; margin: 0px;">
	<div id="alertBeforePrint" data-dojo-type="dijit.Dialog" style="width:10cm;height: 5cm ;" align="center" data-dojo-props="title:'<?php echo $tr->translate("បោះពុម្ពបង្កាន់ដៃ");?>'"  >
		<table width="100%"  class="print" cellspacing="0"  cellpadding="0" style="height:4cm;color:red; font-family: 'Khmer OS Battambang' !important;font-size:15px !important;white-space:nowrap;">
			<tr>
				<td align="center" >
					តើលោកអ្នកពិតជាចង់បោះពុម្ពបង្កាន់ដៃនេះ មែនទេ? <br />
					Do you really want to print ?
				</td>
			</tr>
			<tr>
				<td align="center">
					<button dojoType="dijit.form.Button" iconClass="dijitEditorIcon dijitEditorIconCancel"
						type="button" onclick="hideDialog1();">No</button>
					<button dojoType="dijit.form.Button" iconClass="dijitEditorIcon dijitEditorIconPrint"
						type="button" onclick="submitDataClose()"><?php echo $tr->translate("Yes");?></button>
				</td>
			</tr>
		</table>
	</div>
</div>

<script type="text/javascript">
	function confirmBeforePrint(){
		dijit.byId('alertBeforePrint').show();
	}
	function hideDialog1(){
		dijit.byId('alertBeforePrint').hide();
	}
	function submitDataClose(){
		var url_submit = '<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'reprint-clearbalance')); ?>';
		loading();
		dojo.xhrPost({
			url: url_submit,	
			form: dojo.byId("office_receipt"),		    
			load: function(data) {
				document.getElementsByClassName("overlay")[0].style.display="none";	
				alert('<?php echo $tr->translate('SUCCESS');?> !');
				window.location.href ="<?php echo $this->baseUrl();?>/registrar/allreports/rpt-daily";
			},
			error: function(e) {
				
			}
		});
	}
	function loading(){
		document.getElementsByClassName("overlay")[0].style.display="block";
	}
</script>
<div class="overlay">
	<div class="overlay-load">
		<div class="overlay-msg">
	    </div>
	</div>
</div>	
<style>
.overlay {display: none;position: absolute;width: 100%;height: 150%;top: 0px;left: 0px;background: #FCFCFC;z-index: 1001;opacity: .5;}
.overlay-load {width: 350px;height: 100px;margin: auto;top: 0px;bottom: 0px;position: absolute;left: 0px;right: 0px;
           text-align: center;
           background: #fff url("<?php echo $this->baseUrl()?>/images/loading.gif") 50% 25%;
           background-repeat: no-repeat;          
}
.overlay-msg{margin-bottom: 10px;bottom: 0px;position: absolute;font-style: italic;color: rgb(19, 19, 19);} 
</style>





