<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle('Dialy Payment Report'); 
	echo $this->headTitle();
	$base_url = Application_Form_FrmMessage::getUrl("/");
	$session_user=new Zend_Session_Namespace('authstu');
	$user_id=$session_user->user_id;
	$frm =  $this->form_search;
?>
<div style="min-height:10cm; margin:0 auto; padding:0.2cm 0.2cm 0cm 0.2cm">	
<form  id='foundation_class' action="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'rpt-daily')); ?>" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
	<table width="100%" style="margin: 0px; font-family:'khmer os battambang';">
		<tr> 
			<td><input dojoType="dijit.form.TextBox" class="fullside" id="adv_search" name="adv_search" value="<?php echo $this->search['adv_search']?>" placeholder="Search" type="text" ></td>
			<td><?php echo $frm->getElement("start_date");?></td>
			<td><?php echo $frm->getElement("end_date");?></td>
			<td><?php echo $frm->getElement("stu_code");?></td>
			<td><?php echo $frm->getElement("stu_name");?></td>
		</tr>
		<tr>
			<td> <?php echo $frm->getElement("degree");?></td>
			<td> <?php echo $frm->getElement("grade_all");?></td>
			<td> <?php echo $frm->getElement("session");?></td>
			<td> <?php echo $frm->getElement("user");?></td>
			<td> <button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button></td>
		</tr>
		<tr>
			<td colspan="5">
				<div style="margin: 10px 0px;">
					<input type="checkBox" style="margin-left: 1%;" dojoType="dijit.form.CheckBox" value="all" id="all_payment" name="all_payment"  <?php if(!empty($this->search['all_payment'])){if($this->search['all_payment']=="all"){echo "checked='checked'";}}?> /><?php echo $tr->translate("RPT_ALLPAYMENTREPORT");?>
					<input type="checkBox" style="margin-left: 3%;" dojoType="dijit.form.CheckBox" value="1" id="student_payment" name="student_payment"  <?php if(!empty($this->search['student_payment'])){if($this->search['student_payment']==1){echo "checked='checked'";}}?>/><?php echo $tr->translate("STUDENT_PAYMENT_INCOME");?>
					<input type="checkBox" style="margin-left: 3%;" dojoType="dijit.form.CheckBox" value="3" id="income" name="income"  <?php if(!empty($this->search['income'])){if($this->search['income']==3){echo "checked='checked'";}}?> /> <?php echo $tr->translate("OTHER_INCOME");?>
					<input type="checkBox" style="margin-left: 3%;" dojoType="dijit.form.CheckBox" value="4" id="expense" name="expense"  <?php if(!empty($this->search['expense'])){if($this->search['expense']==4){echo "checked='checked'";}}?> /><?php echo $tr->translate("OTHER_EXPENSE");?>
					<input type="checkBox" style="margin-left: 3%;" dojoType="dijit.form.CheckBox" value="5" id="change_product" name="change_product"  <?php if(!empty($this->search['change_product'])){if($this->search['change_product']==5){echo "checked='checked'";}}?> /><?php echo $tr->translate("CHANGE_PRODUCT");?>
					<input type="checkBox" style="margin-left: 3%;" dojoType="dijit.form.CheckBox" value="6" id="customer_payment" name="customer_payment"  <?php if(!empty($this->search['customer_payment'])){if($this->search['customer_payment']==6){echo "checked='checked'";}}?> /><?php echo $tr->translate("CUSTOMER_PAYMENT");?>
				</div>
				<div style="margin: 10px 0px;">
					<input type="checkBox" style="margin-left: 1%;" dojoType="dijit.form.CheckBox" value="7" id="clear_balance" name="clear_balance"  <?php if(!empty($this->search['clear_balance'])){if($this->search['clear_balance']==7){echo "checked='checked'";}}?> /><?php echo $tr->translate("STUDENT_CLEAR_BALANCE");?>
				</div>
			</td>
		</tr>
	</table>
</form>
<style>
.hover:hover{ background: #ddd;}
</style>
		<div id="divPrint" >
			<table style="background:#fff; margin: 0 auto; width:100%;white-space: nowrap;" >
				<tr style="font-size: 12px;">
					<td width="15%" align="center">
						<img style="width:60%;" alt="<?php ?>" src="<?php echo $this->baseUrl().'/images/logo.png'?>"><br />
					</td>
					<td align="center"  width="70%">
						<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 16px;font-family:'Khmer MEF2';"><?php echo $tr->translate("CUSTOMER_BRANCH"); ?></strong><br />
						<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 16px;font-family:'Khmer MEF2';"><?php echo $tr->translate("STUDENT_PAYMENT_RECEIPT"); ?></strong><br />
						<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 14px;font-family:'Khmer MEF2';">For Date <?php echo date("d-M-Y",strtotime($this->search["start_date"]))?> to <?php echo date("d-M-Y",strtotime($this->search["end_date"]));?></strong><br />
					</td>
					<td width="15%">&nbsp;</td>
				</tr>
				<tr>
					<td colspan="3" id="exportExcel">
						<table style="width:100%;font-family: Khmer OS Battambang,Times New Roman; white-space: nowrap; !important;">
							<?php if (!empty($this->row)){  ?>
							<tr>
								<td colspan="2"><strong><?php echo $tr->translate("STUDENT_PAYMENT_INCOME");?></strong></td>
							</tr>
							<?php }?>
							<tr >
								<td colspan="2">
									<table class="padd" width="100%" border="1" align="center" style="font-family: Khmer OS Battambang,Times new roman;">
										 <?php 
										 	$i=0; $total=0;$total_paid=0;$total_balance=0;
										 	$comple_b=0; $isset =0; $total_other_income=0;
										 	$total_other_expense=0;
										 	$total_income_dollar=0;
										 	$total_income_kh = 0;
										 	$total_expense_dollar = 0;
										 	$total_expense_kh =0;
										 	$total_stu_test=0;
											$total_stu_clear_balance=0;
										 	$total_payment=0;
										 	$fine = 0;
										 	$credit_memo = 0;
										 	$deduct = 0;
										 	$total_payment_change_product = 0;
										 	$total_credit_memo_change_product = 0;
										 	
										 	$total_customer_payment = 0;
										 	
										 	$net_amount = 0;
											$paid_amount = 0;
											$balance = 0;
										 	if (!empty($this->row)){  
										 ?>
										  <thead>
											  <tr style="font-size:11px; height: 20px; white-space:nowrap;background: #ccd9ff !important; line-height: 30px; font-weight: bold;" align="center">
											    <td><?php echo $tr->translate("N_O"); ?></td>
											    <td><?php echo $tr->translate("RECEIPT_NO"); ?></td>
											    <td><?php echo $tr->translate("STUDENT_ID"); ?></td>
												<td><?php echo $tr->translate("STUDENT_NAME"); ?></td>
												<td><?php echo $tr->translate("TYPE"); ?></td>
												<td><?php echo $tr->translate("DEGREE"); ?></td>
												<td><?php echo $tr->translate("GRADE"); ?></td>
												<td><?php echo $tr->translate("SESSION"); ?></td>
												<td><?php echo $tr->translate("FINE"); ?></td>
												<td><?php echo $tr->translate("TOTAL_PAYMENT"); ?></td>
												<td><?php echo $tr->translate("Credit Memo"); ?></td>
												<td><?php echo $tr->translate("PAID_AMOUNT"); ?></td>
												<td><?php echo $tr->translate("BALANCE"); ?></td>
												<td><?php echo $tr->translate("CREATE_DATE"); ?></td>
												<td><?php echo $tr->translate("NOTE"); ?></td>
												<td><?php echo $tr->translate("USER"); ?></td>
												<td><?php echo $tr->translate("STATUS"); ?></td>
												<td><?php echo $tr->translate("VOID_BY"); ?></td>
											  </tr>
										  </thead>
										 <?php foreach($this->row as $rs){ $i++;?>
										  <tr style="font-size:11px; height: 20px;"​ class="hover">
										    <td <?php if($rs['is_void']==1){echo "style='color:red;'";}?>><?php echo $i;?></td>
										    <td><?php echo $rs['receipt_number']; ?></td>
										    <td><?php echo $rs['stu_code']; ?></td>
										    <td style=" white-space:nowrap; text-align:left">&nbsp;<a style="color: #000;" target="_blank" href="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'rptreceiptdetail','id'=>$rs['id']))?>"><?php echo !empty($rs['stu_khname'])?$rs['stu_khname']:$rs['stu_enname']; ?></a></td>
											<td><?php //echo $rs['type']; ?></td>
											<td><?php echo $rs['degree']; ?></td>
											<td><?php echo $rs['grade']; ?></td>
											<td><?php echo $rs['session']; ?></td>
											<td><?php if($rs['penalty']>0){echo '$ '.number_format($rs['penalty'],2);} ?></td>
											<td><?php echo '$ '.number_format($rs['grand_total'],2); ?></td>
										    <td><?php if($rs['credit_memo']>0){echo '$ '.number_format($rs['credit_memo'],2);} ?></td>
											<td><?php echo '$ '.number_format($rs['paid_amount'],2); ?></td>
											<td><?php echo '$ '.number_format($rs['balance_due'],2); ?></td>
										    <td><?php echo date('d-M-Y (H:i:s)', strtotime($rs['create_date'])); ?></td>
										   	<td><?php echo $rs['note']; ?></td>
										    <td><?php echo $rs['user_id'];?></td>
										    <td <?php if($rs['is_void']==1){echo "style='color:red;'";}?>><?php echo $rs['void_status'];?></td>
										    <td><?php echo $rs['void_by'];?></td>
										  </tr>
										  	 <?php 
										  	 	if($rs['is_void']==0){
										  	 		$total_payment = $total_payment + $rs['total_payment'];
										  	 		$fine = $fine + $rs['penalty'];
										  	 		$credit_memo = $credit_memo + $rs['credit_memo'];
										  	 		
									  	 			$net_amount = $net_amount + $rs['grand_total'];
													$paid_amount = $paid_amount + $rs['paid_amount'];
													$balance = $balance + $rs['balance_due'];
									  	 		} 
										  	 ?>
										  <?php } ?>
										  <?php } ?>
									</table>
									<table width="100%" style="margin-top: 5px;">
									<?php if(!empty($this->row)){?>
										<tr>
											<td colspan="3">
												<table width="400px" border="1" align="right" style="white-space:nowrap;font-family: Khmer OS Battambang,Times new roman;">
													<tr align="center" style="font-size:13px; color:#000; height: 23px; background-color: #ccd9ff;"​ >
										 				<td style=""><?php echo $tr->translate("TOTAL_PAYMENT");?></td>
										 				<td style=""><?php echo $tr->translate("FINE");?></td>
										 				<td style=""><?php echo $tr->translate("CREDIT_MEMO");?></td>
										 				<td style=""><?php echo $tr->translate("DEDUCT");?></td>
										 				<td style=""><?php echo $tr->translate("NET_AMOUNT");?></td>
														<td style=""><?php echo $tr->translate("PAID_AMOUNT");?></td>
														<td style=""><?php echo $tr->translate("BALANCE");?></td>
											  		</tr>
											  		<tr align="center" style="font-size:12px; color:red; height: 23px;"​ >
										 				<td style=""><?php echo '$ '.number_format($total_payment,2);?></td>
										 				<td style=""><?php echo '$ '.number_format($fine,2);?></td>
										 				<td style=""><?php echo '$ '.number_format($credit_memo,2);?></td>
										 				<td style=""><?php echo '$ '.number_format($deduct,2);?></td>
										 				<td style=""><?php echo '$ '.number_format($net_amount,2);?></td>
														<td style=""><?php echo '$ '.number_format($paid_amount,2);?></td>
														<td style=""><?php echo '$ '.number_format($balance,2);?></td>
											  		</tr>
												</table>
											</td>
										</tr>
									<?php }?>
									</table>
								</td>
							</tr>
							
							<?php if(!empty($this->clear_balance)){ ?>
							<tr >
								<td colspan="2"><strong style="font-size: 14px;"><?php echo $tr->translate("STUDENT_CLEAR_BALANCE");?></strong></td>
							</tr>
							<tr >
								<td colspan="2">
									<table class="padd" border="1" width="100%" align="center" style="white-space: nowrap;margin-top:5px;font-family: Khmer OS Battambang,Times new roman;">
									 <thead>
										<tr style=" white-space: nowrap;font-size:12px; height: 20px;border: 1px solid #000;background-color: #ccd9ff;line-height: 30px;font-weight: bold;" align="center" >
											<td style="border: 1px solid #000;"><?php echo $tr->translate('N_O')?></td>
											<td><?php echo $tr->translate("RECEIPT_NO");?></td>
											<td><?php echo $tr->translate("STUDENT_ID");?></td>
											<td><?php echo $tr->translate("STUDENT_NAME");?></td>
											<td><?php echo $tr->translate('ON_RECEIPT')?></td>
											<td><?php echo $tr->translate('TOTAL_BALANCE')?></td>
											<td><?php echo $tr->translate('PAID_AMOUNT')?></td>
											<td><?php echo $tr->translate('BALANCE')?></td>
											<td><?php echo $tr->translate('NOTE')?></td>
											<td><?php echo $tr->translate("CREATE_DATE"); ?></td>
											<td><?php echo $tr->translate('USER')?></td>
											<td><?php echo $tr->translate('STATUS')?></td>
											<td><?php echo $tr->translate("VOID_BY"); ?></td>
										</tr>
									 </thead>
										 <style> td{padding:0 3px; }</style>
									<?php $i=0;foreach($this->clear_balance as $clear_balance){ $i++;?>
										<tr class="hover" style="font-size:12px; height: 20px;border: 1px solid #000;" align="center" >
											<td style="border: 1px solid #000;"><?php echo $i;?></td>
											<td style="border: 1px solid #000;"><a style=" text-decoration: none; color:#000;" href="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'reprint-clearbalance','id'=>$clear_balance['id']));?>" target="blank"><?php echo $clear_balance['receipt_no']; ?></a></td>
											<td style="border: 1px solid #000;"><a style=" text-decoration: none; color:#000;" href="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'reprint-clearbalance','id'=>$clear_balance['id']));?>" target="blank"><?php echo $clear_balance['stu_code']; ?></a></td>
											<td style="border: 1px solid #000;text-align: left;"><a style=" text-decoration: none; color:#000;" href="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'reprint-clearbalance','id'=>$clear_balance['id']));?>" target="blank"><?php echo $clear_balance['stu_khname'].'-'.$clear_balance['stu_enname']; ?></a></td>
											<td style="border: 1px solid #000;"><?php echo $clear_balance['receipt_number'];?></td>	
											<td style="border: 1px solid #000;"><?php echo "$ ".number_format($clear_balance['total_balance'],2);?></td>
											<td style="border: 1px solid #000;"><?php echo "$ ".number_format($clear_balance['paid_amount'],2);?></td>
											<td style="border: 1px solid #000;"><?php echo "$ ".number_format($clear_balance['balance'],2);?></td>
											<td style="border: 1px solid #000;"><?php echo $clear_balance['note'];?></td>
											<td style="border: 1px solid #000;"><?php echo date("d-m-Y",strtotime($clear_balance['create_date']));?></td>
											<td style="border: 1px solid #000;"><?php echo $clear_balance['user'];?></td>
											<td style="border: 1px solid #000;"><?php echo $clear_balance['status'];?></td>
											<td style="border: 1px solid #000;"><?php echo $clear_balance['void_by'];?></td>
										</tr>
											<?php
												if($clear_balance['is_void']==0){
													$total_stu_clear_balance = $total_stu_clear_balance + $clear_balance['paid_amount'];
												}
											?> 
										 <?php } ?>
										 <tr>
											<td colspan="11"></td>
											<td style="width:120px;background-color: #ccd9ff; font-weight:bold; font-size: 12px;">&nbsp;<?php echo $tr->translate("GRAND_TOTAL_PAID_AMOUNT"); ?>&nbsp;</td>
											<td style="width:120px;color:#F00; font-weight:bold; font-size: 12px;">$ <?php echo number_format($total_stu_clear_balance,2);?></td>
										</tr>
									</table>
								</td>
							</tr>
							<?php }?>
							
							<?php if(!empty($this->income)){?>
							<tr>
								<td colspan="2"><strong style="font-size: 14px;"><?php echo $tr->translate("OTHER_INCOME");?></strong> </td>
							</tr>
							<tr>
								<td colspan="2">
									<table class="padd" width="100%" border="1" align="center" style="margin-top:5px;font-family: Khmer OS Battambang,Times new roman;">
										<tr style="font-size:12px; height: 20px;border: 1px solid #000;background-color: #ccd9ff;line-height: 30px;font-weight: bold;" align="center" >
											<td style="border: 1px solid #000;"><?php echo $tr->translate('N_O')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('TITLE')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('INVOICE_NO')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('INCOME_CATEGORY')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('PAYMENT_METHOD')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('TOTAL')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('FOR_DATE')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('USER')?></td>
										</tr>
										 <style> td{padding:0 3px; }</style>
									<?php $i=0;$total_income_kh=0;foreach($this->income as $row){ $i++;?>
										<tr class="hover" style="font-size:12px; height: 20px;border: 1px solid #000;" align="center" >
											<td style="border: 1px solid #000;"><?php echo $i;?></td>
											<td style="border: 1px solid #000;text-align: left;"><?php echo $row['title'];?></td>
											<td style="border: 1px solid #000;"><a style=" text-decoration: none; color:#000;" href="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'reprint-other-income','id'=>$row['id']));?>" target="blank"><?php echo $row['invoice'];?></a></td>
											<td style="border: 1px solid #000;"><?php echo $row['income_category'];?></td>
											<td align="center" style="border: 1px solid #000;"><?php echo $row['payment_method'];?></td>	
											<td style="border: 1px solid #000;"><?php echo '$ '.number_format($row['total_amount'],2);?></td>
											<td style="border: 1px solid #000;"><?php echo date('d-M-Y',strtotime($row['date']));?></td>
											<td style="border: 1px solid #000;"><?php echo $row['name'];?></td>
										</tr>
											<?php 
												$total_income_dollar = $total_income_dollar + $row['total_amount'];
											?> 
										 <?php } ?>
										 <tr>
											<td colspan="6"></td>
							 				<td style="width:120px;background-color: #ccc; font-weight:bold; font-size: 12px;">&nbsp;<?php echo $tr->translate("GRAND_TOTAL"); ?>&nbsp;</td>
											<td style="width:120px;color:#F00; font-weight:bold; font-size: 12px;">$ <?php echo number_format($total_income_dollar,2);?></td>
										</tr>
										 
									</table>
								</td>
							</tr>
							<?php }?>
							<?php if(!empty($this->expense)){?>
							<tr >
								<td  colspan="2"><strong style="font-size: 14px;"><?php echo $tr->translate("OTHER_EXPENSE");?></strong></td>
							</tr>
							<tr>
								<td colspan="2">
									<table class="padd" width="100%" border="1" align="center" style="margin-top:5px;font-family: Khmer OS Battambang,Times new roman;">
										<tr style="font-size:12px; height: 20px;border: 1px solid #000;background-color: #ccd9ff;line-height: 30px;font-weight: bold;" align="center" >
											<td style="border: 1px solid #000;"><?php echo $tr->translate('N_O')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('TITLE')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('INVOICE_NO')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('PAYMENT_METHOD')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('TOTAL')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('FOR_DATE')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('USER')?></td>
										</tr>
										 <style>td{padding:0 3px; }</style>
										<?php $i=0;$total_expense_kh=0;$total_expense_dollar=0;foreach($this->expense as $row){ $i++;?>
										<tr class="hover" style="font-size:12px; height: 20px;border: 1px solid #000;" align="center" >
											<td style="border: 1px solid #000;"><?php echo $i;?></td>
											<td style="border: 1px solid #000; text-align: left;">&nbsp;<a style=" text-decoration: none; color:#000;" href="<?php echo $this->url(array('module'=>'allreport','controller'=>'accounting','action'=>'rpt-income-expense-detail','id'=>$row['id']));?>" target="blank"><?php echo $row['title']; ?></a></td>
											<td style="border: 1px solid #000;"><a style=" text-decoration: none; color:#000;" href="<?php echo $this->url(array('module'=>'allreport','controller'=>'accounting','action'=>'rpt-income-expense-detail','id'=>$row['id']));?>" target="blank"><?php echo $row['invoice']; ?></a></td>
											<td align="center" style="border: 1px solid #000;"><a style=" text-decoration: none; color:#000;" href="<?php echo $this->url(array('module'=>'allreport','controller'=>'accounting','action'=>'rpt-income-expense-detail','id'=>$row['id']));?>" target="blank"><?php echo $row['payment_type']; ?></a></td>	
											<td style="border: 1px solid #000;"><?php echo '$ '.number_format($row['total_amount'],2);?></td>
											<td style="border: 1px solid #000;"><?php echo date('d-M-Y',strtotime($row['date']));?></td>
											<td style="border: 1px solid #000;"><?php echo $row['name'];?></td>
										</tr>
											<?php 
												$total_expense_dollar = $total_expense_dollar + $row['total_amount'];
											?> 
										 <?php } ?>
										 <tr>
										 	<td colspan="5"></td>
										 	<td style="width:120px;background-color: #ccc;font-weight:bold; font-size: 12px;">&nbsp;<?php echo $tr->translate("GRAND_TOTAL"); ?>&nbsp;</td>
											<td style="width:120px; color:#F00; font-weight:bold; font-size: 12px;">$ <?php echo number_format($total_expense_dollar,2);?></td>
										 </tr>
									</table>
								</td>
							</tr>
							<?php }?>
							
							<?php if(!empty($this->change_product)){?>
							<tr>
								<td colspan="2"><strong><?php echo $tr->translate("CHANGE_PRODUCT");?></strong></td>
							</tr>
							<tr>
								<td colspan="2">
									<table class="padd" width="100%" border="1" align="center" style="margin-top:5px;font-family: Khmer OS Battambang,Times new roman;">
										<thead>
										<tr style="font-size:12px; height: 20px;border: 1px solid #000;background-color: #ccd9ff;line-height: 30px;font-weight: bold;" align="center" >
											<td style="border: 1px solid #000;"><?php echo $tr->translate('N_O')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('INVOICE_NO')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('NAME')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('TOTAL_PAYMENT')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('CREDIT_MEMO')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('CREATE_DATE')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('USER')?></td>
											<td style="border: 1px solid #000;"><?php echo $tr->translate('STATUS')?></td>
										</tr>
									   </thead>
										 <style> td{padding:0 3px; }</style>
									<?php $i=0;foreach($this->change_product as $row){ $i++;?>
										<tr class="hover" style="font-size:12px; height: 20px;border: 1px solid #000;" align="center" >
											<td><?php echo $i;?></td>
											<td <?php if($row['is_void']==1){echo 'style="color:red;"';}?>><a style="color: #000;" target="_blank" href="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'reprint-changeproduct','id'=>$row['id']))?>"><?php echo $row['receipt_no'];?></a></td>
											<td><a style="color: #000;" target="_blank" href="<?php echo $this->url(array('module'=>'registrar','controller'=>'allreports','action'=>'reprint-changeproduct','id'=>$row['id']))?>"><?php echo $row['name'];?></a></td>
											<td <?php if($row['is_void']==1){echo 'style="color:red;"';}?>><?php if($row['total_payment']>0){echo '$ '.number_format($row['total_payment'],2);}?></td>	
											<td <?php if($row['is_void']==1){echo 'style="color:red;"';}?>><?php if($row['credit_memo']>0){echo '$ '.number_format($row['credit_memo'],2);}?></td>
											<td><?php echo date('d-M-Y',strtotime($row['create_date']));?></td>
											<td><?php echo $row['user'];?></td>
											<td <?php if($row['is_void']==1){echo 'style="color:red;"';}?>><?php echo $row['status'];?></td>
										</tr>
											<?php 
												if($row['is_void']==0){
													$total_payment_change_product = $total_payment_change_product + $row['total_payment'];
													$total_credit_memo_change_product = $total_credit_memo_change_product + $row['credit_memo'];
												}
											?> 
									<?php } ?>
									</table>
									<table width="100%" style="margin-top: 5px;">
										<?php if(!empty($this->change_product)){?>
											<tr>
												<td colspan="3">
													<table width="29.2%" border="1" align="right" style="white-space:nowrap;font-family: Khmer OS Battambang,Times new roman;font-size:12px;">
												  		<tr style="background-color: #ccc;" align="center">
											 				<td style=" width: 38%; font-weight:bold;">&nbsp;<?php echo $tr->translate("TOTAL_PAYMENT"); ?>&nbsp;</td>
											 				<td style=" width: 38%; font-weight:bold;">&nbsp;<?php echo $tr->translate("CREDIT_MEMO"); ?>&nbsp;</td>
												  		</tr>
												  		<tr style="font-size:12px; height: 23px;font-family: Khmer OS Battambang,Times new roman;"​ align="center">
															<td style=" color:#F00; ">$ <?php echo number_format($total_payment_change_product,2);?></td>
															<td style=" color:#F00; ">$ <?php echo number_format($total_credit_memo_change_product,2);?></td>
												  		</tr>
													</table>
												</td>
											</tr>
										<?php }?>
									</table>
								</td>
							</tr>
							<?php }?>
							<tr>
								<td colspan="2">&nbsp;</td>
							</tr>
							<?php if(!empty($this->customer_payment)){?>
							<tr>
								<td colspan="2"><strong><?php echo $tr->translate("CUSTOMER_PAYMENT");?></strong></td>
							</tr>
							<tr>
								<td colspan="2">
									<table class="padd" width="100%" border="1" align="center" style="margin-top:5px;font-family: Khmer OS Battambang,Times new roman;">
										<thead>
										<tr  style="font-size:12px; height: 20px;border: 1px solid #000;background-color: #ccd9ff;line-height: 30px;font-weight: bold;" align="center" >
											<td><?php echo $tr->translate("N_O");?></td>
											<td><?php echo $tr->translate("RECEIPT_NO");?></td>
											<td><?php echo $tr->translate("NAME_KH");?></td>
											<td><?php echo $tr->translate("NAME_EN");?></td>
											<td><?php echo $tr->translate("SEX");?></td>
											<td><?php echo $tr->translate("DOB");?></td>
											<td><?php echo $tr->translate("PHONE");?></td>
											<td><?php echo $tr->translate("TOTAL_PAYMENT");?></td>
											<td><?php echo $tr->translate("FINE");?></td>
											<td><?php echo $tr->translate("DEDUCT");?></td>
											<td><?php echo $tr->translate("NET_AMOUNT");?></td>
											<td><?php echo $tr->translate("CREATE_DATE");?></td>
											<td><?php echo $tr->translate("USER");?></td>
											<td><?php echo $tr->translate("STATUS");?></td>
											<td><?php echo $tr->translate("VOID_BY");?></td>
										</tr>
									   </thead>
										 <style> td{padding:0 3px; }</style>
									<?php $i=0;foreach ($this->customer_payment as $rs){$i++;?>
										<tr  class="hover" style="font-size:12px; height: 20px;border: 1px solid #000;" align="center" >
											<td><?php echo $i;?></td>
											<td><a style="color: #000;" href="<?php echo $this->baseUrl()."/registrar/allreports/reprint-customer-payment/id/".$rs['id']?>" target="_blank" ><?php echo $rs['receipt_no'];?></a></td>
											<td><a style="color: #000;" href="<?php echo $this->baseUrl()."/registrar/allreports/reprint-customer-payment/id/".$rs['id']?>" target="_blank" ><?php echo $rs['name_kh'];?></a></td>
											<td><a style="color: #000;" href="<?php echo $this->baseUrl()."/registrar/allreports/reprint-customer-payment/id/".$rs['id']?>" target="_blank" ><?php echo $rs['name_en'];?></a></td>
											<td><?php echo $rs['sex'];?></td>
											<td><?php echo date("d-M-Y",strtotime($rs['dob']));?></td>
											<td><?php echo $rs['phone'];?></td>
											<td><?php echo "$ ".number_format($rs['grand_total'],2);?></td>
											<td><?php if($rs['fine']>0){echo "$ ".number_format($rs['fine'],2);}?></td>
											<td><?php if($rs['deduct']>0){echo "$ ".number_format($rs['deduct'],2);}?></td>
											<td><?php echo "$ ".number_format($rs['net_amount'],2);?></td>
											<td><?php echo date("d-M-Y",strtotime($rs['create_date']));?></td>
											<td><?php echo $rs['user'];?></td>
											<td><?php echo $rs['status'];?></td>
											<td><?php echo $rs['void_by'];?></td>
										</tr>
										
										<?php 
											if($rs['is_void']==0){
												$total_customer_payment = $total_customer_payment + $rs['net_amount'];
											}
										?> 
										
									<?php }?>
									</table>
									<table width="100%" style="margin-top: 5px;">
										<?php if(!empty($this->customer_payment)){?>
											<tr>
												<td colspan="3">
													<table width="15%" border="1" align="right" style="white-space:nowrap;font-family: Khmer OS Battambang,Times new roman;font-size:12px;">
												  		<tr style="background-color: #ccd9ff;" align="center">
											 				<td style=" width: 38%; font-weight:bold;">&nbsp;<?php echo $tr->translate("GRAND_TOTAL"); ?>&nbsp;</td>
												  		</tr>
												  		<tr style="font-size:12px; height: 23px;font-family: Khmer OS Battambang,Times new roman;"​ align="center">
															<td style=" color:#F00; ">$ <?php echo number_format($total_customer_payment,2);?></td>
												  		</tr>
													</table>
												</td>
											</tr>
										<?php }?>
									</table>
								</td>
							</tr>
							<?php }?>
							
							
							<?php if(!empty($this->row) || !empty($this->stu_test) || !empty($this->income) || !empty($this->expense) || !empty($this->change_product) || !empty($this->customer_payment) || !empty($this->clear_balance)){?>
							<tr>
								<td colspan="2"><strong><?php echo $tr->translate("TOTAL_INCOME");?></strong></td>
							</tr>
							<tr>
								
								<td colspan="2">
								<?php 
									$final_total_dollar= $net_amount + $total_stu_test + $total_income_dollar + $total_payment_change_product + $total_customer_payment + $total_stu_clear_balance - $total_expense_dollar;
									$final_total_income = $net_amount + $total_stu_test + $total_income_dollar + $total_payment_change_product + $total_customer_payment + $total_stu_clear_balance;
									$final_total_expense = $total_expense_dollar;
								?>
								<table width="100%" border="1"  style="margin-top:5px;white-space:nowrap;">
									<tr style="background-color: #ccd9ff;font-size:12px; color:#000; height: 23px;font-family: Khmer OS Battambang,Times new roman; "​ align="center">
										<td style=" font-weight:bold;">&nbsp;<?php echo $tr->translate("CURRENCY_TYPE"); ?>&nbsp;</td>
						 				<td style="font-weight:bold; ">&nbsp;<?php echo $tr->translate("STUDENT_PAYMENT_INCOME");?>&nbsp;</td>
										<td style="font-weight:bold; ">&nbsp;<?php echo $tr->translate("STUDENT_CLEAR_BALANCE");?>&nbsp;</td>
						 				<td style="font-weight:bold; ">&nbsp;<?php echo $tr->translate("STUDENT_TEST");?>&nbsp;</td>
						 				<td style="font-weight:bold;">&nbsp;<?php echo $tr->translate("OTHER_INCOME"); ?>&nbsp;</td>
						 				<td style="font-weight:bold;">&nbsp;<?php echo $tr->translate("CHANGE_PRODUCT"); ?>&nbsp;</td>
						 				<td style="font-weight:bold;">&nbsp;<?php echo $tr->translate("CUSTOMER_PAYMENT"); ?>&nbsp;</td>
						 				<td style="font-weight:bold;">&nbsp;<?php echo $tr->translate("OTHER_EXPENSE"); ?>&nbsp;</td>
							  		</tr>
							  		<tr style="font-size:12px; color:#000; height: 23px;font-family: Khmer OS Battambang,Times new roman;"​ align="center">
						  				<td style="font-weight:bold;"> Dollar ($)</td>
										<td style=" color:#F00; font-weight:bold;"> <?php echo number_format($net_amount,2);?> $ </td>
										<td style=" color:#F00; font-weight:bold;"> <?php echo number_format($total_stu_clear_balance,2);?> $ </td>
										<td style=" color:#F00; font-weight:bold;"> <?php echo number_format($total_stu_test,2);?> $ </td>
										<td style=" color:#F00; font-weight:bold;"> <?php echo number_format($total_income_dollar,2);?> $​ </td>
										<td style=" color:#F00; font-weight:bold;"> <?php echo number_format($total_payment_change_product,2);?> $ </td>
										<td style=" color:#F00; font-weight:bold;"> <?php echo number_format($total_customer_payment,2);?> $ </td>
										<td style=" color:#F00; font-weight:bold;"> <?php echo number_format($total_expense_dollar,2);?> $ </td>
							  		</tr>
							  		<tr style="font-size:12px; color:#000; height: 23px;font-family: Khmer OS Battambang,Times new roman;"​ align="center">
						  				<td style="font-weight:bold;"> Net Amount ($)</td>
										<td colspan="6" style=" color:#006d1f; font-weight:bold;font-size: 15px;"> <?php echo number_format($final_total_income,2);?> $ </td>
										<td style=" color:#F00; font-weight:bold;font-size: 15px;"> <?php echo number_format($final_total_expense,2);?> $ </td>
							  		</tr>
							    </table>
										<?php }?>
								</td>
							</tr>
						</table>
						<table style="width:100%;font-family: Khmer OS Battambang,Times New Roman; white-space: nowrap; !important;">
							<tr>
								<td colspan="3" >
										<style type="text/css">
											body{font-family: "Times New Roman",Arial,'Kh Battambang','Khmer Battambang'; }
											table{ border-collapse:collapse; margin:0 auto;
											border-color:#000; }
											.padd tr td{  text-align:center}
											.padd tr th{  background-color: #e4e4e4; }
											table { page-break-inside:auto }
											tr{ page-break-inside:avoid; page-break-after:auto }
											th,td{ padding:0 1px;}
										table { page-break-inside:auto }
										tr{ page-break-inside:avoid; page-break-after:auto; }
										#header {
										  display: table-header-group;
										  page-break-inside:avoid; page-break-after:auto;
										}
										</style>
								</td>
							</tr>
							<tr>
								<td colspan="3">&nbsp;</td>
							</tr>
							<tr >
								<td colspan="3" width="100%">
									<table width="100%" style="font-family: 'Khmer OS Battambang';">
										<tr>
											<td  width="25%" align="center">
												<span style="font-size: 14px;font-family:'Khmer MEF2'"><?php echo $tr->translate('APPROVED_BY')?></span>
											</td>
											<td  width="50%" align="center">
												&nbsp;<span style="text-align: right;font-size: 14px;font-family:'Khmer MEF2'"><?php echo $tr->translate('VERIFIED_BY')?></span>
											</td>
											<td align="center"  width="25%">
												<span style="text-align: right;font-size: 14px;font-family:'Khmer MEF2'"><?php echo $tr->translate('PREPARED_BY')?></span>
											</td>
										</tr>
										<tr>
											<td>
											</td>
											<td  width="50%">
												&nbsp;
											</td>
											<td align="center"  width="25%">
												
											</td>
										</tr>
										
									</table>
								</td>
							</tr>
							<tr>
								<td colspan="3">&nbsp;</td>
							</tr>
						
					</table>
				</td>
			</tr>
		</table>
	</div>	
</div>
<div class="ptss-frame  js-ptss-frame "><!-- is-opened -->
	<div class="ptss__toggle-btn  js-ptss-toggle-btn ">
		<i class="fa fa-print"></i>
	</div>
	<div class="ptss__header"><?php echo $tr->translate("PRINT");?></div>
	<div class="ptss__settings">
		<div class="ptss__single-setting" id="ptss__layout">
			<div class="ptss__setting-control">
				<div class="ptss__layout-wrapper">
					<a class="qButton" title="<?php echo $tr->translate("Preview");?>" href="#" onclick="preview();"><i class="fa fa-search" aria-hidden="true"></i></a>
					<a class="qButton print" href="#" title="<?php echo $tr->translate("PRINT");?>" onclick="doPrint();" ><i class="fa fa-print" aria-hidden="true"></i></a>
					<a class="qButton excel" href="#"  title="<?php echo $tr->translate("Export");?>"  onclick="exportExcel();"><i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
				</div>
				
			</div>
		</div>
	</div>
</div>

