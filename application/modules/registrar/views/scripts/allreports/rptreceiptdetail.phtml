<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle('SRMS | Report Student Payment'); 
	echo $this->headTitle();
	$base_url = Application_Form_FrmMessage::getUrl("/");
?>
<style>
#footer{display: none;}
table tr td strong{
	padding-left: 0px;
}
</style>
<table width="100%" style="margin: 0px; font-family:'khmer os battambang';">
   <tr>
       <td colspan="5">
			<div class="menureport">
				<ul>
					<li class="preview"><a title="Preview" href="#" onclick="preview();"></a></li>
					<li class="print"><a href="#" title="Print" onclick="doPrint();" ></a></li>
					<li class="excel"><a href="#"  title="Export"  onclick="exportExcel();"></a></li>
				</ul>
			</div>
      </td>
	</tr>
</table>	
<div style="border: 1px dotted #000;background: #fff; margin: 0 auto;min-height: 27cm;padding:1cm;width:27cm;">
		<div id="divPrint">
			<?php 
			$amount_print = $this->data['receipt_print'];
			for($prin=0;$prin<$amount_print;$prin++){?>
			<table style="margin: 0 auto; width:100%;height:13.97cm;" >
				<tr height="100px;">
				    <td colspan="3"  style="" align="center" valign="top">
				    </td>
				</tr>
				<tr height="40px;">
				    <td colspan="3"  style="" align="center" valign="top">
						<table width="100%" style="font-size: 10px;margin-bottom: 0px;" >
							<tr>
								<td width="25%"></td>
								<td width="50%" valign="top" align="center" style="font-family:Khmer OS Muol, Times New Roman;font-size: 16px;line-height: 20px">
									<div>បង្កាន់ដៃបង់ប្រាក់</div>
									<div>Official Receipt</div>
								</td>
								<td width="25%" valign="bottom">
									<div style="font-size: 15px;font-family:Battambang,Arial,Helvetica,sans-serif;"><u>Receipt N<sup>o</sup></u><?php echo $this->rr['receipt_number'];?><?php if($this->rr['is_void']==1){echo "<span style='color:red;'>&nbsp;&nbsp;(Void)</span>";};?></div> 
									<span style="font-size: 14px;font-weight: bold;font-family: arail"><?php echo $tr->translate('Pmt Date');?> : <?php echo date('d-M-Y',strtotime($this->rr['create_date']));?></span>
								</td>
							</tr>
						</table>
				    </td>
				</tr>
				<tr height="50px">
					<td colspan="3">
						<table width="100%" border="0" style="font-family: Khmer OS Battambang; font-size: 12px;white-space: nowrap;margin-bottom: 5px;">
							<tr style="line-height: 16px;">
							<td>Student's ID</td>
							<td> : &nbsp;&nbsp;<strong><?php echo $this->rr['stu_code'];?></strong></td>
							<td>Dob</td>
							<td> : &nbsp;&nbsp;<?php echo empty($this->rr['dob'])?"":date('d-m-Y',strtotime($this->rr['dob']));?></td>
							<td >Grade</td>
							<td> : &nbsp;&nbsp;<strong><?php echo $this->rr['grade'];?></strong></td>
						
						</tr>
						<tr style="line-height: 16px;">
							<td>Student's Name</td>
							<td colspan="1"> :&nbsp;&nbsp;<strong><?php echo $this->rr['stu_khname'].' / ';echo $this->rr['stu_enname']?></strong></td>
							<td>Phone</td>
							<td> : &nbsp;&nbsp;<?php echo $this->rr['tel'];?></td>
							<td>Academic Year</td>
							<td>  : &nbsp;<?php echo $this->rr['academic_year'];?></td>
						</tr>
						<tr style="line-height: 16px;">
							<td >Gender</td>
							<td> : &nbsp;&nbsp;<strong><?php echo $this->rr['sex'];?></strong></td>
							<td >Degree</td>
							<td> : &nbsp;&nbsp;<strong><?php echo $this->rr['degree'];?></strong></td>
							<td >Session</td>
							<td> : &nbsp;&nbsp;<strong><?php echo $this->rr['session'];?></strong></td>
						</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="3" valign="top">
						<style> th,td{ padding:0 1px;}</style>
							<style type="text/css">
								body{font-family: "Times New Roman",Arial; }
								table{ border-collapse:collapse; margin:0 auto;
								border-color:#000; }
								.padd tr td{  text-align:center}
								.padd tr th{  background-color: #ccc; }
							</style>
						<table border="1" class="padd" width="99%" border="1" align="center" style="line-height:15px;white-space:nowrap; padding: 0px; margin: 0px;font-family: Khmer OS Battambang;">
							  <tr style="font-size:12px; height: 20px;" align="center" >
							    <th>&nbsp;<?php echo $tr->translate('N_O');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Item Name');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Term');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Period');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Unit Price');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Qty');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Deduct');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Extra Fee');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Discount');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Amount');?>&nbsp;</th>
								<th>&nbsp;<?php echo $tr->translate('Note');?>&nbsp;</th>
							  </tr>
								<style> td{padding:0 3px; }</style>
							  <?php $i=0; $total=0; if(!empty($this->row)) foreach($this->row as $rs){ $i++;?>
							  <tr class="hover" style="font-size:12px;height: 18px;"​ >
							    <td><?php echo $i;?></td>
							    <?php if($rs["type"]==1){$rs['service']="Tuition Fee (".$rs['grade'].')';}?>
							    <td style="text-align: left;"><?php echo $rs['service'];?></td>
							    <td><?php echo $rs['payment_term']; ?></td>
							    <td><?php if($rs['is_onepayment']!=1){echo empty($rs['start_date'])?"":date('d/m/Y', strtotime($rs['start_date'])); ?>-<?php echo empty($rs['validate'])?"":date('d/m/Y', strtotime($rs['validate'])); }?></td>
							    <td>$ <?php echo $rs['fee']; if(empty($rs['fee'])) echo '0.00';?></td>
							    <td><?php echo $rs['qty']; if(empty($rs['qty'])) echo '00';?></td>
							    <td><?php if($rs['late_fee']>0){echo '$ '.$rs['late_fee'];}?></td>
						   		<td><?php if($rs['extra_fee']>0){echo '$ '.$rs['extra_fee'];}?></td>
							    <td><?php echo $rs['discount_percent']; if(empty($rs['discount_percent'])) echo '';?></td>
							    <td>$ <?php echo $rs['paidamount'];?></td>
							    <td><?php echo $rs['note'];?></td>
							  </tr> <?php $total = $total + $rs['subtotal']; ?>
							  <?php } 
							  ?>
							  <tr style="font-size:12px;height:15px;border: 1px solid #fff;border-top: 1px solid #000;"​>
								  	<td style="" colspan="9"></td>
								  	<td style="text-align: left;"><?php echo $tr->translate('Total Payment');?></td>
								  	<td>$ <?php echo $this->rr['grand_total'];?></td>
							  </tr>
							 <tr style="font-size:12px;height: 15px; border: 1px solid #fff;"​>
								  	<td style=" " colspan="9"><label id="lbl_moneykhmer"></label></td>
								  	<td style="text-align: left;"><?php echo $tr->translate('Fine');?></td>
								  	<td>$ <?php echo $this->rr['fine'];?></td>
							  </tr> 
							  <tr style="font-size:12px;height: 15px;border: 1px solid #fff;"​>
								  	<td style="" colspan="9"></td>
								  	<td style="text-align: left;"><?php echo $tr->translate('Credit Memo');?></td>
								  	<td>$ <?php echo $this->rr['credit_memo'];?></td>
							  </tr>
							  <tr style="font-size:12px;height:15px;border: 1px solid #fff;"​>
								  	<td style="" colspan="9"></td>
								  	<td style="text-align: left;"><?php echo $tr->translate('Deduct');?></td>
								  	<td>$ <?php echo $this->rr['deduct'];?></td>
							  </tr>
							  <tr style="font-size:12px;height: 15px;border: 1px solid #fff;"​>
								  	<td style=" border: 1px solid #fff;" colspan="9">
								  		<table width="100%" border="0" style="white-space:nowrap;border-collapse:collapse;font-size:12px;line-height:16px;">	
											<tr>
												<td width="33%" align="center">Cashier</td>
												<td width="34%" align="center">Customer</td>
												<td width="33%" align="center">Verified By</td>
											</tr>	
											<tr>
												<td width="33%" align="center"><br /><br /></td>
												<td width="34%" align="center"></td>
												<td width="33%" align="center"></td>
											</tr>
											<tr style="height:15px;">
														<td align="center">
															<div style="font-weight:bold;color:#000; font-size: 11px;font-family:'Khmer OS Battambang';margin-top: 5px;"> 
																<?php 
// 																   $session_user=new Zend_Session_Namespace('authstu');
// 																   $last_name=$session_user->last_name;
// 																   $username = $session_user->first_name;
																   echo "".$this->rr['last_name']." ".$this->rr['user'];
																?>
																<div style="margin-top:-2px;font-size:10px;"><?php echo date('l , jS / m / Y , H:i:s ',strtotime($this->rr['create_date']));?></div>
															</div>
														</td>
														<td align="center"></td>
														<td align="center"></td>
													</tr>	
										</table>	
								  	</td>
								  	<td style="text-align: left !important;" valign="top"><strong style="text-align: left !important;"><?php echo $tr->translate('Net Amount');?></strong></td>
								  	<td valign="top"><strong >$ <?php echo $this->rr['net_amount'];?></strong></td>
							  </tr>
							</table>
						</td>
					</tr>
				</table>
				<?php //if($print==0){?>
					<!-- <hr style="border:1px dotted #000;" /> -->
				<?php //}
}?>
	</div>	
</div>
<script type="text/javascript">
dojo.ready(function(){
	//readMoneyInKhmer(111);
});	
function readMoneyInKhmer(netTotal){
	var str = netTotal.toString();
    str_cent = 'សេន';
	first_decimal = str.substr(-2);
	last_decimal = str.substr(-1);
    if(first_decimal>0){string='និង';}else{string="";str_cent=""}
	if(first_decimal!='00' && first_decimal<10 ){str_zero = "សូន្យ";}else{str_zero='';}
    first_money_decimal = read_in_khmer_from_10_to_99(first_decimal);
    last_money_decimal = read_in_khmer_from_0_to_9(last_decimal)
    money_khmer=read_money_in_khmer(netTotal);

    if(first_decimal>0){string_en='និង';}else{string_en="";str_cent_en=""}
	if(first_decimal!='00' && first_decimal<10 ){str_zero_en = "Zero";}else{str_zero_en='';}
    first_money_decimal_en = read_in_english_from_10_to_99(first_decimal);
    last_money_decimal_en = read_in_english_from_0_to_9(last_decimal)
    money_english=read_money_in_english(netTotal);
    read_eng = money_english.trim()+string+ first_money_decimal+str_zero+last_money_decimal+'ដុល្លាគត់'

    read_eng = '( '+money_english.trim()+string_en+ first_money_decimal_en+str_zero_en+last_money_decimal_en+' Dollar Only )'
    dojo.byId("lbl_moneykhmer").innerHTML = money_khmer.trim()+string+ first_money_decimal+str_zero+last_money_decimal+'ដុល្លាគត់'+read_eng
}
</script>