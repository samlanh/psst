<?php 
$frm = $this->form_search;
$tr = Application_Form_FrmLanguages::getCurrentlanguage();
$base_url = Application_Form_FrmMessage::getUrl("/");
?>
<title>របាយការណ៏សរុបតាមប្រភេទ</title>
<script>
	dojo.require('dijit.form.Button');
	dojo.require("dijit.form.DateTextBox");
</script>
<form id="list" name="list" action="<?php echo $this->url(array('module'=>'registrar','controller'=>'rptbytype','action'=>'index')); ?>" dojoType="dijit.form.Form" method="post">
	<table width="100%">
	   <tr>
	       <td colspan="4">
				<div class="menureport">
					<ul>
						<li class="preview"><a title="Preview" href="#" onclick="preview();"></a></li>
						<li class="print"><a href="#" title="Print" onclick="doPrint();" ></a></li>
						<li class="excel"><a href="#"  title="Export"  onclick="exportExcel();"></a></li>
					</ul>
				</div>
	      </td>
		</tr>
	 </table> 
	 <table width="50%" align="left"> 
	   <tr>
	   		<td> <input dojoType="dijit.form.DateTextBox" constraints="{datePattern:'dd/MM/yyyy'}"  class="fullside" id="start_date" name="start_date" value="<?php echo $this->search['start_date']; ?>"  type="text"></td>
			<td><input dojoType="dijit.form.DateTextBox"  constraints="{datePattern:'dd/MM/yyyy'}"  class="fullside" id="end_date" name="end_date" value="<?php echo $this->search['end_date'];?>" type="text"></td>
	   		<td><button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button></td>
	   </tr>
	</table>
</form>

	<div style="border: 1px dotted #000;background: #fff; margin: 0 auto;min-height: 27cm;">
		<div id="divPrint">
			<table style="background:#fff; margin: 0 auto; width: 100%; padding: 1cm; ">
				<tr>
					<td width="15%" align="center">
						<img style="width: 70%;" alt="<?php ?>" src="<?php echo $this->baseUrl().'/images/logo.png'?>">
					</td>
					<td align="center" width=70%">
						<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 16px;font-family:'Khmer MEF2';"><?php echo $tr->translate('របាយការណ៏សរុបតាមប្រភេទ');?></strong><br />
						<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 12px;font-family:'Khmer MEF2';">For Date <?php echo date("d-M-Y",strtotime($this->search["start_date"]))?> to <?php echo date("d-M-Y",strtotime($this->search["end_date"]));?></strong>
					</td>
					<td width="15%" align="center">
					</td>
				</tr>
				<tr>
					<td colspan="3">
						<style> th,td{ padding:0 1px;}</style>
							<style type="text/css">
								body{font-family: "Times New Roman",Arial; }
								table{ border-collapse:collapse; margin:0 auto;
								border-color:#000; }
								.padd tr td{  text-align:center}
								.padd tr th{  background-color: #ccc; }
							</style>

						<table class="padd" width="50%" border="1" align="center" style="white-space:nowrap;font-family: Khmer OS Battambang;">
							 
							<tr>
								<td>No</td>
								<td><?php echo $tr->translate("TYPE");?></td>
								<td><?php echo $tr->translate("TOTAL");?></td>
							</tr> 
							 
							 
							<style> td{padding:0 3px; }</style>
							<?php 
								$i=0; 
								$type=0;
								$grand_total=0;
								$type_name='';
								$sum_up = 0;
								$net_total=0;
							  ?>
							  
							  <?php if(!empty($this->row)){ foreach($this->row as $key => $rs){ $i++;?>
							  
								  <?php if($rs['type']!=$type){	?>
									   <?php  if($key>0 ){?>
												  <tr style="font-size:12px; color:#000; height: 30px;"​ align="center">
												  		<td><?php echo $no;?></td>
											 			<td width="50%" style="  background-color: #efefef; font-weight:bold;">&nbsp;<?php echo $tr->translate($type_name);?>&nbsp;</td>
														<td width="50%" style=" color:#F00; font-weight:bold;">$ <?php echo number_format($grand_total,2);?></td>
												  </tr>
										<?php }$sum_up = $sum_up + $grand_total;$grand_total=0;?>
										
									<?php 
									 	}
									 	$type=$rs['type'];
									 	$grand_total = $grand_total + $rs['paidamount'];
									 	if($type==1 || $type==2){
									 		$type_name = "ថ្លៃសិក្សា";
									 		$no=1;
									 	}else if($type==3){
									 		$type_name = "ថ្លៃសេវាកម្ម";
									 		$no=2;
									 	}else if($type==4){
									 		$type_name = "ថ្លៃលក់ផលិតផល";
									 		$no=3;
									 	}
							 	 	?>
							  
							  	<?php }$sum_up = $sum_up + $grand_total; ?>
								  <tr style="font-size:12px; color:#000; height: 30px;"​ align="center">
								 		<td><?php echo $no."";?></td>
							 			<td width="50%" style=" background-color: #efefef; font-weight:bold;">&nbsp;<?php echo $tr->translate($type_name);?>&nbsp;</th>
										<td width="50%" style=" color:#F00; font-weight:bold; ">$ <?php echo number_format($grand_total,2);?></td>
								  </tr>
							 <?php }?>	  
							 
							 
							 
							 <?php 
									$i=0; 
									$payment_id=0;
									$fine=0;
							 ?>
							  
							  <?php if(!empty($this->rs)){ foreach($this->rs as $key => $rs){ $i++;?>
								  <?php 
								  		if($rs['payment_id']!=$payment_id){	
											$fine = $fine + $rs['fine'];
									 	}
									 	$payment_id=$rs['payment_id'];
							 	  ?>
							  	  <?php }?>
							  
								  <tr style="font-size:12px; color:#000; height: 30px;"​ align="center">
								  		<td><?php echo 4;?></td>
							 			<td width="50%" style=" background-color: #efefef;  font-weight:bold; ">&nbsp;<?php echo $tr->translate("FINE");?>&nbsp;</th>
										<td width="50%" style=" color:#F00; font-weight:bold; ">$ <?php echo number_format($fine,2);?></td>
								  </tr>
							  <?php }?>
							 
							 
							 
							 
								<?php 
									$i=0; 
									$payment_id=0;
									$credit_memo=0;
							    ?>
							  
							  <?php if(!empty($this->rs)){ foreach($this->rs as $key => $rs){ $i++;?>
								  	<?php 
								  		if($rs['payment_id']!=$payment_id){	
											$credit_memo = $credit_memo + $rs['credit_memo'];
									 	}
									 	$payment_id=$rs['payment_id'];
							 	  	?>
							  	  <?php } ?>
							  
							  
								  <tr style="font-size:12px; color:#000; height: 30px;"​ align="center">
								  		<td><?php echo 5;?></td>
							 			<td width="50%" style=" background-color: #efefef; font-weight:bold; ">&nbsp;<?php echo $tr->translate("CREDIT_MEMO");?>&nbsp;</th>
										<td width="50%" style=" color:#F00; font-weight:bold; ">$ <?php echo number_format($credit_memo,2);?></td>
								  </tr>
							  <?php } ?>
							  
							  <?php 
									$i=0; 
									$payment_id=0;
									$deduct=0;
							   ?>
							  
							  <?php if(!empty($this->rs)){ foreach($this->rs as $key => $rs){ $i++;?>
								  <?php 
								  		if($rs['payment_id']!=$payment_id){	
											$deduct = $deduct + $rs['deduct'];
									 	}
									 	$payment_id=$rs['payment_id'];
							 	  ?>
							  	  <?php }?>
							  
								  <tr style="font-size:12px; color:#000; height: 30px;"​ align="center">
								  		<td><?php echo 6;?></td>
							 			<td width="50%" style=" background-color: #efefef;  font-weight:bold; ">&nbsp;<?php echo $tr->translate("DEDUCT");?>&nbsp;</th>
										<td width="50%" style=" color:#F00; font-weight:bold; ">$ <?php echo number_format($deduct,2);?></td>
								  </tr>
							  <?php }?>
							  
							  
							  
							  
						</table>
					</td>	
				</tr>		
					
				<tr>
					<td colspan="3">		
						<table class="padd" width="50%" border="1" align="center" style="white-space:nowrap;font-family: Khmer OS Battambang;margin-top: 10px;">
							 
							<style> td{padding:0 3px; }</style>
							 
						</table>
					</td>
				</tr>
				
				<tr>
					<td colspan="3">		
						<table class="padd" width="50%" border="1" align="center" style="white-space:nowrap;font-family: Khmer OS Battambang;margin-top: 10px;">
							 <?php $net_total = $sum_up + $fine - $credit_memo - $deduct; ?>
							  <tr style="font-size:13px; color:#000; height: 30px;"​ align="center">
						 			<td width="50%" style=" background-color: #ccc;  font-weight:bold; ">&nbsp;<?php echo $tr->translate("Net Total");?>&nbsp;</th>
									<td width="50%" style=" color:#F00; font-weight:bold; ">$ <?php echo number_format($net_total,2);?></td>
							  </tr>
						</table>
					</td>
				</tr>
				
				<tr><td colspan="3">&nbsp;</td></tr>
				<tr>
					<td colspan="3">&nbsp;</td>
				</tr>
			</table>
		</div>	
	</div>