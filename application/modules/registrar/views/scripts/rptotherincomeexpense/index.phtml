<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle('Report Other Income and Expense'); 
	echo $this->headTitle(''); 
	$frm=$this->form_search;
	
	//echo 'test';exit();
	
?>	
<div style="width: 28cm;margin: 0 auto;">
<form  id='foundation_class' action="<?php echo $this->url(array('module'=>'registrar','controller'=>'rptotherincomeexpense','action'=>'index')); ?>" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
	<table style="width: 90%">	
		<tr>
			<td>	
				<input dojoType="dijit.form.TextBox" class="fullside" id="txtsearch" name="txtsearch" placeholder="Search....." value="<?php echo $this->search['txtsearch'];?>" type="text">
			</td>
			<td> <?php echo $frm->getElement("branch_id");?></td>
			<td> <?php echo $frm->getElement("user");?></td>
			<td>
				<select  type="text"  name="type" id="type"  dojoType="dijit.form.FilteringSelect" class="fullside"  >
					<option value="1" <?php if($this->search['type']==1){echo 'selected="selected"';}?> > Income and Expense </option>
					<option value="2" <?php if($this->search['type']==2){echo 'selected="selected"';}?> > Income </option>
					<option value="3" <?php if($this->search['type']==3){echo 'selected="selected"';}?> > Expense </option>
				</select>
			</td>
		</tr>
		<tr>
			<td><input dojoType="dijit.form.DateTextBox" class="fullside" constraints="{datePattern:'dd/MM/yyyy'}" id="start_date" name="start_date" placeholder="Search....." value="<?php echo $this->search['start_date'];?>" type="text"></td>
			<td><input dojoType="dijit.form.DateTextBox" class="fullside" constraints="{datePattern:'dd/MM/yyyy'}" id="end_date" name="end_date"  value="<?php echo $this->search['end_date'];?>" type="text"></td>
			<td>
				<button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" name="search"  type="submit"><?php echo $tr->translate("SEARCH");?></button>
			</td>
		</tr>
	</table>	
</form>		
</div>
<div style="border: 1px dotted #000;background: #fff;width: 27cm;margin: 0 auto;min-height: 27cm;padding: 0.5cm;">
			<div id="divPrint">
				<div id="exportExcel">
				
									<table  style="background:#fff; margin: 0 auto; ;white-space: nowrap;width: 100%">
										<tr >
											
											<td width="15%" align="center">
												<img style="width:60%;" src="<?php echo $this->baseUrl().'/images/logo.png'?>"><br />
											</td>
											<td align="center"  width="70%">
												<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 16px;font-family:'Khmer MEF2'; "><?php echo $tr->translate("CUSTOMER_BRANCH"); ?></strong><br />
												<strong style="font-weight:bold;font-family: Arial Black;color:#000; font-size: 16px;font-family:'Khmer MEF2'; "><?php echo $tr->translate("RPT_OTHER_INCOME_EXPENSE"); ?></strong><br />
												<span style="font-weight: bold;font-size: 11px; ">For Date <?php echo date("d-M-Y",strtotime($this->search["start_date"]))?> to <?php echo date("d-M-Y",strtotime($this->search["end_date"]));?></span><br />
											</td>
											<td width="15%" align="center">
												&nbsp;
											</td>
										</tr>
										
										<style>
											table tr th{background-color: #ccc;}										
										</style>
										
										<tr>
											<td colspan="3" id="exportExcel">
											<?php if(!empty($this->income)){?>
												<table cellpadding="5"​ style="margin:0 auto;border: 1px solid #000;width:100%; border-collapse: collapse;"  border="1" >
													
													<tr>
														<td align="center" colspan="8"><strong> Income </strong> </td>
													</tr>
													
													<tr style="font-size:11px; height: 20px;border: 1px solid #000;background-color: #ccc;line-height: 30px;font-weight: bold;" align="center" >
														<td style="border: 1px solid #000;"><?php echo $tr->translate('N_O')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('INCOME_TITLE')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('INVOICE_NO')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('CURRENCY_TYPE')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('TOTAL')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('DATE')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('USER')?></td>
													</tr>
												<?php $i=0;$total_riel=0;$total_dollar=0; foreach ($this->income AS $row) { $i++;?>
													<tr class="hover" style="font-size:11px; height: 20px;border: 1px solid #000;" align="center" >
														<td style="border: 1px solid #000;"><?php echo $i;?></td>
														<td style="border: 1px solid #000;"><?php echo $row['title'];?></td>
														<td style="border: 1px solid #000;"><?php echo $row['invoice'];?></td>
														<td align="canter" style="border: 1px solid #000;"><?php echo $row['curr_name'];?></td>	
														<td style="border: 1px solid #000;"><?php echo $row['total_amount'];?></td>
														<td style="border: 1px solid #000;"><?php echo $row['date'];?></td>
														<td style="border: 1px solid #000;"><?php echo $row['name'];?></td>
													</tr>
													
													<?php if($row['curr_type']==2){
															$total_riel=$total_riel+$row['total_amount'];
														  }else{
														  	$total_dollar=$total_dollar+$row['total_amount'];
														  }
													?>
													
												<?php }?>	
												</table>	
												<table align="right" border="1" cell-padding="10" cell-spacing="10" style=" font-size: 13px;border: 1px solid #000;border-collapse: collapse;">
													<tr style="background: #cccccc;">
														<td style="padding: 0px 5px;"><?php echo $tr->translate('AMOUNT_IN_KH');?></td>
														<td style="padding: 0px 5px;"><?php echo $tr->translate('AMOUNT_IN_DOLLAR');?></td>
													</tr>
													<tr>
														<td align="center"><?php echo $total_riel;?> រៀល</td>
														<td align="center"><?php echo $total_dollar;?> $</td>
													</tr>
												</table>
												<br />
											<?php }?>
											
											<?php if(!empty($this->expense) && !empty($this->income)){ ?>
														<br /><br />
											<?php }?>
											<?php if(!empty($this->expense)){ ?>
												<table cellpadding="5"​ style="margin:0 auto;border: 1px solid #000;width:100%; border-collapse: collapse;"  border="1" >
													
													<tr style="border-left:none;">
														<td align="center" colspan="8" ><strong> Expense </strong> </td>
													</tr>
													
													<tr style="font-size:11px; height: 20px;border: 1px solid #000;background-color: #ccc;line-height: 30px;font-weight: bold;" align="center" >
														<td style="border: 1px solid #000;"><?php echo $tr->translate('N_O')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('EXPENSE_TITLE')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('INVOICE_NO')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('CURRENCY_TYPE')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('TOTAL')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('DATE')?></td>
														<td style="border: 1px solid #000;"><?php echo $tr->translate('USER')?></td>
													</tr>
												<?php $i=0;$total_riel=0;$total_dollar=0; foreach ($this->expense AS $rs) { $i++;?>
													<tr class="hover" style="font-size:11px; height: 20px;border: 1px solid #000;" align="center" >
														<td style="border: 1px solid #000;"><?php echo $i;?></td>
														<td style="border: 1px solid #000;"><?php echo $rs['title'];?></td>
														<td style="border: 1px solid #000;"><?php echo $rs['invoice'];?></td>
														<td align="canter" style="border: 1px solid #000;"><?php echo $rs['curr_name'];?></td>	
														<td style="border: 1px solid #000;"><?php echo $rs['total_amount'];?></td>
														<td style="border: 1px solid #000;"><?php echo $rs['date'];?></td>
														<td style="border: 1px solid #000;"><?php echo $rs['name'];?></td>
													</tr>
													<?php if($rs['curr_type']==2){
															$total_riel=$total_riel+$rs['total_amount'];
														  }else{
														  	$total_dollar=$total_dollar+$rs['total_amount'];
														  }
													?>
												<?php }?>	
												</table>
												<table align="right" border="1" cell-padding="10" cell-spacing="10" style=" font-size: 13px;border: 1px solid #000;border-collapse: collapse;">
													<tr style="background: #cccccc;">
														<td style="padding: 0px 5px;"><?php echo $tr->translate('AMOUNT_IN_KH');?></td>
														<td style="padding: 0px 5px;"><?php echo $tr->translate('AMOUNT_IN_DOLLAR');?></td>
													</tr>
													<tr>
														<td align="center"><?php echo $total_riel;?> រៀល</td>
														<td align="center"><?php echo $total_dollar;?> $</td>
													</tr>
												</table>	
											<?php }?>
											</td>
										</tr>
										<tr>
											<td colspan="3">&nbsp;</td>
										</tr>
										<tr >
											<td colspan="3" width="100%">
												<table width="100%">
													<tr>
														<td  width="25%" align="center">
															<span style=" font-size: 14px;"><?php echo $tr->translate('VERIFIED_BY')?></span>
														</td>
														<td  width="50%">
															&nbsp;
														</td>
														<td align="center"  width="25%">
															<span style="font-size: 14px;text-align: right;"><?php echo $tr->translate('PREPARED_BY')?></span>
														</td>
													</tr>
												</table>
											</td>
										</tr>
									</table>
					</div>
			</div>		
</div>










