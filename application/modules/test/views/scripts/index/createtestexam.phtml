<?php
$tr = Application_Form_FrmLanguages::getCurrentlanguage();

if (!empty($this->detailscore)){$title = $tr->translate('UPDATE_TEST_RESULT');}else{$title = $tr->translate('CREATE_TEST_EXAM');}
echo $this->headTitle($title);
$frm = $this->form;
?>
<script src="<?php echo $this->baseUrl();?>/js/help.js"  type="text/javascript"></script>
<div class="card">
	<div class="card-content collapse show">
		<form id='frm_teststudent' action="" dojoType="dijit.form.Form" method="post" enctype="multipart/form-data">
			<script type="dojo/method" event="onSubmit" enctype="multipart/form-data">			
			if(this.validate()) {
				if(dijit.byId("branch_id").get("value")==''){
                    alert("<?php echo $tr->translate("PLEASE_SELECT_BRANCH");?>");
					dijit.byId("branch_id").focus();
					return false;
				}
				if(dijit.byId("degree").get("value")==''){
                    alert("<?php echo $tr->translate("PLEASE_SELECT_DEGREE");?>");
					dijit.byId("degree").focus();
					return false;
				}
				if(dijit.byId("grade").get("value")==''){
                    alert("<?php echo $tr->translate("PLEASE_SELECT_GRADE");?>");
					dijit.byId("grade").focus();
					return false;
				}
				loadingBlock();
				return true;
			}else {
				return false;
			}
			</script>
			<div class="card-box">
               	<div class="col-sm-12 border-botom">
		    		<div class="col-sm-8 pd-0">
		    			<h4 class="m-b-0"><i class="fa fa-file-code-o" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;
		    			<?php echo $title;?>
		    			
		    			</h4>
	    			</div>
	    			<div class="col-sm-4 text-right">
	    			</div>
	    		</div>
	    	</div>
	    	<div class="card-box">
	        	<div class="col-md-4 col-sm-4 col-xs-12">
					<div class="form-group">
	                   <label class="control-label col-md-12 col-sm-12 col-xs-12 title-blog bold" for="first-name"><i class="fa fa-hand-o-right" aria-hidden="true"></i> <?php echo $tr->translate("STUDENT_INFO");?> 
	                   </label>
	                </div>
	               
	                <div class="form-group">
	                   <label class="control-label bold col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("BRANCH_NAME");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<?php echo $frm->getElement("branch_id");?>
	                   		<?php echo $frm->getElement("id");?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label bold col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("STUDENT");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<?php echo $frm->getElement("stu_test_id");?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("DEGREE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<?php echo $frm->getElement("degree");?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("GRADE")?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<input id="grade" />
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("TEST_DATE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<?php echo $frm->getElement("test_date");?>
	                   </div>
	                </div>
	                
	             </div>
	             <div class="col-md-4 col-sm-4 col-xs-12">
					<div class="form-group">
	                   <label class="control-label col-md-12 col-sm-12 col-xs-12 title-blog bold" for="first-name"><i class="fa fa-hand-o-right" aria-hidden="true"></i> <?php echo $tr->translate("RESULT_TEST");?> 
	                   </label>
	                </div>
	                <div class="form-group">
	                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("RESULT_DATE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<?php echo $frm->getElement("result_date");?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("SCORE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<?php echo $frm->getElement("score");?>
	                   </div>
	                </div>
	                 <div class="form-group">
	                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("DEGREE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<?php echo $frm->getElement("degree_result");?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("GRADE")?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<input id="grade_result" />
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label  col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("NOTE")?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                   		<?php echo $frm->getElement("note");?>
	                   </div>
	                </div>
	             </div>
	         </div>
	         <div class="card-box">
               	<div class="col-sm-12 border-top mt-20 ptb-10 text-center">
               		<input type="reset" label="<?php echo $tr->translate("CLEAR")?>" dojoType="dijit.form.Button"
					 iconClass="dijitIconClear"/>
					<input label="<?php echo $tr->translate("SAVE_CLOSE")?>" name='saveclose' id='saveclose' value='saveclose' dojoType="dijit.form.Button" type="submit"  iconClass="dijitEditorIcon dijitEditorIconSave"/>
	    		</div>
	    	</div>
	    </form>
	 </div>
</div>
<script type="text/javascript">
    dojo.require("dojo.NodeList-manipulate");
    dojo.require("dojo.parser");
    dojo.require("dojo.data.ItemFileWriteStore");  
    dojo.require("dijit.form.Textarea");
</script>
<script>
var grade_store  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode(array()));?> );
var grade_result_store  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode(array()));?> );
var student_store  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode(array()));?> );

require(["dojo/ready"], function(ready){

	/*new dijit.form.FilteringSelect({
		name: "stu_test_id",
		id: "stu_test_id",
		searchAttr: "name",
		class: 'fullside',
		onChange: function() {
			
	    }
	}, "stu_test_id");*/
	dojo.ready(function(){
		new dijit.form.FilteringSelect({
			store: grade_store,
			autoComplete: true,                        
			required: false,
			id: "grade",
			name: "grade",           
			class: "fullside", 
			placeHolder:"<?php echo $tr->translate('SELECT_GRADE');?>",          
			onChange: function() {  
				
			}
		}, "grade");

		new dijit.form.FilteringSelect({
			store: grade_result_store,
			autoComplete: true,                        
			required: false,
			id: "grade_result",
			name: "grade_result",           
			class: "fullside", 
			placeHolder:"<?php echo $tr->translate('SELECT_GRADE');?>",          
			onChange: function() {  
				
			}
		}, "grade_result");
		
		getAllGrade();	
		getAllGradeResult();
		
	});
	
});



var url_get_stu = '<?php echo $this->url(array('module'=>'registrar','controller'=>'studenttest','action'=>'getstudenttestbybranch')); ?>';
function getStudntTestByBranch(){
	branch_id = dijit.byId('branch_id').get('value');
	if(branch_id==''){
		return false;
	}
	dojo.xhrPost({
		url: url_get_stu,
		content:{
			'branch_id':branch_id
			},
		handleAs:"json",
		load: function(data) {
			student_store  = getDataStorefromJSON('id','name', data);
			dijit.byId('stu_test_id').set('store',student_store);  
		},
		error: function(err) {
			alert(err);
		}
	});
}
var url_get_grade = '<?php echo $this->url(array('module'=>'registrar','controller'=>'register','action'=>'get-grade')); ?>';
function getAllGrade(){
	dijit.byId('grade').set('value',''); 
	dept_id = dijit.byId('degree').get('value');
	if(dept_id==''){
		return false;
	}
	dijit.byId('degree_result').set('value',dept_id);
	dojo.xhrPost({
		url:url_get_grade,
		content:{
			'dept_id':dept_id
			},
		handleAs:"json",
		load: function(data) {
			grade_store  = getDataStorefromJSON('id','name', data);
			dijit.byId('grade').set('store',grade_store);  
			<?php if (!empty($this->detailscore['grade'])){?>
				dijit.byId('grade').set('value',<?php echo $this->detailscore['grade'];?>);
			<?php }?>
		},
		error: function(err) {
			alert(err);
		}
	});
}

var url_get_grade = '<?php echo $this->url(array('module'=>'registrar','controller'=>'register','action'=>'get-grade')); ?>';
function getAllGradeResult(){
	dijit.byId('grade_result').set('value',''); 
	dept_id = dijit.byId('degree_result').get('value');
	if(dept_id==''){
		return false;
	}
	dojo.xhrPost({
		url:url_get_grade,
		content:{
			'dept_id':dept_id
			},
		handleAs:"json",
		load: function(data) {
			grade_result_store  = getDataStorefromJSON('id','name', data);
			dijit.byId('grade_result').set('store',grade_result_store);  
			<?php if (!empty($this->detailscore['grade_result'])){?>
				dijit.byId('grade_result').set('value',<?php echo $this->detailscore['grade_result'];?>);
			<?php }?>
		},
		error: function(err) {
			alert(err);
		}
	});
}
</script>


