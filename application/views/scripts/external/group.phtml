<?php 
	$tr=Application_Form_FrmLanguages::getCurrentlanguage();
	$baseUrl = $this->baseUrl()."/";
	$pageTitle = $tr->translate("CLASS_LIST");
	echo $this->headTitle($pageTitle);
	$frm =  $this->form_search;
	//print_r($this->allClass);
?>
<?php 
	echo $this->render('externalHead.phtml');
?>
<style>
	
	ul.sub_list {
		padding: 0;
		margin: 0 auto;
		list-style: none;
	}
	ul.sub_list li.head-list {
		background: #e6e6e6;
		padding: 3px 2px;
		text-align: center;
		font-weight: bold;
		margin-bottom: 3px;
		border-radius: 5px;
	}
	ul.sub_list li.head-list .row-li {
		vertical-align: middle;
	}
	ul.sub_list li .row-li {
		    display: inline-block;
		    font-size: 12px;
		    line-height: 14px;
		    vertical-align: top;
	}
	ul.sub_list li .row-li.titleLable {
		width: 50%;
	}
	ul.sub_list li .row-li.counting {
		width: 15%;
	}

	ul.sub_list li .row-li.buttonBlog {
		width: 30%;
		text-align: center;
	}
	.bg-color{
		background-color: #f7f7f7;
	}
	small.validateStr {
		display: block;
		color: #595959;
		font-style: italic;
	}

	ul.bg-head li{
		background-color: #575f69;
		padding: 4px;
		border-radius: 3px;
	}
	a.mini-button-class {
		padding: 2px;
		font-size: 10px;
		line-height: 14px;
		color: #fff;
		background-color: #0150a6;
		border-color: #004b9c;
		border-radius: 5px;
		text-align: center;
		display: block;
		margin: 1px 0;
	 }
	a.mini-button-class-edit {
		padding: 2px;
		font-size: 10px;
		line-height: 14px;
		color: #ffffff;
		background-color: #d1a00c;
		border-color: #004b9c;
		border-radius: 5px;
		display: block;
	}
	a.mini-button-class-edit:hover,
	a.mini-button-class:hover {
		background: #009688;
	}
	span.mini-button-class-success {
		padding: 2px;
		font-size: 10px;
		color: #fff;
		background-color: green;
		border-color: #004b9c;
		border-radius: 10px;
		display: block;
	}
	span.mini-button-class-loading {
		padding: 2px;
		color: #7c7c7c;
		background-color: #fbfbfb;
		border-color: #004b9c;
		border-radius: 10px;
		border: solid 1px #eee;
		display: block;
		font-size: 10px;
		line-height: 14px;
	}
	.oneLineTitle {
		text-overflow: ellipsis;
		display: -webkit-box !important;
		-webkit-line-clamp: 1;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	h4 {
		line-height: 24px;
		font-size: 16px;
		margin: 0;
	}
</style>
	
	<div class="row"> 
		<div class="col-md-12 col-sm-12 col-xs-12">
			<div class="card mb-1 pb-3">
				<div class="card-header pb-1"> 
					<h3 class="card-title mb-1 "><?php echo $tr->translate("SEARCH"); ?></h3> 
				</div>
				<div class="card-content">
					<div class="card-body">
						<form id="list" name="list" action="" dojoType="dijit.form.Form" method="post">
							<div class="form-group">
								<div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("adv_search");?>
								</div>
								<!--
								<div class="col-md-2 col-sm-3 col-xs-12">
									<?php //echo $frm->getElement("branch_id");?>
							   </div>
								-->
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("academic_year");?>
							   </div>
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("degree");?>
							   </div>
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<input id="grade" />
							   </div>
							   <div class="col-md-2 col-sm-3 col-xs-12">
									<?php echo $frm->getElement("is_pass");?>
								</div>
								<div class="col-md-2 col-sm-2 col-xs-12">
									<button class="button-class button-primary" iconClass="glyphicon glyphicon-search" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button>
								</div>
						   </div>
					   </form>
				   </div>
			   </div>
			   
			   <div class="row"> 
					<?php 
					//print_r($this->allClass);
				
					if(!empty($this->allClass)) foreach($this->allClass as $row){ 
						$cardClass = "border-top-primary border-top-darken-1";
						$bgClass = "border-primary bg-gradient-directional-primary";
						if($row['examType']==2){
							$cardClass = "border-top-warnings border-top-darken-1";
							$bgClass = "border-warnings bg-gradient-directional-warnings";
						}
					?>
					<div class="col-md-3 col-sm-3 col-xs-12"> 
						<div class="card mb-0 <?php echo $cardClass; ?> border-top-5">
							<div class="card-content">
								<div class="row d-flex mb-1">
									<div class="col-xs-5 pr-0">
									
										<div class="d-flex align-items-center h-100 text-white  <?php echo $bgClass; ?>">
											<span class="mt-0 mb-0 mr-auto ml-auto text-white font-large-1 text-center">
												<?php echo $row['group_code']; ?>
												<small class="timeSchedule text-white mt-0"><i class="glyphicon glyphicon-education font-large-4"></i> </small>
											</span>
										</div>
									</div>
									<div class="col-xs-7 pl-0">
										<div class="col-md-12 col-sm-12 col-xs-12 pt-1">
											<h4 class="text-primary"><?php echo $row['title']; ?></h4>
											<h4 class="text-warning oneLineTitle"><?php echo $row['subjectTitle']; ?></h4>
										
											<p class="mb-0 mt-0"><i class="glyphicon glyphicon-map-marker" aria-hidden="true"></i>&nbsp;<?php echo $row['branchName']; ?></p>
											<p class="mb-0"><i class="glyphicon glyphicon-education" aria-hidden="true"></i>&nbsp;<?php echo $row['academicYear']; ?></p>
											<p class="mb-0 "><i class="fa fa-file-text-o" aria-hidden="true"></i>&nbsp;<?php echo $row['forTypeTitle']."  ".$row['forMonthTitle']; ?></p>
											<p class="mb-0 "><i class="glyphicon glyphicon-calendar" aria-hidden="true"></i>&nbsp;<?php echo $row['fromDate']." / ".$row['endDate']; ?></p>
										
										</div>
									</div>
								</div>
								<div class="col-md-12 col-sm-12 col-xs-12 ">
									<ul class="sub_list">
										<li class="head-list">
											<div class="row-li titleLable">
												<?php echo $tr->translate("CRITERIAL_NAME"); ?>
											</div>
											<div class="row-li counting">
												<?php echo $tr->translate("AMOUNT"); ?>
											</div>
											<div class="row-li buttonBlog">
												<?php echo $tr->translate("INPUT_SCORE"); ?>
											</div>
										</li>
									<?php   
										$dbExternal = new Application_Model_DbTable_DbExternal;
										$gradingId= $row['gradingId'];
										$settingEntryId= $row['id'];
										$examType= $row['examType'];
										$subjectId= $row['subjectId'];
										$groupId= $row['groupId'];
										$data = array(
											'gradingId' 	  => $gradingId
											,'examType' 	  => $examType
											,'subjectId' 	  => $subjectId
											,'groupId' 		  => $groupId
											,'settingEntryId' => $settingEntryId
										);
										$criterial = $dbExternal -> getCriterialByGrading($data);
										$no =0;
										if(!empty($criterial)) foreach($criterial as $key => $rsCriterial){ 
											 $no++;
										?>
											<li class="<?php echo ($key%2)==1?'bg-color':'bg';?>">
												<?php 
												$currentDate = date('Y-m-d');
												$stringValidDate="";
												if($rsCriterial['criteriaType']==2){
													$stringValidDate='
													<small class="validateStr"><strong >'.$tr->translate('VALIDATE').'</strong> :
													'.$row['examFromDate']." ".$tr->translate('TO')." ".$row['examEndDate'].'
													</small>';
												}
												?>
													
												<div class="row-li titleLable"><?php echo $no.". ".$rsCriterial['criterialTitle'].$stringValidDate; ?></div>
												<div class="row-li counting">
													<span class="text-primary">
													<?php
														if(CRITERIA_LIMIT_SETTING==1){
															echo  $rsCriterial['timeInput'].'/'.$rsCriterial['timeInputSetting'];
														}else{
															echo  $rsCriterial['timeInput']; 
														}
													 ?> 
													 <?php echo $tr->translate('Times');?>
													</span>
												</div>
												<div class="row-li buttonBlog">
												<?php 	
													if($rsCriterial['criteriaType']==2){
														if( $currentDate >= $row['examFromDate'] AND $currentDate <= $row['examEndDate']){
															if($row['IsExam']>0 AND $row['isLock'] ==0) {
															?>
																<a target="_blank" class="mini-button-class-edit oneLineTitle" href="<?php echo $this->baseUrl()."/grading/edit/id/".$row['groupId'].'/gradingRowId/'.$row['IsExam'];?>">
																	<i class="glyphicon glyphicon-edit" aria-hidden="true"></i> <?php echo $tr->translate('EDIT');?>
																</a>

															<?php }elseif($row['IsExam']>0 AND $row['isLock'] ==1){   ?>
																<span class="mini-button-class-success oneLineTitle" >
																	<i class="glyphicon glyphicon-ok-circle" aria-hidden="true"></i> <?php echo $tr->translate('Completed');?>
																</span>
														<?php }else{?>
															<a target="_blank" class="mini-button-class oneLineTitle" href="<?php echo $this->baseUrl()."/grading/index/id/".$row['groupId']."/criteriaId/".$rsCriterial['criteriaId']."/subjectId/".$row['subjectId']."/settingEntryId/".$row['id'];?>">
																	<i class="glyphicon glyphicon-sort-by-order" aria-hidden="true"></i> <?php echo $tr->translate('INPUT_SCORE');?>
															</a>
															<?php }	?>
														<?php }else{?>
																<span class="mini-button-class-loading oneLineTitle" >
																	<i class="glyphicon glyphicon-hourglass" aria-hidden="true"></i> <?php echo $tr->translate('UNAVAILABLE');?>
																</span>
															<?php }	?>
												<?php }else{?>
														<?php if(CRITERIA_LIMIT_SETTING==1){ 
															if($rsCriterial['timeInput'] < $rsCriterial['timeInputSetting'] ){
																?>
															<a target="_blank" class="mini-button-class oneLineTitle" href="<?php echo $this->baseUrl()."/grading/index/id/".$row['groupId']."/criteriaId/".$rsCriterial['criteriaId']."/subjectId/".$row['subjectId']."/settingEntryId/".$row['id'];?>">
																<i class="glyphicon glyphicon-sort-by-order " aria-hidden="true"></i> <?php echo $tr->translate('INPUT_SCORE');?>
															</a>
														<?php }else{ ?>
															<span class="mini-button-class-success oneLineTitle" >
																<i class="glyphicon glyphicon-ok-circle" aria-hidden="true"></i> <?php echo $tr->translate('Completed');?>
															</span>

														<?php } 
													}else{ ?>

															<a target="_blank" class="mini-button-class oneLineTitle" href="<?php echo $this->baseUrl()."/grading/index/id/".$row['groupId']."/criteriaId/".$rsCriterial['criteriaId']."/subjectId/".$row['subjectId']."/settingEntryId/".$row['id'];?>">
																<i class="glyphicon glyphicon-sort-by-order " aria-hidden="true"></i> <?php echo $tr->translate('INPUT_SCORE');?>
															</a>

													<?php } ?>
													
												<?php }	?>
												</div>
											</li>
									<?php  } ?>
									</ul>
									<div style="clear:both;"></div>
								</div>

							</div>
						</div>
					</div>
					<?php } ?>
				</div> 
	
			</div>
		</div>
	</div>
	
<script src="<?php echo $this->baseUrl();?>/js/help.js"  type="text/javascript"></script>	
<script type="text/javascript">
$( document ).ready(function() {
   setPageTitle('<?php echo $pageTitle; ?>');
});

dojo.require("dojo.data.ItemFileWriteStore"); 
dojo.ready(function(){

	new dijit.form.FilteringSelect({
		queryExpr: "*${0}*",
		autoComplete: false, 
		required: false,
		id: "grade",
		name: "grade",           
		class: 'fullside',  
		placeHolder:"<?php echo $tr->translate("SELECT_GRADE");?>",          
		onChange: function() {  
		}
	}, "grade");
	
	getallGrade();
	<?php if(!empty($this->search['academic_year'])){?>
	 dijit.byId('academic_year').attr('value','<?php echo $this->search['academic_year'];?>'); 
	<?php } ?>
});

var url_dept = '<?php echo $this->url(array('module'=>'global','controller'=>'grade','action'=>'get-grade')); ?>';
function getallGrade(){
	dept_id = dijit.byId('degree').get('value');
	if(dept_id=='' || dept_id==-1){return false;}
		dojo.xhrPost({
			url:url_dept,
			content:{
				'dept_id':dept_id,
				'noaddnew':1
				},
			handleAs:"json",
			load: function(data) {
				dijit.byId('grade').attr('value','');
				grade_store  = getDataStorefromJSON('id','name', data);
			    dijit.byId('grade').set('store',grade_store); 
			    dijit.byId('grade').attr('value','<?php echo $this->search['grade']?>');    
			},
			error: function(err) {
			}
		});
}
</script>
<?php 
	echo $this->render('externalFoot.phtml');
?>