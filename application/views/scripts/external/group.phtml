<?php 
	$tr=Application_Form_FrmLanguages::getCurrentlanguage();
	$baseUrl = $this->baseUrl()."/";
	$pageTitle = $tr->translate("CLASS_LIST");
	echo $this->headTitle($pageTitle);
	$frm =  $this->form_search;
	
?>
<?php 
	echo $this->render('externalHead.phtml');
?>
<style>
	ul {
	display: inline;
	margin: 0;
	padding: 0;
	}
	ul.sub_list li:hover{
		background-color: #cccccc;
	}
	ul.sub_list li{
		float: left;
		
		list-style: none;
	}
	ul.bg-color li{
		background-color: #cccccc;
		padding: 3px;
		border-radius: 3px;
	}
	ul.bg li{
		background-color: white;
		padding: 3px;
		border-radius: 3px;
	}
	a.mini-button-class {
    padding: 3px;
    font-size: 10px;
    color: #fff;
    background-color: #0150a6;
    border-color: #004b9c;
    border-radius: 6px;
    width: 75px !important;
    display: block;
	}
</style>
	
	<div class="row"> 
		<div class="col-md-12 col-sm-12 col-xs-12">
			<div class="card mb-1 pb-3">
				<div class="card-header pb-1"> 
					<h3 class="card-title mb-1 "><?php echo $tr->translate("SEARCH"); ?></h3> 
				</div>
				<div class="card-content">
					<div class="card-body">
						<form id="list" name="list" action="" dojoType="dijit.form.Form" method="post">
							<div class="form-group">
								<div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("adv_search");?>
								</div>
								<!--
								<div class="col-md-2 col-sm-3 col-xs-12">
									<?php //echo $frm->getElement("branch_id");?>
							   </div>
								-->
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("academic_year");?>
							   </div>
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("degree");?>
							   </div>
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<input id="grade" />
							   </div>
							   <div class="col-md-2 col-sm-3 col-xs-12">
									<?php echo $frm->getElement("is_pass");?>
								</div>
								<div class="col-md-2 col-sm-2 col-xs-12">
									<button class="button-class button-primary" iconClass="glyphicon glyphicon-search" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button>
								</div>
						   </div>
					   </form>
				   </div>
			   </div>
			   
			   <div class="row"> 
					<?php if(!empty($this->allClass)) foreach($this->allClass as $row){ 
						$cardClass = "border-top-primary border-top-darken-1";
						$bgClass = "border-primary bg-gradient-directional-primary";
						if($row['is_pass']==4){
							$cardClass = "border-top-success border-top-darken-1";
							$bgClass = "border-success bg-gradient-directional-success";
						}else if($row['is_pass']==0){
							$cardClass = "border-top-warnings border-top-darken-1";
							$bgClass = "border-warnings bg-gradient-directional-warnings";
						}
					?>
					<div class="col-md-3 col-sm-3 col-xs-12"> 
						<div class="card mb-0 <?php echo $cardClass; ?> border-top-5">
							<div class="card-content">
								<div class="row d-flex mb-1">
									<div class="col-xs-5 pr-0">
										<div class="d-flex align-items-center h-100 text-white  <?php echo $bgClass; ?>">
											<i class="mt-0 mb-0 mr-auto ml-auto glyphicon glyphicon-education icon-opacity text-white font-large-4"></i>
											<strong><?php echo $row['group_code']; ?></strong>
										</div>
									</div>
									<div class="col-xs-7 pl-0">
										<ul class="nav navbar-right panel_toolbox stusearch">
										  <li class="dropdown">
											<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
											<ul class="dropdown-menu" role="menu">
												<li>
													<a target="_blank" href="<?php echo $this->baseUrl()."/grading/add/id/".$row['id'];?>"><?php echo $tr->translate('ISSUE_SCORE');?></a>
												</li>
												<?php if(!empty($row['mainTeacher'])){ ?>
												<li>
													<a target="_blank" href="<?php echo $this->baseUrl()."/assessment/add/id/".$row['id'];?>"><?php echo $tr->translate('ISSUE_STUDENT_ASSESSMENT');?></a>
												</li>
												<?php } ?>
												<li>
													<a target="_blank" href="<?php echo $this->baseUrl()."/extreport/rpt-student-list/id/".$row['id'];?>"><?php echo $tr->translate('STUDENT_LIST_REPORT');?></a>
												</li>
											</ul>
										  </li>
										</ul>
										<div class="col-md-12 col-sm-12 col-xs-12 ">
											<p class="mb-0 mt-0"><small class="text-muted float-right"><?php echo $row['branchName']; ?></small></p>
											<p class="mb-0"><?php echo $row['academicYear']; ?></p>
											<p class="mb-0"><?php echo $row['groupStatus']; ?></p>
											<h3 class="mb-0 mt-0 p-relative">
												<span class="counting-num mr-1"><?php echo sprintf('%02d',$row['amountStudent']); ?></span>
												<span class="adjustLineHeight material-icons-outlined">groups</span> 
											</h3>
											<p class="mb-0"><?php if(!empty($row['mainTeacher'])){ echo "(".$row['mainTeacher'].")";} ?></p>
											<ul class="listSmallBtn">
													<?php if(!empty($row['mainTeacher'])){ ?>
													<li>
														<div class="form-group">
															<a  class="small-button-class" href="<?php echo $this->baseUrl()."/assessment/add/id/".$row['id'];?>">
																<i class="glyphicon glyphicon-baby-formula" aria-hidden="true"></i> <?php echo $tr->translate('ISSUE_STUDENT_ASSESSMENT');?>
															</a>
														</div>
													</li>
													<?php } ?>
												</ul>
										</div>
									</div>
								</div>
								<div class="col-md-12 col-sm-12 col-xs-12 ">
									<?php   
										$dbg = new Application_Model_DbTable_DbGlobal();
										$degreeId = $row['degreeId'];
										$scoreSetting= array(
											'degreeId' => $degreeId,
										);
										$rsEntrySetting = $dbg->checkEntryScoreSetting($scoreSetting);

										$dbExternal = new Application_Model_DbTable_DbExternal;
										$gradingId= $row['gradingId'];
										$data = array(
											'gradingId' => $gradingId,
										);
										$criterial = $dbExternal -> getCriterialByGrading($data);
										$no =0;
										if(!empty($criterial)) foreach($criterial as $key => $rsCriterial){ 
											$no++;
										?>
										<ul class="sub_list <?php echo ($key%2)==0?'bg-color':'bg';?>">
											<li style="width: 60%;" ><?php echo $no.". ".$rsCriterial['criterialTitle']; ?></li>
											<?php if(!empty($rsEntrySetting)){ ?>
												<li style="width: 40%; text-align:center;" >
													<a target="_blank" class="mini-button-class" href="<?php echo $this->baseUrl()."/grading/index/id/".$row['id']."/criteriaId/".$rsCriterial['criteriaId'];?>">
														<i class="glyphicon glyphicon-sort-by-order" aria-hidden="true"></i> <?php echo $tr->translate('INPUT_SCORE');?>
													</a>
												<!-- <a target="_blank" href="<?php echo $this->baseUrl()."/grading/add/id/".$row['id']."/criteriaId/".$rsCriterial['criteriaId'];?>"><i class="fa fa-sort-alpha-asc" aria-hidden="true"></i>&nbsp;<i class="text-success fa fa-toggle-on" aria-hidden="true"></i></a> -->
												</li>	
											<?php }else{ ?>	
												<li style="width: 40%; text-align:center;" ><i class="text-info fa fa-toggle-off" aria-hidden="true"></i>
											<?php }?>	
										</ul>
									<?php } ?>
									<div style="clear:both;"></div>
								</div>

							</div>
						</div>
					</div>
					<?php } ?>
				</div> 
	
			</div>
		</div>
	</div>
	
<script src="<?php echo $this->baseUrl();?>/js/help.js"  type="text/javascript"></script>	
<script type="text/javascript">
$( document ).ready(function() {
   setPageTitle('<?php echo $pageTitle; ?>');
});

dojo.require("dojo.data.ItemFileWriteStore"); 
dojo.ready(function(){

	new dijit.form.FilteringSelect({
		queryExpr: "*${0}*",
		autoComplete: false, 
		required: false,
		id: "grade",
		name: "grade",           
		class: 'fullside',  
		placeHolder:"<?php echo $tr->translate("SELECT_GRADE");?>",          
		onChange: function() {  
		}
	}, "grade");
	
	getallGrade();
	<?php if(!empty($this->search['academic_year'])){?>
	 dijit.byId('academic_year').attr('value','<?php echo $this->search['academic_year'];?>'); 
	<?php } ?>
});

var url_dept = '<?php echo $this->url(array('module'=>'global','controller'=>'grade','action'=>'get-grade')); ?>';
function getallGrade(){
	dept_id = dijit.byId('degree').get('value');
	if(dept_id=='' || dept_id==-1){return false;}
		dojo.xhrPost({
			url:url_dept,
			content:{
				'dept_id':dept_id,
				'noaddnew':1
				},
			handleAs:"json",
			load: function(data) {
				dijit.byId('grade').attr('value','');
				grade_store  = getDataStorefromJSON('id','name', data);
			    dijit.byId('grade').set('store',grade_store); 
			    dijit.byId('grade').attr('value','<?php echo $this->search['grade']?>');    
			},
			error: function(err) {
			}
		});
}
</script>
<?php 
	echo $this->render('externalFoot.phtml');
?>