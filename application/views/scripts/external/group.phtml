<?php 
	$tr=Application_Form_FrmLanguages::getCurrentlanguage();
	$baseUrl = $this->baseUrl()."/";
	$pageTitle = $tr->translate("GROUP_LIST");
	echo $this->headTitle($pageTitle);
	$key = new Application_Model_DbTable_DbKeycode();
	$dataInfo=$key->getKeyCodeMiniInv(TRUE);
		
	$sessionUserExternal=new Zend_Session_Namespace("externalAuth");
	$userName = $sessionUserExternal->userName;
	$teacherNameKh = $sessionUserExternal->teacher_name_kh;
	$teacherNameEn = $sessionUserExternal->teacher_name_en;
	$userId = $sessionUserExternal->userId;
	
	$teachName = $teacherNameKh;
	if(empty($teachName)){
		$teachName = $teacherNameEn;
	}else{
		if(!empty($teacherNameEn)){
			$teachName = $teachName." / ".$teacherNameEn;
		}
	}
	 $frm =  $this->form_search;
	 
?>
<?php 
	echo $this->render('externalHead.phtml');
?>

	
	<div class="row"> 
		<div class="col-md-12 col-sm-12 col-xs-12">
			<div class="card mb-1 ">
				<div class="card-header pb-1"> 
					<h3 class="card-title mb-2 "><?php echo $tr->translate("SEARCH"); ?></h3> 
				</div>
				<div class="card-content">
					<div class="card-body">
						<form id="list" name="list" action="" dojoType="dijit.form.Form" method="post">
							<div class="form-group">
								<div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("adv_search");?>
								</div>
								<!--
								<div class="col-md-2 col-sm-3 col-xs-12">
									<?php //echo $frm->getElement("branch_id");?>
							   </div>
								-->
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("academic_year");?>
							   </div>
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<?php echo $frm->getElement("degree");?>
							   </div>
							   <div class="col-md-2 col-sm-2 col-xs-12">
									<input id="grade" />
							   </div>
							   <div class="col-md-2 col-sm-3 col-xs-12">
									<?php echo $frm->getElement("is_pass");?>
								</div>
								<div class="col-md-2 col-sm-2 col-xs-12">
									<button class="button-class button-primary" iconClass="glyphicon glyphicon-search" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button>
								</div>
						   </div>
					   </form>
				   </div>
			   </div>
			</div>
		</div>
	</div>
	<div class="row"> 
		<?php if(!empty($this->allClass)) foreach($this->allClass as $row){ 
			$cardClass = "border-top-primary border-top-darken-1";
			$bgClass = "border-primary bg-gradient-directional-primary";
			if($row['is_pass']==4){
				$cardClass = "border-top-success border-top-darken-1";
				$bgClass = "border-success bg-gradient-directional-success";
			}else if($row['is_pass']==0){
				$cardClass = "border-top-warnings border-top-darken-1";
				$bgClass = "border-warnings bg-gradient-directional-warnings";
			}
		?>
		<div class="col-md-3 col-sm-3 col-xs-12"> 
			<div class="card mb-1 <?php echo $cardClass; ?> border-top-5">
                <div class="card-content">
                    <div class="row d-flex">
                        <div class="col-xs-4 pr-0">
                            <div class="d-flex align-items-center h-100 <?php echo $bgClass; ?>">
								<i class="mt-0 mb-0 mr-auto ml-auto glyphicon glyphicon-education icon-opacity text-white font-large-4"></i>
							</div>
                        </div>
                        <div class="col-xs-8 pl-0">
							<ul class="nav navbar-right panel_toolbox stusearch">
							  <li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
								<ul class="dropdown-menu" role="menu">
									<li>
										<a target="_blank" href="<?php echo $this->baseUrl()."/issuescore/add/id/".$row['id'];?>"><?php echo $tr->translate('ISSUE_SCORE');?></a>
									</li>
									<li>
										<a target="_blank" href="<?php echo $this->baseUrl()."/extreport/rpt-student-list/id/".$row['id'];?>"><?php echo $tr->translate('STUDENT_LIST_REPORT');?></a>
									</li>
								</ul>
							  </li>
							</ul>
                            <div class="p-1">
                                <p class="mb-0 mt-0"><small class="text-muted float-right"><?php echo $row['branchName']; ?></small></p>
                                <div class="text-left">
                                    <strong><?php echo $row['group_code']; ?></strong>
                                    <p class="mb-0"><?php echo $row['academicYear']; ?></p>
									<h3 class="mb-0 mt-0 p-relative">
										<span class="counting-num mr-1"><?php echo sprintf('%02d',$row['amountStudent']); ?></span>
										<span class="adjustLineHeight material-icons-outlined">groups</span> 
									</h3>
                                    <p class="mb-0"><?php echo $row['groupStatus']; ?></p>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
		</div>
		<?php } ?>
		
		
	</div> 
<script src="<?php echo $this->baseUrl();?>/js/help.js"  type="text/javascript"></script>	
<script type="text/javascript">
$( document ).ready(function() {
   setPageTitle('<?php echo $pageTitle; ?>');
});

dojo.require("dojo.data.ItemFileWriteStore"); 
dojo.ready(function(){

	new dijit.form.FilteringSelect({
		queryExpr: "*${0}*",
		autoComplete: false, 
		required: false,
		id: "grade",
		name: "grade",           
		class: 'fullside',  
		placeHolder:"<?php echo $tr->translate("SELECT_GRADE");?>",          
		onChange: function() {  
		}
	}, "grade");
	
	getallGrade();
});

var url_dept = '<?php echo $this->url(array('module'=>'global','controller'=>'grade','action'=>'get-grade')); ?>';
function getallGrade(){
	dept_id = dijit.byId('degree').get('value');
	if(dept_id=='' || dept_id==-1){return false;}
		dojo.xhrPost({
			url:url_dept,
			content:{
				'dept_id':dept_id,
				'noaddnew':1
				},
			handleAs:"json",
			load: function(data) {
				dijit.byId('grade').attr('value','');
				grade_store  = getDataStorefromJSON('id','name', data);
			    dijit.byId('grade').set('store',grade_store); 
			    dijit.byId('grade').attr('value','<?php echo $this->adv_search['grade']?>');    
			},
			error: function(err) {
			}
		});
}
</script>
<?php 
	echo $this->render('externalFoot.phtml');
?>